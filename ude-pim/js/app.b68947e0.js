(function(){"use strict";var e={942:function(e,t,a){var s=a(144),i=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},r=[],l={},n=l,o=a(1001),c=(0,o.Z)(n,i,r,!1,null,null,null),u=c.exports,p=a(4720),d=a.n(p);s["default"].use(d());var h=function(){var e=this,t=e._self._c;return t("div",{staticClass:"pim-header"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:4}},[t("div",{staticClass:"grid-content bg-purple logo"},[t("a",{attrs:{href:"#"}})])]),t("el-col",{attrs:{span:16}},[t("div",{staticClass:"grid-content bg-purple title"},[t("span",[e._v("新技研专案管理系统")])])]),t("el-col",{attrs:{span:4}},[t("div",{staticClass:"grid-content bg-purple info"},[t("a",{attrs:{href:"#"}},[t("span",[e._v("你的名字")]),t("i",{staticClass:"el-icon-switch-button"})])])])],1)],1)},m=[],b={},f=b,y=(0,o.Z)(f,h,m,!1,null,"3a7c2686",null),g=y.exports,v=function(){var e=this,t=e._self._c;return t("el-menu",{attrs:{"background-color":"#343743","text-color":"#fff","active-text-color":"#409eff","default-active":e.$route.path,collapse:e.isCollapse,"collapse-transition":!1,router:""}},[1===e.user.type?t("el-submenu",{attrs:{index:"1"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-s-platform"}),t("span",[e._v("专案管理")])]),t("el-menu-item",{attrs:{index:"/admin/index"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("专案主页")]),t("el-menu-item",{attrs:{index:"/common/index"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("专案详情")]),t("el-menu-item",{attrs:{index:"/admin/caseList"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("专案管理")]),t("el-menu-item",{attrs:{index:"/admin/subManage"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("子流程管理")]),t("el-menu-item",{attrs:{index:"/admin/templeteManage"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("模板管理")]),t("el-menu-item",{attrs:{index:"/admin/taskManage"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("任务管理")])],2):e._e(),1===e.user.type?t("el-submenu",{attrs:{index:"2"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-s-operation"}),t("span",[e._v("审批流程"),e.subList.length||e.delayList.length||e.finishList.length||e.taskList.length||e.caseSubList.length?t("el-badge",{attrs:{value:e.subList.length,"is-dot":""}}):e._e()],1)]),t("el-menu-item",{attrs:{index:"/admin/exception"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("中断专案"),e.subList.length?t("el-badge",{attrs:{value:e.subList.length}}):e._e()],1),t("el-menu-item",{attrs:{index:"/admin/delay"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("延期申请"),e.delayList.length?t("el-badge",{attrs:{value:e.delayList.length}}):e._e()],1),t("el-menu-item",{attrs:{index:"/admin/finish"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("完结申请"),e.finishList.length?t("el-badge",{attrs:{value:e.finishList.length}}):e._e()],1),t("el-menu-item",{attrs:{index:"/admin/study"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("任务申请"),e.taskList.length?t("el-badge",{attrs:{value:e.taskList.length}}):e._e()],1),t("el-menu-item",{attrs:{index:"/admin/caseApply"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("专案类申请"),e.caseSubList.length?t("el-badge",{attrs:{value:e.caseSubList.length}}):e._e()],1),t("el-menu-item",{attrs:{index:"/admin/info"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("消息中心"),e.logList.length?t("el-badge",{attrs:{value:e.logList.length}}):e._e()],1)],2):e._e(),1===e.user.type?t("el-submenu",{attrs:{index:"3"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-s-data"}),t("span",[e._v("数据统计")])]),t("el-menu-item",{attrs:{index:"/admin/monthlyAnalysis"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("月报分析")]),t("el-menu-item",{attrs:{index:"/common/caseAnalysis"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("专案分析")])],2):e._e(),1===e.user.type?t("el-submenu",{attrs:{index:"4"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-s-custom"}),t("span",[e._v("部员管理")])]),t("el-menu-item",{attrs:{index:"/admin/userList"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("部员信息管理")]),t("el-menu-item",{attrs:{index:"/common/userProject"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("部员专案统计")]),t("el-menu-item",{attrs:{index:"/common/userProjectTracking"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("部员专案追踪")])],2):e._e(),0===e.user.type?t("el-submenu",{attrs:{index:"5"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-user"}),t("span",[e._v("个人中心"),e.logList.length?t("el-badge",{staticClass:"item",attrs:{"is-dot":"",value:e.logList.length}}):e._e()],1)]),t("el-menu-item",{attrs:{index:"/user/index"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("个人总览")]),t("el-menu-item",{attrs:{index:"/user/info"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("消息中心"),e.logList.length?t("el-badge",{attrs:{value:e.logList.length}}):e._e()],1),t("el-menu-item",{attrs:{index:"/user/progress"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("执行任务")]),t("el-menu-item",{attrs:{index:"/user/statistics"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("数据统计")])],2):e._e(),0===e.user.type?t("el-submenu",{attrs:{index:"6"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-s-opportunity"}),t("span",[e._v("部门数据")])]),t("el-menu-item",{attrs:{index:"/common/index"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("专案详情")]),t("el-menu-item",{attrs:{index:"/common/caseAnalysis"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("专案分析")]),t("el-menu-item",{attrs:{index:"/common/userProjectTracking"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v("周会模式")])],2):e._e(),t("el-menu-item",[t("router-link",{style:{color:e.isCollapse?"#333744":"#fff"},attrs:{to:"/common/schedule"}},[t("i",{staticClass:"el-icon-s-order"}),e._v("待办事项")])],1),t("el-menu-item",[t("a",{style:{color:e.isCollapse?"#333744":"#fff"},attrs:{target:"_blank",href:"https://scmail.ude-corp.com/"}},[t("i",{staticClass:"el-icon-s-promotion"}),e._v("邮件系统")])]),t("el-menu-item",[t("router-link",{style:{color:e.isCollapse?"#333744":"#fff"},attrs:{to:"/common/demand"}},[t("i",{staticClass:"el-icon-s-check"}),e._v("需求管理")])],1)],1)},w=[],k=a(629),T={props:{isCollapse:Boolean},data(){return{}},computed:{...(0,k.rn)("log",["logList"]),...(0,k.rn)("apply",["delayList","subList","finishList","caseSubList","taskList"]),...(0,k.rn)(["user"])},mounted(){1===this.user.type?(this.getDelay(),this.exceptionSub(),this.getFinish(),this.getCaseSubApplyList(),this.getTaskList(),this.getLogList(),setInterval((()=>{this.getDelay(),this.exceptionSub(),this.getFinish(),this.getCaseSubApplyList(),this.getTaskList(),this.getLogList()}),6e4)):0===this.user.type&&(this.getLogList(),this.exceptionSub(),setInterval((()=>{this.getLogList(),this.exceptionSub()}),6e4))},methods:{...(0,k.nv)("log",["getLogList"]),...(0,k.nv)("apply",["getDelay","exceptionSub","getFinish","getCaseSubApplyList","getTaskList"])}},S=T,x=(0,o.Z)(S,v,w,!1,null,"61a2db8d",null),C=x.exports,D=function(){var e=this,t=e._self._c;return t("div",{staticClass:"navigation_bar"},e._l(e.tabs,(function(a){return t("el-tag",{key:a.name,staticStyle:{"margin-right":"5px"},attrs:{closable:""},on:{click:function(t){return e.jump2path(a)},close:function(t){return e.removePath(a.path)}}},[e._v(" "+e._s(a.name)+" ")])})),1)},I=[],_={data(){return{tabs:[]}},created(){this.$router.afterEach(((e,t)=>{if("/case2sub"===e.path||"/case2person"===e.path)return;let a=this.tabs.find((t=>t.path===e.path));a||this.tabs.push({name:e.name,path:e.path,query:e.query})}))},methods:{removePath(e){this.tabs=this.tabs.filter((t=>t.path!==e))},jump2path(e){this.$router.push({path:e.path,query:e.query})}}},L=_,F=(0,o.Z)(L,D,I,!1,null,"f23432a0",null),O=F.exports,j=function(){var e=this;e._self._c;return e._m(0)},A=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"pieInfo"},[t("div",{staticStyle:{width:"600px",height:"300px"},attrs:{id:"pieChart"}}),t("div",{staticStyle:{width:"1000px",height:"300px"},attrs:{id:"barChart"}})])}],z={data(){return{pieChart:null,barChart:null,info:[]}},computed:{...(0,k.rn)("caseM",["caseList","queryList"])},mounted(){this.info=this.caseList,this.pieChart=this.$echarts.init(document.getElementById("pieChart")),this.barChart=this.$echarts.init(document.getElementById("barChart")),this.renderBarChart(),this.renderPieChart()},watch:{caseList:{handler(){this.info=this.caseList,this.renderBarChart(),this.renderPieChart()}},queryList:{handler(){this.info=this.queryList,this.renderBarChart(),this.renderPieChart()}}},methods:{renderPieChart(){const e={};this.info.forEach((t=>{const a=t.status;e[a]=(e[a]||0)+1}));var t=[...new Set(this.info.map((e=>e.status)))];t.sort();const a=t.map((t=>{const a=e[t];return 0===t?t="正在执行":1===t?t="正常完成":2===t?t="已延误":3===t?t="延误完成":4===t&&(t="未开始"),{name:t,value:a}}));t=t.map((e=>0===e?"正在执行":1===e?"正常完成":2===e?"已延误":3===e?"延误完成":4===e?"未开始":void 0));const s={title:{text:"执行状态总览",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:10,data:t,itemWidth:80,itemHeight:30},series:[{name:"执行状态",type:"pie",avoidLabelOverlap:!1,label:{show:!1,position:"center"},itemStyle:{color:function(e){return"正在执行"===e.data.name?"#53a8ff":"正常完成"===e.data.name?"#42b983":"已延误"===e.data.name?"#dc3545":"延误完成"===e.data.name?"#ffc107":"未开始"===e.data.name?"#C2C3C5":void 0}},data:a}]};this.pieChart.setOption(s)},renderBarChart(){const e=this.info.filter((e=>null!==e.finishTime)).map((e=>"name"in e&&null!==e.finishTime?e.name:"subName"in e&&null!==e.finishTime?e.subName:void 0)),t=[],a=[];this.info.forEach((e=>{null!==e.finishTime&&("undefined"!==typeof e.standardTime?t.push(Math.ceil(new Date(e.standardTime)-new Date(e.startTime))/864e5):t.push(Math.ceil(new Date(e.presetTime)-new Date(e.startTime))/864e5),a.push(Math.ceil(new Date(e.finishTime)-new Date(e.startTime))/864e5))}));const s={title:{text:"专案耗时对比",x:"center",y:"bottom"},legend:{show:!0},xAxis:{data:e},yAxis:{},series:[{name:"正常时间",type:"bar",data:t,label:{show:!0,position:"top"}},{name:"完成时间",type:"bar",data:a,label:{show:!0,position:"top"}}]};this.barChart.setOption(s)}}},$=z,R=(0,o.Z)($,j,A,!1,null,"e56d360c",null),V=R.exports,q=function(){var e=this,t=e._self._c;return t("div",{staticClass:"cards"},[t("el-card",{staticClass:"sub_card",attrs:{shadow:"always"}},[t("label",{staticClass:"cardName"},[e._v("专案类")]),t("hr"),t("router-link",{attrs:{to:"/user/statistics?curType=0"}},[e._v("查看详情")])],1),t("el-card",{staticClass:"temporary_card",attrs:{shadow:"always"}},[t("label",{staticClass:"cardName"},[e._v("临时事务")]),t("hr"),t("router-link",{attrs:{to:"/user/statistics?curType=1"}},[e._v("查看详情")])],1),t("el-card",{staticClass:"research_card",attrs:{shadow:"always"}},[t("label",{staticClass:"cardName"},[e._v("技术研究")]),t("hr"),t("router-link",{attrs:{to:"/user/statistics?curType=2"}},[e._v("查看详情")])],1)],1)},U=[],N={},P=N,E=(0,o.Z)(P,q,U,!1,null,"9124c0dc",null),M=E.exports,B=function(){var e=this,t=e._self._c;return t("div",{staticClass:"indexTable"},[t("div",{staticClass:"query",staticStyle:{"margin-bottom":"15px"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:4}},[t("el-input",{staticClass:"queryText",attrs:{placeholder:"请输入专案名称",clearable:""},on:{change:e.handleQuery},model:{value:e.queryText,callback:function(t){e.queryText=t},expression:"queryText"}})],1),t("el-col",{attrs:{span:4}},[t("el-select",{attrs:{placeholder:"请选择执行状态",clearable:""},on:{change:e.handleQuery},model:{value:e.queryStatus,callback:function(t){e.queryStatus=t},expression:"queryStatus"}},e._l(e.levels,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary"},on:{click:e.handleQuery}},[e._v("搜索 "),t("i",{staticClass:"el-icon-search"})])],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary"},on:{click:e.handleReset}},[e._v("重置 "),t("i",{staticClass:"el-icon-s-tools"})])],1)],1)],1),t("el-table",{attrs:{data:e.pageInfo,border:"",stripe:"","max-height":"600","default-sort":{prop:"doingDay",order:"descending"}}},[t("el-table-column",{attrs:{type:"index",label:"编号",width:"50"}}),t("el-table-column",{attrs:{prop:"name",label:"任务名",width:"260"}}),t("el-table-column",{attrs:{prop:"level",label:"难度"}}),t("el-table-column",{attrs:{prop:"directorName",label:"负责人"}}),t("el-table-column",{attrs:{prop:"startTime",label:"开始时间"}}),t("el-table-column",{attrs:{prop:"presetTime",label:"预计完成时间"}}),t("el-table-column",{attrs:{prop:"finishTime",label:"实际完成时间"}}),t("el-table-column",{attrs:{prop:"planDay",label:"计划天数"}}),t("el-table-column",{attrs:{prop:"doingDay",label:"执行天数"}}),t("el-table-column",{attrs:{prop:"unforcedDay",label:"外界因素延期"}}),t("el-table-column",{attrs:{prop:"curStage",label:"当前阶段"}}),t("el-table-column",{attrs:{prop:"status",label:"执行状态"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{effect:"dark",type:e.showtype(a.row.status),"disable-transitions":""}},[e._v(e._s(e.number2status(a.row.status)))])]}}])}),t("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tooltip",{attrs:{effect:"dark",content:"子流程详情",placement:"top",enterable:!1}},[t("el-button",{attrs:{type:"info",size:"mini",icon:"el-icon-info",round:""},on:{click:function(t){return e.showSub(a.row)}}})],1),t("el-tooltip",{attrs:{effect:"dark",content:"个人详情",placement:"top",enterable:!1}},[t("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-s-custom",round:""},on:{click:function(t){return e.showPerson(a.row)}}})],1)]}}])})],1),t("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"left"},attrs:{"current-page":e.page,"page-sizes":[5,9,10,20],"page-size":e.size,layout:"total, sizes, prev, pager, next",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t}}})],1)},G=[],H={data(){return{pageInfo:[],page:1,size:9,total:0,queryText:"",caseInfo:[],levels:["正在执行","已延误","正常完成","延误完成","中断"],queryStatus:"",queryStartTime:"",queryEndTime:"",timeOptions:{shortcuts:[{text:"最近一个月",onClick(e){const t=new Date;var a=new Date;a.setTime(a.getTime()-2592e6);const s=a.getFullYear(),i=(a.getMonth()+1).toString().padStart(2,"0");a=new Date(`${s}-${i}-01`),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick(e){const t=new Date;var a=new Date;a.setTime(a.getTime()-7776e6);const s=a.getFullYear(),i=(a.getMonth()+1).toString().padStart(2,"0");a=new Date(`${s}-${i}-01`),e.$emit("pick",[a,t])}},{text:"最近半年",onClick(e){const t=new Date;var a=new Date;a.setTime(a.getTime()-15552e6);const s=a.getFullYear(),i=(a.getMonth()+1).toString().padStart(2,"0");a=new Date(`${s}-${i}-01`),e.$emit("pick",[a,t])}},{text:"今年到今天",onClick(e){const t=new Date;var a=new Date;a=a.getFullYear()+"-01-01",a=new Date(a),e.$emit("pick",[a,t])}}]}}},computed:{...(0,k.rn)("caseM",["caseList","queryList"])},created(){var e=+localStorage.getItem("pim_caseTable_pageSize");this.pageSize=0===e?10:e,this.caseInfo=this.caseList,this.getTableDate()},watch:{queryList:{handler(){this.caseInfo=this.queryList}},caseList:{handler(){this.caseInfo=this.caseList}},caseInfo:{handler(){this.getTableDate()}}},methods:{...(0,k.OI)("caseM",["queryCase"]),showSub(e){this.$router.push({name:"case-sub",query:{caseId:e.id,caseName:e.name}})},showPerson(e){this.$router.push({name:"case-person",query:{caseId:e.id,caseName:e.name}})},showtype(e){return 0===e?"primary":1===e?"success":2===e?"danger":3===e?"warning":void 0},number2status(e){return 0===e?"正在执行":1===e?"正常完成":2===e?"已延误":3===e?"延误完成":4===e?"未开始":5===e?"中断":void 0},transformStatus(e){return"正在执行"===e?0:"正常完成"===e?1:"已延误"===e?2:"延误完成"===e?3:"未开始"===e?4:"中断"===e?5:void 0},handleQuery(){var e={};""!==this.queryText&&(e.name=this.queryText),""!==this.queryStatus&&null!==this.queryStatus&&(e.status=this.transformStatus(this.queryStatus)),null!==this.queryStartTime&&""!==this.queryStartTime&&(e.startTime=this.queryStartTime),null!==this.queryEndTime&&""!==this.queryEndTime&&(e.endTime=this.queryEndTime),this.queryCase(e),this.page=1},handleReset(){this.queryCase({}),this.queryText="",this.queryLevel=null},handleSizeChange(e){localStorage.setItem("pim_caseTable_pageSize",e),this.size=e,this.page=1,this.getTableDate()},handleCurrentChange(e){this.page=e,this.getTableDate()},getTableDate(){this.pageInfo=this.caseInfo.slice((this.page-1)*this.size,this.page*this.size),this.total=this.caseInfo.length}}},Z=H,Y=(0,o.Z)(Z,B,G,!1,null,"0111e43b",null),W=Y.exports,X=function(){var e=this,t=e._self._c;return t("el-card",[t("div",{staticClass:"subInfo"},[t("el-page-header",{attrs:{content:e.caseName},on:{back:function(t){return e.$router.back()}}}),t("div",{staticClass:"table"},[t("div",{staticClass:"subTable"},[t("el-table",{attrs:{data:e.subInfo,stripe:"",border:""},on:{"cell-dblclick":e.handleDoubleClick}},[t("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(a.row.chargeName,(function(s,i){return t("el-row",{key:s},[t("el-col",{attrs:{span:4}},[t("el-tag",{staticClass:"chargeNameTag",attrs:{closable:""},on:{close:function(t){return e.removeDirector(a.row.chargeId,i)},click:function(t){return e.getCaseByUserName(a.row.chargeId[i],s)}}},[e._v(" "+e._s(s)+" ")])],1)],1)}))}}])}),t("el-table-column",{attrs:{prop:"subName",label:"子流程",width:"120"}}),t("el-table-column",{attrs:{prop:"number",label:"专案下序号",width:"100"}}),t("el-table-column",{attrs:{prop:"level",label:"难度",width:"50"}}),t("el-table-column",{attrs:{prop:"startTime",label:"开始时间",width:"100"}}),t("el-table-column",{attrs:{prop:"targetTime",label:"阶段目标时间",width:"110"}}),t("el-table-column",{attrs:{prop:"standardTime",label:"目标完成时间",width:"110"}}),t("el-table-column",{attrs:{prop:"ideaTime",label:"预计完成时间",width:"110"}}),t("el-table-column",{attrs:{prop:"finishTime",label:"实际结束时间",width:"110"}}),t("el-table-column",{attrs:{prop:"planDays",label:"计划时间",width:"110"}}),t("el-table-column",{attrs:{prop:"unforcedDays",label:"外界因素延期",width:"110"}}),t("el-table-column",{attrs:{prop:"applyDelay",label:"人为因素延期",width:"110"}}),t("el-table-column",{attrs:{prop:"status",label:"执行状态",width:"100",filters:[{text:"正在执行",value:"正在执行"},{text:"正常完成",value:"正常完成"},{text:"已延误",value:"已延误"},{text:"延误完成",value:"延误完成"}],"filter-method":e.filterTag,"filter-placement":"bottom-end"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e.showtype(a.row.status),"disable-transitions":""}},[e._v(e._s(e.number2status(a.row.status)))])]}}])}),t("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tooltip",{attrs:{effect:"dark",content:"查看备注",placement:"top",enterable:!1}},[t("el-button",{attrs:{type:"info",size:"mini",icon:"el-icon-info",round:""},on:{click:function(t){return e.openCommitView(a.row)}}})],1),null===a.row.startTime?t("el-tooltip",{attrs:{effect:"dark",content:"开始阶段",placement:"top",enterable:!1}},[t("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-success",round:""},on:{click:function(t){return e.openCommitView(a.row)}}})],1):e._e(),t("el-tooltip",{attrs:{effect:"dark",content:"编辑阶段",placement:"top",enterable:!1}},[t("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit",round:""},on:{click:function(t){return e.openCommitView(a.row)}}})],1)]}}])})],1)],1),t("el-drawer",{attrs:{visible:e.drawer,direction:e.direction,size:"50%"},on:{"update:visible":function(t){e.drawer=t}}},[t("div",{staticClass:"userCase",attrs:{border:""}},[t("div",{staticClass:"chargeInfo"},[t("label",{staticClass:"chargeName"},[e._v(e._s(e.chargeName))])]),t("el-table",{attrs:{data:e.userInfo}},[t("el-table-column",{attrs:{prop:"caseName",label:"专案名称",width:"245"}}),t("el-table-column",{attrs:{prop:"subName",label:"阶段名称",width:"80"}}),t("el-table-column",{attrs:{prop:"startTime",label:"开始时间",width:"100"}}),t("el-table-column",{attrs:{prop:"presetTime",label:"预计完成时间",width:"110"}}),t("el-table-column",{attrs:{prop:"deadLine",label:"延期/截止",width:"110"}}),t("el-table-column",{attrs:{prop:"status",label:"执行状态",width:"100",filters:[{text:"正在执行",value:"正在执行"},{text:"已完成",value:"已完成"},{text:"已延误",value:"已延误"},{text:"延误完成",value:"延误完成"}],"filter-method":e.filterTag,"filter-placement":"bottom-end"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e.showtype(a.row.status),"disable-transitions":""}},[e._v(e._s(e.number2status(a.row.status)))])]}}])})],1)],1)]),t("el-drawer",{attrs:{visible:e.delayDrawer,direction:e.direction,size:"50%"},on:{"update:visible":function(t){e.delayDrawer=t}}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.delayList,border:""}},[t("el-table-column",{attrs:{prop:"caseName",label:"专案",width:"240"}}),t("el-table-column",{attrs:{prop:"subName",label:"阶段",width:"100"}}),t("el-table-column",{attrs:{prop:"type",label:"延期类型",width:"120"}}),t("el-table-column",{attrs:{prop:"applyReason",label:"延期原因"}}),t("el-table-column",{attrs:{prop:"applyDays",label:"申请天数",width:"80"}}),t("el-table-column",{attrs:{prop:"predictTime",label:"预计完成时间",width:"120"}})],1)],1),t("el-dialog",{attrs:{title:"备注信息",visible:e.commitVisible,width:"30%"},on:{"update:visible":function(t){e.commitVisible=t},close:e.closeCommitDialog}},[t("el-form",{ref:"commitFormRef",attrs:{model:e.commitForm,rules:e.rules}},[t("el-form-item",{attrs:{label:"子流程："}},[t("el-form-item",{attrs:{label:e.commitForm.subName}})],1),t("el-form-item",{attrs:{label:"备注信息"}}),t("el-form-item",[t("el-card",{staticClass:"box-card"},[e._l(e.commitForm.content,(function(a){return t("div",{key:a,staticClass:"text item"},[e._v(" "+e._s(a)+" ")])})),0===e.commitForm.content.length?t("label",[e._v("暂无备注")]):e._e()],2)],1),1===e.user.type||-1!==e.chargeId.indexOf(e.user.id)?t("el-form-item",{attrs:{prop:"newContent",label:"增加备注:"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.commitForm.newContent,callback:function(t){e.$set(e.commitForm,"newContent",t)},expression:"commitForm.newContent"}})],1):e._e()],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[1===e.user.type||-1!==e.chargeId.indexOf(e.user.id)?t("el-button",{attrs:{type:"primary"},on:{click:e.submitCommitForm}},[e._v("提交")]):e._e(),t("el-button",{on:{click:function(t){e.commitVisible=!1}}},[e._v("取 消")])],1)],1)],1)],1)])},Q=[],J=a(8345),K=function(){var e=this,t=e._self._c;return t("el-container",{staticClass:"home-container"},[t("el-header",[t("img",{attrs:{src:a(7842),alt:""}}),t("span",[e._v("新技研进度管理系统"),t("span",{staticStyle:{"font-size":"10px"}},[e._v("(测试版)")])]),t("el-button",{attrs:{round:"",size:"medium"},on:{click:function(t){return e.handleLogout()}}},[e._v(" "+e._s(null===e.user?"":e.user.name)+" "),t("i",{staticClass:"el-icon-switch-button"})])],1),t("el-container",[e.user.status<=2?t("el-aside",{staticStyle:{"margin-left":"-10px"},attrs:{width:e.isCollapse?"55px":"200px"}},[t("div",{staticClass:"toggle-button",on:{click:e.toggleCollapse}},[e.isCollapse?t("i",{staticClass:"el-icon-right",staticStyle:{"margin-left":"10px"}}):t("i",{staticClass:"el-icon-back"})]),t("PIMAside",{attrs:{isCollapse:e.isCollapse}})],1):e._e(),t("el-main",[t("div",{staticStyle:{"margin-bottom":"10px","margin-top":"-10px"}},[t("NavigationBar")],1),t("keep-alive",{attrs:{include:["indexPage","userStatistics","caseTracking","checkException","caseAnalysis","caseManage"]}},[t("router-view")],1)],1)],1)],1)},ee=[];const te=e=>ur.post("/user/login",e),ae=()=>ur.post("/user/logout");var se={components:{NavigationBar:O},data(){return{isCollapse:!1}},created(){},computed:{...(0,k.rn)(["user"])},methods:{toggleCollapse(){this.isCollapse=!this.isCollapse},...(0,k.OI)(["setUser"]),async handleLogout(){this.setUser({}),localStorage.removeItem("token"),await ae(),this.$message.success({message:"登出成功",duration:1e3})}}},ie=se,re=(0,o.Z)(ie,K,ee,!1,null,"fbe2f75c",null),le=re.exports,ne=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login_container"},[t("div",{staticClass:"loginInfo"},[e._m(0),e._m(1),t("el-form",{ref:"loginFormRef",staticClass:"login_form",attrs:{"label-width":"0px",rules:e.rules,model:e.loginForm}},[t("el-form-item",{attrs:{prop:"number"}},[t("el-input",{attrs:{"prefix-icon":"el-icon-user-solid",placeholder:"请输入工号"},model:{value:e.loginForm.number,callback:function(t){e.$set(e.loginForm,"number",t)},expression:"loginForm.number"}})],1),t("el-form-item",{attrs:{prop:"password"}},[t("el-input",{attrs:{type:"password","prefix-icon":"el-icon-s-cooperation",placeholder:"请输入密码"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handlerLogin.apply(null,arguments)}},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}})],1),t("el-form-item",[t("div",{staticClass:"btns"},[t("el-row",[t("el-col",{attrs:{span:1}},[t("el-checkbox",{model:{value:e.rememberPsw,callback:function(t){e.rememberPsw=t},expression:"rememberPsw"}},[e._v("记住密码")])],1),t("el-col",{attrs:{span:6,offset:14}},[t("el-button",{attrs:{type:"warning"},on:{click:e.visitLogin}},[e._v("游客访问")])],1),t("el-col",{attrs:{span:3}},[t("el-button",{attrs:{type:"primary"},on:{click:e.handlerLogin}},[e._v("登录")])],1)],1)],1)])],1)],1)])},oe=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"avatar_box"},[t("img",{attrs:{src:a(6949),alt:"",srcset:""}})])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"title",staticStyle:{"text-align":"center"}},[t("span",[e._v("新技研进度管理系统")])])}],ce={data(){var e=(e,t,a)=>/^\d{6}$/.test(t)?a():a(new Error("工号是6位纯数字"));return{loginForm:{number:"",password:""},rules:{number:[{required:!0,message:"工号不能为空",trigger:"blur"},{validator:e,trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"}]},rememberPsw:!1}},created(){null!==localStorage.getItem("userLogin")&&(this.loginForm=JSON.parse(localStorage.getItem("userLogin")),null!==this.loginForm.password&&(this.rememberPsw=!0))},methods:{...(0,k.OI)(["setUser"]),async handlerLogin(){this.$refs.loginFormRef.validate((async e=>{if(!e)return;const t=await te(this.loginForm);200==t.code?(this.rememberPsw||(this.loginForm.password=null),localStorage.setItem("userLogin",JSON.stringify(this.loginForm)),this.setUser(t.data),localStorage.setItem("token",t.data.id),this.$message({message:"登录成功",type:"success",duration:900}),1===t.data.type?setTimeout((()=>this.$router.push("/admin/index")),1e3):setTimeout((()=>this.$router.push("/user/index")),1e3)):this.$message.error(t.msg)}))},async visitLogin(){const e=await te({number:888888,password:123456});200==e.code&&(this.$message({message:"登录成功",type:"success",duration:900}),this.setUser(e.data),localStorage.setItem("token",e.data.id),setTimeout((()=>this.$router.push("/common/index")),1e3))}}},ue=ce,pe=(0,o.Z)(ue,ne,oe,!1,null,"0cb587c5",null),de=pe.exports,he=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"layoutError"}},[t("div",{attrs:{id:"layoutError_content"}},[t("main",[t("div",{staticClass:"container"},[t("div",{staticClass:"row justify-content-center"},[t("div",{staticClass:"col-lg-6"},[t("div",{staticClass:"text-center mt-4"},[t("img",{staticClass:"mb-4 img-error",attrs:{src:a(4296)}}),t("p",{staticClass:"lead"},[e._v("您请求的页面不见了，请检查路径.")]),t("router-link",{attrs:{to:"/common/index"}},[t("i",{staticClass:"fas fa-arrow-left me-1"}),e._v(" 返回主页 ")])],1)])])])])]),e._m(0)])},me=[function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"layoutError_footer"}},[t("footer",{staticClass:"py-4 bg-light mt-auto"},[t("div",{staticClass:"container-fluid px-4"},[t("div",{staticClass:"d-flex align-items-center justify-content-between small"},[t("div",{staticClass:"text-muted"},[e._v("Copyright © UDE 2023")]),t("div",[t("a",{attrs:{href:"#"}},[e._v("Privacy Policy")]),e._v(" · "),t("a",{attrs:{href:"#"}},[e._v("Terms & Conditions")])])])])])])}],be={},fe=be,ye=(0,o.Z)(fe,he,me,!1,null,null,null),ge=ye.exports,ve=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"layoutError"}},[t("div",{attrs:{id:"layoutError_content"}},[t("main",[t("div",{staticClass:"container"},[t("div",{staticClass:"row justify-content-center"},[t("div",{staticClass:"col-lg-6"},[t("div",{staticClass:"text-center mt-4"},[t("img",{staticClass:"mb-4 img-error",attrs:{src:a(4296)}}),t("p",{staticClass:"lead"},[e._v("您请求的正在开发中，暂停访问")]),t("p",{staticClass:"lead"},[e._v("如有访问需要，请直接联系余博")]),t("el-button",{attrs:{round:"",type:"primary"},on:{click:function(t){return e.$router.back()}}},[t("i",{staticClass:"fas fa-arrow-left me-1"}),e._v(" 返回 ")])],1)])])])])]),e._m(0)])},we=[function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"layoutError_footer"}},[t("footer",{staticClass:"py-4 bg-light mt-auto"},[t("div",{staticClass:"container-fluid px-4"},[t("div",{staticClass:"d-flex align-items-center justify-content-between small"},[t("div",{staticClass:"text-muted"},[e._v("Copyright © Your Website 2023")]),t("div",[t("a",{attrs:{href:"#"}},[e._v("Privacy Policy")]),e._v(" · "),t("a",{attrs:{href:"#"}},[e._v("Terms & Conditions")])])])])])])}],ke={},Te=ke,Se=(0,o.Z)(Te,ve,we,!1,null,null,null),xe=Se.exports,Ce=function(){var e=this,t=e._self._c;return t("div",{staticClass:"main-container"},[t("div",{staticClass:"top-area"},[t("el-card",{staticClass:"charts-container"},[t("h4",[e._v("专案图表")]),t("div",{staticStyle:{width:"100%",height:"300px"},attrs:{id:"barCharts"}}),t("div",{staticStyle:{display:"flex"}},[t("div",{staticStyle:{width:"50%",height:"300px"},attrs:{id:"subCharts"}}),t("div",{staticStyle:{width:"50%",height:"300px"},attrs:{id:"caseCharts"}})])]),t("el-card",{staticClass:"calendar-container"},[t("h4",[e._v("专案日历")]),t("el-calendar",{scopedSlots:e._u([{key:"dateCell",fn:function({data:a}){return[t("div",{staticStyle:{width:"100%",height:"100%","font-size":"25px","text-align":"center","line-height":"70px"},style:{"background-color":e.isFinishDay(a.day)?"skyblue":e.isSunDay(a.day)?"#5BEE58":"white"}},[e.isFinishDay(a.day)?t("el-tooltip",{attrs:{placement:"top"},scopedSlots:e._u([{key:"content",fn:function(){return[t("div",{staticStyle:{"font-size":"15px"},domProps:{innerHTML:e._s(e.tooltipContent(a.day))}})]},proxy:!0}],null,!0)},[t("p",{staticStyle:{color:"#F13E32"}},[e._v(e._s(e.CurformatDate(a.day)+"★"))])]):e.isToday(a.day)?t("el-tooltip",{attrs:{content:"就在今天!",placement:"top"}},[t("p",[e._v(e._s(e.CurformatDate(a.day)+"✔️"))])]):t("p",[e._v(" "+e._s(e.CurformatDate(a.day))+" ")])],1)]}}])})],1)],1),t("div",{staticClass:"table-container"},[t("el-card",{staticClass:"executing-container"},[t("h4",[t("i",{staticClass:"el-icon-s-flag"}),e._v("执行清单")]),t("el-table",{staticStyle:{"font-size":"15px"},attrs:{data:e.executingList}},[t("el-table-column",{attrs:{type:"index"}}),t("el-table-column",{attrs:{prop:"caseName",label:"专案",align:"center",width:"260"}}),t("el-table-column",{attrs:{prop:"subName",label:"阶段",align:"center"}}),t("el-table-column",{attrs:{prop:"userNames",label:"负责人",width:"220",align:"center"}}),t("el-table-column",{attrs:{prop:"startTime",label:"开始时间",align:"center",width:"100"}}),t("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{icon:"el-icon-position",type:"primary",round:"",size:"mini"},on:{click:function(t){return e.redirectToDetailPage(a.row)}}})]}}])})],1)],1),t("div",{staticClass:"exception-container"},[t("el-card",{staticClass:"delay-container"},[t("h4",[t("i",{staticClass:"el-icon-error"}),e._v("延误清单")]),t("el-table",{attrs:{data:e.delayList}},[t("el-table-column",{attrs:{type:"index",width:"20"}}),t("el-table-column",{attrs:{prop:"caseName",label:"专案",width:"250"}}),t("el-table-column",{attrs:{prop:"subName",label:"阶段"}}),t("el-table-column",{attrs:{prop:"userNames",label:"负责人"}}),t("el-table-column",{attrs:{prop:"delayDays",label:"已延期(天)"}}),t("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{icon:"el-icon-position",type:"danger",round:"",size:"mini"},on:{click:function(t){return e.redirectToDetailPage(a.row)}}})]}}])})],1)],1),t("el-card",{staticClass:"pause-container"},[t("h4",[t("i",{staticClass:"el-icon-video-pause"}),e._v("暂停清单")]),t("el-table",{attrs:{data:e.pausingList}},[t("el-table-column",{attrs:{type:"index",width:"20"}}),t("el-table-column",{attrs:{prop:"caseName",label:"专案",width:"250"}}),t("el-table-column",{attrs:{prop:"subName",label:"阶段"}}),t("el-table-column",{attrs:{prop:"userNames",label:"负责人",width:"150"}}),t("el-table-column",{attrs:{prop:"pauseStart",label:"暂停于",width:"100"}}),t("el-table-column",{attrs:{label:"已暂停"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(`${t.row.pauseDays} 天`)+" ")]}}])}),t("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:a.row.pauseDesc,placement:"top"}},[t("el-button",{attrs:{icon:"el-icon-position",type:"info",round:"",size:"mini"},on:{click:function(t){return e.redirectToDetailPage(a.row)}}})],1)]}}])})],1)],1)],1)],1)])},De=[];const Ie=e=>ur.get("case/dtoList",{params:{isFinished:e}}),_e=e=>ur.get("case/list",{params:e}),Le=e=>ur.post("case",e),Fe=e=>ur.put("case",e),Oe=e=>ur.delete(`/case/${e}`),je=()=>ur.get("/case/unFinishedCaseList"),Ae=e=>ur.put("/case/terminateCase",e);var ze={name:"admin-index",data(){return{executingList:[],delayList:[],pausingList:[],barCharts:null,caseSubFinishInfo:[],caseCharts:null,caseExecutingInfo:[],subCharts:null,subExecutingInfo:[],casePieObj:{executing:0,notStart:0,interrupt:0,delay:0}}},async created(){await this.getExecutingList(),await this.getHalfYearFinishCaseSubAmount(),await this.getCaseList(),this.barCharts=this.$echarts.init(document.getElementById("barCharts")),this.subCharts=this.$echarts.init(document.getElementById("subCharts")),this.caseCharts=this.$echarts.init(document.getElementById("caseCharts")),this.initBar(),this.initSubPie(),this.initCasePie()},computed:{...(0,k.rn)("apply",["subList"])},methods:{async getHalfYearFinishCaseSubAmount(){const e=await Ir();this.caseSubFinishInfo=e.data},initBar(){var e={title:{text:"近半年完成子流程统计"},xAxis:{axisLabel:{fontSize:15},data:this.caseSubFinishInfo.map((e=>e.date))},yAxis:{},grid:{containLabel:!0,show:!1,left:0,right:0},tooltip:{trigger:"axis",formatter:function(e){var t='<div style="display:inline-block;margin-right:5px;border-radius:50%;width:10px;height:10px;background-color:'+e[0].color+';"></div>';return t+=e[0].axisValue+"月完成"+e[0].value+"项",t}},series:[{type:"bar",data:this.caseSubFinishInfo.map((e=>e.amount))},{type:"line",data:this.caseSubFinishInfo.map((e=>e.amount)),label:{show:!0,fontSize:15}}]};this.barCharts.setOption(e)},initSubPie(){var e={title:{text:"阶段执行状况总览"},grid:{containLabel:!0,show:!1,top:0,left:0},tooltip:{trigger:"item",textStyle:{fontSize:18},formatter:function(e){var t="";return t+=e.name+": "+e.value+"项,占比"+e.percent+"% ",t}},series:[{type:"pie",radius:["50%","70%"],data:[{name:"正在执行",value:this.executingList.length},{name:"延误",value:this.delayList.length},{name:"暂停",value:this.pausingList.length}],label:{show:!0,fontSize:15},itemStyle:{color:function(e){return"正在执行"===e.data.name?"#7EDB4B":"延误"===e.data.name?"#D73B0F":"暂停"===e.data.name?"#7A929C":void 0}}}]};this.subCharts.setOption(e)},async getCaseList(){var e=await Ie(!1);this.caseExecutingInfo=e.data;for(var t=0;t<this.caseExecutingInfo.length;t++)null===this.caseExecutingInfo[t].startTime?this.casePieObj.notStart++:this.caseExecutingInfo[t].executionDays>this.caseExecutingInfo[t].planDay?this.casePieObj.delay++:this.isInterrupt(this.caseExecutingInfo[t])?this.casePieObj.interrupt++:this.casePieObj.executing++},isInterrupt(e){for(var t=0;t<this.subList.length;t++)if(e.name===this.subList[t].caseName)return!0;return!1},initCasePie(){var e={title:{text:"专案执行状况总览"},grid:{containLabel:!0,show:!1,top:0,left:0},tooltip:{trigger:"item",textStyle:{fontSize:18},formatter:function(e){var t="";return t+=e.name+": "+e.value+"项,占比"+e.percent+"% ",t}},series:[{type:"pie",radius:["50%","70%"],data:[{name:"正在执行",value:this.casePieObj.executing},{name:"延误",value:this.casePieObj.delay},{name:"中断",value:this.casePieObj.interrupt},{name:"未开始",value:this.casePieObj.notStart}],label:{show:!0,fontSize:15},itemStyle:{color:function(e){return"正在执行"===e.data.name?"#2c7be5":"延误"===e.data.name?"#D73B0F":"中断"===e.data.name?"#ff8c44":"未开始"===e.data.name?"#27bcfd":void 0}}}]};this.caseCharts.setOption(e)},async getExecutingList(){const e=await Dr();this.executingList=e.data,this.executingList.forEach((e=>{e.presetTime=Or(e.startTime,e.planDays,+e.unforcedDays,+e.applyDelay),e.pausing?(e.pauseStart=Lr(e.pauseStart),e.pauseDays=jr(e.pauseStart,new Date),this.pausingList.push(e)):e.presetTime<Lr(new Date)&&(e.delayDays=jr(e.presetTime,new Date)-1,this.delayList.push(e))})),this.executingList=this.executingList.filter((e=>!e.pausing)),this.executingList=this.executingList.filter((e=>e.presetTime>=Lr(new Date))),this.executingList.sort(((e,t)=>new Date(t.startTime)-new Date(e.startTime))),this.pausingList.sort(((e,t)=>t.pauseDays-e.pauseDays)),this.delayList.sort(((e,t)=>t.delayDays-e.delayDays))},redirectToDetailPage(e){this.$router.push({name:"子流程详情",query:{caseId:e.caseId,caseName:e.caseName}})},isSunDay(e){return e=new Date(e),0===e.getDay()},CurformatDate(e){var t=e.split("-");return 1===+t[2]?t[1]+"月":+t[2]},isToday(e){const t=(new Date).toISOString().slice(0,10);return e===t},isFinishDay(e){var t="";for(let a=0;a<this.executingList.length;a++)Or(this.executingList[a].presetTime)===e&&(t+=this.executingList[a].description,t+="\n");return t},tooltipContent(e){const t=this.isFinishDay(e);return t.replace(/\n/g,"<br>")}}},$e=ze,Re=(0,o.Z)($e,Ce,De,!1,null,"e98e9a2a",null),Ve=Re.exports,qe=function(){var e=this,t=e._self._c;return t("div",{staticClass:"index",staticStyle:{"text-align":"center"}},[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",[e._v("专案详情")])],1)],1),t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"indexTable"},[t("div",{staticClass:"query",staticStyle:{"margin-bottom":"15px"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:4}},[t("el-input",{staticClass:"queryText",attrs:{placeholder:"请输入专案名称",clearable:""},on:{change:e.handleQuery},model:{value:e.queryText,callback:function(t){e.queryText=t},expression:"queryText"}})],1),e.showMode?e._e():t("el-col",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{span:4}},[t("el-select",{attrs:{placeholder:"请选择执行状态",clearable:""},on:{change:e.handleQuery},model:{value:e.queryStatus,callback:function(t){e.queryStatus=t},expression:"queryStatus"}},e._l(e.levels,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("el-col",{attrs:{span:4}},[t("el-select",{attrs:{placeholder:"请选择负责人",clearable:""},on:{change:e.handleQuery},model:{value:e.queryDirector,callback:function(t){e.queryDirector=t},expression:"queryDirector"}},e._l(e.users,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e.showMode?t("el-col",{attrs:{span:6}},[t("el-date-picker",{attrs:{type:"daterange",align:"left","unlink-panels":"","range-separator":"——","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.timeOptions,"value-format":"yyyy-MM-dd"},model:{value:e.start_stop_time,callback:function(t){e.start_stop_time=t},expression:"start_stop_time"}})],1):e._e(),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary"},on:{click:e.handleQuery}},[e._v("搜索 "),t("i",{staticClass:"el-icon-search"})])],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary"},on:{click:e.handleReset}},[e._v("重置 "),t("i",{staticClass:"el-icon-s-tools"})])],1),t("el-col",{attrs:{span:3,offset:e.showMode?3:9}},[t("el-switch",{attrs:{"active-text":"已完成","inactive-text":"正在执行"},model:{value:e.showMode,callback:function(t){e.showMode=t},expression:"showMode"}})],1)],1)],1),t("div",{ref:"caseTableRef"},[t("el-table",{staticStyle:{"font-size":"15px"},attrs:{data:e.pageInfo,border:"",stripe:""},on:{"cell-dblclick":e.handleDoubleClick}},[t("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tooltip",{attrs:{effect:"dark",content:"子流程详情",placement:"top",enterable:!1}},[t("el-button",{attrs:{type:"info",size:"mini",icon:"el-icon-info",round:""},on:{click:function(t){return e.showSub(a.row)}}})],1),t("el-tooltip",{attrs:{effect:"dark",content:"个人详情",placement:"top",enterable:!1}},[t("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-s-custom",round:""},on:{click:function(t){return e.showPerson(a.row)}}})],1)]}}])}),t("el-table-column",{attrs:{prop:"name",label:"任务名",width:"260"}}),t("el-table-column",{attrs:{prop:"curStage",label:"当前阶段"}}),t("el-table-column",{attrs:{prop:"level",label:"难度"}}),t("el-table-column",{attrs:{prop:"directorName",label:"负责人"}}),t("el-table-column",{attrs:{prop:"startTime",label:"开始时间"}}),t("el-table-column",{attrs:{prop:"presetTime",label:"预计完成时间"}}),t("el-table-column",{attrs:{prop:"finishTime",label:"实际完成时间"}}),t("el-table-column",{attrs:{prop:"planDay",label:"计划天数"}}),t("el-table-column",{attrs:{prop:"executionDays",label:"执行天数"}}),t("el-table-column",{attrs:{prop:"unforcedDay",label:"外界因素延期"}}),t("el-table-column",{attrs:{prop:"status",label:"执行状态"},scopedSlots:e._u([{key:"default",fn:function(a){return[null===a.row.startTime?t("el-tag",{staticStyle:{"font-size":"15px"},attrs:{effect:"dark",type:"info",size:"small"}},[e._v("未开始")]):e.isInterrupt(a.row)?t("el-tag",{staticStyle:{"font-size":"15px"},attrs:{effect:"dark",type:"warning",size:"small"}},[e._v("中断")]):null!==a.row.finishTime&&a.row.executionDays>a.row.planDay?t("el-tag",{staticStyle:{"font-size":"15px"},attrs:{effect:"dark",type:"warning",size:"small"}},[e._v("延误完成")]):null!==a.row.finishTime&&a.row.executionDays<=a.row.planDay?t("el-tag",{staticStyle:{"font-size":"15px"},attrs:{effect:"dark",type:"primary",size:"small"}},[e._v("正常完成")]):a.row.executionDays>a.row.planDay?t("el-tag",{staticStyle:{"font-size":"15px"},attrs:{effect:"dark",type:"danger",size:"small"}},[e._v("已延误")]):t("el-tag",{staticStyle:{"font-size":"15px"},attrs:{effect:"dark",type:"success",size:"small"}},[e._v("执行中")])]}}])})],1)],1),t("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"left"},attrs:{"current-page":e.page,"page-sizes":[5,9,10,15,20,30],"page-size":e.size,layout:"total, sizes, prev, pager, next",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t}}})],1)]),t("el-dialog",{attrs:{title:"备注信息",visible:e.commitVisible,width:"45%"},on:{"update:visible":function(t){e.commitVisible=t},close:function(t){return e.$refs.commitFormRef.resetFields()}}},[t("el-form",{ref:"commitFormRef",attrs:{model:e.commitForm,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"专案"}},[t("el-input",{attrs:{disabled:""},model:{value:e.commitForm.caseName,callback:function(t){e.$set(e.commitForm,"caseName",t)},expression:"commitForm.caseName"}})],1),t("el-form-item",{attrs:{label:"流程名"}},[t("el-input",{attrs:{disabled:""},model:{value:e.commitForm.subName,callback:function(t){e.$set(e.commitForm,"subName",t)},expression:"commitForm.subName"}})],1),t("el-form-item",{attrs:{label:"备注信息"}},[t("el-card",{staticClass:"box-card"},[e._l(e.commitForm.content,(function(a,s){return t("div",{key:a.id,staticClass:"text item"},[t("span",{style:{color:0===s?"red":"black"}},[e._v(e._s(a.content))]),t("el-button",{attrs:{icon:"el-icon-delete",size:"mini",round:"",type:"danger"},on:{click:function(t){return e.deleteCommit(a.id)}}})],1)})),0===e.commitForm.content.length?t("label",[e._v("暂无备注")]):e._e()],2)],1),1===e.user.type||2===e.user.status?t("el-form-item",{attrs:{prop:"newContent",label:"增加备注"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.commitForm.newContent,callback:function(t){e.$set(e.commitForm,"newContent",t)},expression:"commitForm.newContent"}})],1):e._e()],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[1===e.user.type||2===e.user.status?t("el-button",{attrs:{type:"primary"},on:{click:e.submitCommitForm}},[e._v("提交")]):e._e(),t("el-button",{on:{click:function(t){e.commitVisible=!1}}},[e._v("取 消")])],1)],1)],1)},Ue=[];const Ne=e=>ur.get(`/caseSubComment/${e}`),Pe=e=>ur.post("/caseSubComment",{...e}),Ee=e=>ur.delete(`/caseSubComment/${e}`),Me=()=>ur.get("/user/userListWithAssistants"),Be=e=>ur.get("/user/page",{params:e}),Ge=e=>ur.post("/user",e),He=e=>ur.get(`/user/${e}`),Ze=e=>ur.put("/user",e),Ye=e=>ur.delete(`/user/${e}`),We=e=>ur.get(`user/${e}/status`),Xe=e=>ur.put("/user/password",e);var Qe=a(1120),Je=a.n(Qe),Ke={name:"indexPage",data(){return{pageInfo:[],page:1,size:9,total:0,queryText:"",caseInfo:[],levels:["正在执行","已延误"],queryStatus:"",queryDirector:null,commitVisible:!1,commitForm:{caseName:"",subName:"",content:[],newContent:"",caseSubId:null},rules:{newContent:[{required:!0,message:"备注不能为空",trigger:"blur"},{min:8,max:255,message:"备注应该大于8个字符，小于255个字符",trigger:"blur"}]},showMode:!1,start_stop_time:"",timeOptions:{shortcuts:[{text:"最近一月",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}},{text:"最近半年",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-15552e6),e.$emit("pick",[a,t])}},{text:"最近一年",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-31536e6),e.$emit("pick",[a,t])}}]},users:[],executingList:[]}},async created(){await this.getCaseList(this.showMode),this.caseInfo=this.caseList,this.getTableDate(),this.getAllUser(),this.getExecutingList()},mounted(){var e=+JSON.parse(localStorage.getItem("pim_caseTable_pageSize"));this.size=0===e?10:e},watch:{queryList:{handler(){this.caseInfo=this.queryList}},caseList:{handler(){this.caseInfo=this.caseList}},caseInfo:{handler(){this.getTableDate()}},showMode:{handler(){this.getCaseList(this.showMode),this.getTableDate()}}},computed:{...(0,k.rn)("caseM",["caseList","queryList"]),...(0,k.rn)(["user"]),...(0,k.rn)("apply",["subList"])},beforeRouteEnter(e,t,a){a((t=>{"caseName"in e.query&&(t.queryText=e.query.caseName,t.handleQuery())}))},methods:{...(0,k.nv)("caseM",["getCaseList"]),...(0,k.OI)("caseM",["queryCase"]),async getExecutingList(){const e=await Dr();200===e.code&&(this.executingList=e.data,this.executingList.forEach((e=>e.presetTime=Or(e.startTime,e.planDays,+e.unforcedDays,+e.applyDelay))))},async getAllUser(){const e=await Me();200===e.code&&(this.users=e.data)},showSub(e){this.$router.push({name:"子流程详情",query:{caseId:e.id,caseName:e.name}})},showPerson(e){this.$router.push({name:"专案个人详情",query:{caseId:e.id,caseName:e.name,planDay:e.planDay,executionDays:e.executionDays}})},transformStatus(e){return"正在执行"===e?0:"正常完成"===e?1:"已延误"===e?2:"延误完成"===e?3:"未开始"===e?4:"中断"===e?5:void 0},handleQuery(){var e={};""!==this.queryText&&(e.name=this.queryText),this.showMode||""===this.queryStatus||null===this.queryStatus||(e.status=this.transformStatus(this.queryStatus)),this.showMode&&null!==this.start_stop_time&&""!==this.start_stop_time&&(e.startTime=this.start_stop_time[0],e.endTime=this.start_stop_time[1]),null!==this.queryDirector&&""!==this.queryDirector&&(e.director=this.queryDirector),this.queryCase(e),this.page=1},handleReset(){this.queryCase({}),this.queryText="",this.start_stop_time=""},handleSizeChange(e){localStorage.setItem("pim_caseTable_pageSize",JSON.stringify(e)),this.size=e,this.page=1,this.getTableDate()},handleCurrentChange(e){this.page=e,this.getTableDate()},getTableDate(){this.pageInfo=this.caseInfo.slice((this.page-1)*this.size,this.page*this.size),this.total=this.caseInfo.length},async handleDoubleClick(e,t){"当前阶段"!==t.label||this.showMode||(this.commitForm.caseName=e.name,this.commitForm.subName=e.curStage,this.commitForm.caseSubId=e.curStageId,this.getAndShowCommit())},async getAndShowCommit(){var e=await Ne(this.commitForm.caseSubId);e=e.data,this.commitForm.content=[];for(var t=0;t<e.length;t++)this.commitForm.content.push({content:e[t].content,id:e[t].id});this.commitVisible=!0},async submitCommitForm(){this.$refs.commitFormRef.validate((async e=>{if(!e)return;const t={};t.caseSubId=this.commitForm.caseSubId,t.content=this.commitForm.newContent,t.createUser=this.user.id;var a=await Pe(t);this.$message(a.data),this.commitVisible=!1}))},deleteCommit(e){this.$confirm("此操作将删除该评论, 操作不可逆，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await Ee(e);200===t.code?(this.$message.success(t.data),this.getAndShowCommit()):this.$message.error(t.msg)}))},isInterrupt(e){for(var t=0;t<this.subList.length;t++)if(e.name===this.subList[t].caseName)return!0;return!1},async captureScreenshot(){const e=this.$refs.caseTableRef;await Je()(e).then((e=>{const t=e.toDataURL(),a=new Image;a.src=t;const s=window.open();s.document.write('<img src="'+a.src+'" />')}))}}},et=Ke,tt=(0,o.Z)(et,qe,Ue,!1,null,"39675910",null),at=tt.exports,st=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",[e._v("专案管理")]),t("el-breadcrumb-item",{attrs:{to:{path:"/index"}}},[e._v("主页")]),t("el-breadcrumb-item",[e._v(e._s(e.caseName))])],1)],1),t("el-card",[t("div",{staticStyle:{"margin-bottom":"10px"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:6}},[t("el-page-header",{attrs:{content:e.caseName},on:{back:function(t){return e.$router.back()}}})],1),t("el-col",{attrs:{span:2,offset:8}},[t("el-statistic",{attrs:{value:e.planDay,title:"计划时长(天)"}})],1),t("el-col",{attrs:{span:3}},[t("el-statistic",{attrs:{value:e.executionDays,title:"执行时间(天)"}})],1)],1)],1),t("el-table",{attrs:{"cell-style":e.setCellColor,data:e.case2person,"span-method":e.objectSpanMethod,border:""}},[t("el-table-column",{attrs:{prop:"userName",label:"姓名"}}),t("el-table-column",{attrs:{prop:"subName",label:"子流程"}}),t("el-table-column",{attrs:{prop:"level",label:"难度"}}),t("el-table-column",{attrs:{prop:"value",label:"积分"}}),t("el-table-column",{attrs:{prop:"startTime",label:"开始时间"}}),t("el-table-column",{attrs:{prop:"finishTime",label:"结束时间"}}),t("el-table-column",{attrs:{prop:"planDays",label:"计划时间"}}),t("el-table-column",{attrs:{prop:"executionDays",label:"执行天数"}}),t("el-table-column",{attrs:{label:"执行状态"},scopedSlots:e._u([{key:"default",fn:function(a){return[0===a.row.status?t("el-tag",{attrs:{effect:"dark"}},[e._v("正在执行")]):1===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v("正常完成")]):2===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"danger"}},[e._v("已延误")]):3===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"warning"}},[e._v("延误完成")]):4===a.row.status?t("el-tag",{attrs:{effect:"dark"}},[e._v("未开始")]):e._e()]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"计算并复制个人总积分",placement:"top"}},[t("el-button",{staticClass:"copy-button",attrs:{type:"primary",icon:"el-icon-copy-document",round:""},on:{click:function(t){return e.computeSumValue(a.$index)}}})],1)]}}])})],1)],1)],1)},it=[],rt=a(2152),lt=a.n(rt),nt={name:"casePersonView",data(){return{case2person:[],caseId:null,caseName:null,planDay:null,executionDays:null}},created(){this.caseId=this.$route.query.caseId,this.caseName=this.$route.query.caseName,this.planDay=this.$route.query.planDay,this.executionDays=this.$route.query.executionDays,this.listFocusPerson(this.caseId)},methods:{async listFocusPerson(e){const t=await dr(e);if(200===t.code){this.case2person=t.data;var a=!1;for(let e=0;e<this.case2person.length;e++)if(31===this.case2person[e].subId){a=!0;break}for(var s=0;s<this.case2person.length;s++)null===this.case2person[s].startTime?this.case2person[s].status=4:null===this.case2person[s].finishTime?jr(this.case2person[s].startTime,new Date)>this.case2person[s].planDays?this.case2person[s].status=2:this.case2person[s].status=0:jr(this.case2person[s].startTime,this.case2person[s].finishTime)<=this.case2person[s].planDays?this.case2person[s].status=1:this.case2person[s].status=3,null!==this.case2person[s].finishTime&&(this.case2person[s].executionDays=jr(this.case2person[s].startTime,this.case2person[s].finishTime),this.case2person[s].executionDays-=null===this.case2person[s].unforcedDays?0:+this.case2person[s].unforcedDays,7!==this.case2person[s].subId&&(this.case2person[s].sumValue=(this.case2person[s].planDays*(this.case2person[s].planDays/this.case2person[s].executionDays)**(2/3)).toFixed(2),a||9!==this.case2person[s].subId||(this.case2person[s].sumValue*=2),this.case2person[s].value=(this.case2person[s].sumValue*this.case2person[s].directorRate/100).toFixed(2)))}else this.$message.error(t.msg)},objectSpanMethod({row:e,column:t,rowIndex:a,columnIndex:s}){if(0===s||9===s){if(0!=a&&this.case2person[a-1].userId===this.case2person[a].userId)return[0,0];var i=a;while(i<this.case2person.length&&this.case2person[a].userId===this.case2person[i].userId)i++;return[i-a,1]}},async computeSumValue(e){var t=this.case2person[e].userId,a=0;while(e<this.case2person.length&&this.case2person[e].userId===t)null!=this.case2person[e]&&"value"in this.case2person[e]&&(a+=+this.case2person[e].value),e++;a=a.toFixed(2);const s=new(lt())(".copy-button",{text:()=>a+""});s.on("success",(()=>{this.$message.success(`计算结果：${a}，值已复制到粘贴板中`),s.destroy()})),s.on("error",(()=>{this.$message.success("复制失败"),s.destroy()}))},setCellColor({row:e,column:t,rowIndex:a,columnIndex:s}){return 3===s?"background-color:#fceadb":4===s?"background-color:#e1bbb8":5===s?"background-color:#C6DEF8":void 0}}},ot=nt,ct=(0,o.Z)(ot,st,it,!1,null,"02ea53dc",null),ut=ct.exports,pt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"subView"},[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",[e._v("专案管理")]),t("el-breadcrumb-item",{attrs:{to:{path:"/index"}}},[e._v("主页")]),t("el-breadcrumb-item",[e._v(e._s(e.caseName))])],1)],1),t("el-card",{staticClass:"table"},[t("el-row",{staticClass:"align-items-center"},[t("el-col",{attrs:{span:6}},[t("el-page-header",{attrs:{content:e.caseName},on:{back:function(t){return e.$router.back()}}})],1),t("el-col",{attrs:{span:2}},[t("span",{staticStyle:{"font-size":"25px","padding-left":"17px"}},[e._v("专案进度")])]),t("el-col",{attrs:{span:6}},[t("el-progress",{staticStyle:{"white-space":"nowrap"},attrs:{"stroke-width":26,percentage:e.casePercentage,color:e.caseScheduleColor,"define-back-color":"#ebeef5"}})],1),t("el-col",{attrs:{span:2}},[t("span",{staticStyle:{"font-size":"25px","padding-left":"17px"}},[e._v("时间进度")])]),t("el-col",{attrs:{span:6}},[t("el-progress",{staticStyle:{"white-space":"nowrap"},attrs:{"stroke-width":26,percentage:e.caseSchedulePercentage,color:e.scheduleColor,"define-back-color":"#ebeef5"}})],1),t("el-col",{attrs:{span:2}},[t("span",{staticStyle:{"margin-left":"30px","font-size":"18px",color:"#60626b"}},[e._v(" "+e._s(e.scheduleText())+" ")])])],1),t("div",{staticClass:"tableInfo"},[t("el-table",{attrs:{"row-key":"id","expand-row-keys":e.expandRowKeys,"cell-style":e.setCellColor,data:e.subInfo,stripe:"",border:""},on:{"cell-dblclick":e.handleDoubleClick}},[t("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(a){return[e._l(a.row.chargeName,(function(s,i){return t("el-row",{key:s},[t("el-col",{attrs:{span:2}},[t("el-tag",{staticClass:"chargeNameTag",on:{click:function(t){return e.getCaseByUserId(a.row.chargeId[i],s)}}},[e._v(" "+e._s(s)+" ")])],1),t("el-col",{attrs:{span:6}},[0!==a.row.desc.length&&null!==a.row.desc[i]&&""!==a.row.desc[i]?t("el-tag",{staticClass:"chargeNameTag",attrs:{type:"warning"}},[e._v(" 工作描述:"+e._s(a.row.desc[i])+" ")]):e._e()],1),t("el-col",{attrs:{span:3}},[0!==a.row.directorRate.length&&null!==a.row.directorRate[i]?t("el-tag",{staticClass:"chargeNameTag",attrs:{type:"warning"}},[e._v(" 时间占比："+e._s(a.row.directorRate[i].toFixed())+" % ")]):e._e()],1),t("el-col",{attrs:{span:3}},[0!==a.row.directorRate.length?t("el-tag",{staticClass:"chargeNameTag",attrs:{type:"warning"}},[e._v(" 积分："+e._s((a.row.directorRate[i]*a.row.value*1/100).toFixed(2))+" ")]):e._e()],1)],1)})),0===a.row.chargeId.length?t("el-tag",[e._v("暂无负责人")]):e._e()]}}])}),t("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tooltip",{attrs:{effect:"dark",content:"查看备注",placement:"top",enterable:!1}},[t("el-button",{attrs:{type:"info",size:"mini",icon:"el-icon-info",round:""},on:{click:function(t){return e.openCommentView(a.row)}}})],1),1!==e.user.type&&!a.row.chargeId.includes(e.user.id)||null!==a.row.startTime?e._e():t("el-tooltip",{attrs:{effect:"dark",content:"开始阶段",placement:"top",enterable:!1}},[t("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-video-play",round:""},on:{click:function(t){return e.launch(a.row)}}})],1),1===e.user.type&&null!==a.row.startTime&&null===a.row.finishTime?t("el-tooltip",{attrs:{effect:"dark",content:"结束阶段",placement:"top",enterable:!1}},[t("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-success",round:""},on:{click:function(t){return e.finish(a.row)}}})],1):e._e(),t("el-tooltip",{attrs:{effect:"dark",content:"编辑阶段",placement:"top",enterable:!1}},[1===e.user.type?t("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit",round:""},on:{click:function(t){return e.openEditCaseSub(a.row)}}}):e._e()],1),1===e.user.type&&null!==a.row.startTime&&null!==a.row.finishTime&&0!==a.row.chargeId.length?t("el-tooltip",{attrs:{effect:"dark",content:"分配比例",placement:"top",enterable:!1}},[t("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-setting",round:""},on:{click:function(t){return e.initEditDirectorRate(a.row)}}})],1):e._e()]}}])}),t("el-table-column",{attrs:{prop:"subName",label:"子流程"}}),t("el-table-column",{attrs:{prop:"level",label:"难度"}}),t("el-table-column",{attrs:{prop:"value",label:"积分"}}),t("el-table-column",{attrs:{prop:"startTime",label:"开始时间"}}),t("el-table-column",{attrs:{prop:"targetTime",label:"阶段目标时间"}}),t("el-table-column",{attrs:{prop:"standardTime",label:"目标完成时间"}}),t("el-table-column",{attrs:{prop:"ideaTime",label:"预计完成时间"}}),t("el-table-column",{attrs:{prop:"finishTime",label:"实际结束时间"}}),t("el-table-column",{attrs:{prop:"planDays",label:"计划时间"}}),t("el-table-column",{attrs:{prop:"executionDays",label:"执行天数"}}),t("el-table-column",{attrs:{prop:"unforcedDays",label:"外界因素延期"}}),t("el-table-column",{attrs:{prop:"applyDelay",label:"人为因素延期"}}),t("el-table-column",{attrs:{prop:"status",label:"执行状态"},scopedSlots:e._u([{key:"default",fn:function(a){return[0===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"primary"}},[e._v("正在执行")]):e._e(),1===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v("正常完成")]):e._e(),2===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"danger"}},[e._v("已延误")]):e._e(),3===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"warning"}},[e._v("延误完成")]):e._e(),4===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"info"}},[e._v("未开始")]):e._e()]}}])})],1),t("el-row",{staticStyle:{"margin-bottom":"-20px"}},[t("el-col",{attrs:{span:1}},[t("el-button",{attrs:{round:"",type:"primary",icon:"el-icon-back"},on:{click:function(t){return e.turnPage(-1)}}})],1),t("el-col",{attrs:{span:1,offset:22}},[t("el-button",{attrs:{round:"",type:"primary",icon:"el-icon-right"},on:{click:function(t){return e.turnPage(1)}}})],1)],1)],1)],1),t("el-card",[t("div",{staticStyle:{width:"100%",height:"1000px"},attrs:{id:"ganttChart"}})]),t("el-drawer",{attrs:{visible:e.drawer,direction:e.direction,size:"50%"},on:{"update:visible":function(t){e.drawer=t}}},[t("div",{staticClass:"userCase",attrs:{border:""}},[t("div",{staticClass:"chargeInfo"},[t("label",{staticClass:"chargeName"},[e._v(e._s(e.chargeName))])]),t("el-table",{attrs:{data:e.userInfo}},[t("el-table-column",{attrs:{prop:"caseName",label:"专案名称",width:"245"}}),t("el-table-column",{attrs:{prop:"subName",label:"阶段名称",width:"80"}}),t("el-table-column",{attrs:{prop:"startTime",label:"开始时间",width:"100"}}),t("el-table-column",{attrs:{prop:"presetTime",label:"预计完成时间",width:"110"}}),t("el-table-column",{attrs:{prop:"deadLine",label:"延期/截止",width:"110"}}),t("el-table-column",{attrs:{prop:"status",label:"执行状态"},scopedSlots:e._u([{key:"default",fn:function(a){return[0===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"primary"}},[e._v("正在执行")]):e._e(),1===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v("正常完成")]):e._e(),2===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"danger"}},[e._v("已延误")]):e._e(),3===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"warning"}},[e._v("延误完成")]):e._e(),4===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"info"}},[e._v("未开始")]):e._e()]}}])})],1)],1)]),t("el-drawer",{attrs:{visible:e.delayDrawer,direction:e.direction,size:"50%"},on:{"update:visible":function(t){e.delayDrawer=t}}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.delayList,border:""}},[t("el-table-column",{attrs:{prop:"caseName",label:"专案",width:"240"}}),t("el-table-column",{attrs:{prop:"subName",label:"阶段",width:"100"}}),t("el-table-column",{attrs:{prop:"type",label:"延期类型",width:"120"}}),t("el-table-column",{attrs:{prop:"applyReason",label:"延期原因"}}),t("el-table-column",{attrs:{prop:"applyDays",label:"申请天数",width:"80"}}),t("el-table-column",{attrs:{prop:"predictTime",label:"预计完成时间",width:"120"}})],1)],1),t("el-dialog",{attrs:{title:"备注信息",visible:e.commitVisible,width:"40%"},on:{"update:visible":function(t){e.commitVisible=t},close:e.closeCommitDialog}},[t("el-form",{ref:"commitFormRef",attrs:{model:e.commitForm,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"流程名称"}},[t("el-input",{attrs:{disabled:""},model:{value:e.commitForm.subName,callback:function(t){e.$set(e.commitForm,"subName",t)},expression:"commitForm.subName"}})],1),t("el-form-item",{attrs:{label:"备注信息"}},[t("el-card",{staticClass:"box-card"},[e._l(e.commitForm.content,(function(a){return t("div",{key:a,staticClass:"text item"},[e._v(" "+e._s(a)+" ")])})),0===e.commitForm.content.length?t("label",[e._v("暂无备注")]):e._e()],2)],1),1===e.user.type||2===e.user.status?t("el-form-item",{attrs:{prop:"newContent",label:"增加备注"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.commitForm.newContent,callback:function(t){e.$set(e.commitForm,"newContent",t)},expression:"commitForm.newContent"}})],1):e._e()],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[1===e.user.type||2===e.user.status?t("el-button",{attrs:{type:"primary"},on:{click:e.submitCommitForm}},[e._v("提交")]):e._e(),t("el-button",{on:{click:function(t){e.commitVisible=!1}}},[e._v("取 消")])],1)],1),t("el-dialog",{attrs:{title:"确定积分比例",visible:e.editDirectorRate,width:"40%"},on:{"update:visible":function(t){e.editDirectorRate=t}}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.directorList}},[t("el-table-column",{attrs:{prop:"name",label:"姓名"}}),t("el-table-column",{attrs:{label:"比例"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-input",{attrs:{type:"number",placeholder:"例：33，单位%"},model:{value:a.row.value,callback:function(t){e.$set(a.row,"value",t)},expression:"scope.row.value"}})]}}])}),t("el-table-column",{attrs:{label:"工作描述"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-input",{attrs:{placeholder:"工作内容"},model:{value:a.row.description,callback:function(t){e.$set(a.row,"description",t)},expression:"scope.row.description"}})]}}])}),t("el-table-column",{attrs:{label:"获得积分"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-input",{attrs:{value:1*a.row.value/100*e.curCaseSubObj.value,placeholder:"工作内容",disabled:""}})]}}])})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editDirectorRate=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitDirectorRate()}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"编辑子阶段",visible:e.editCaseSubVisible,width:"50%"},on:{"update:visible":function(t){e.editCaseSubVisible=t}}},[t("el-form",{ref:"editCaseSubRef",attrs:{model:e.curCaseSubObj,"label-width":"90px"}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"修改难度"}},[t("el-select",{attrs:{placeholder:e.curCaseSubObj?e.curCaseSubObj.level+"":"请选择难度"},on:{change:function(t){return e.getPlanDays()}},model:{value:e.curCaseSubObj.level,callback:function(t){e.$set(e.curCaseSubObj,"level",t)},expression:"curCaseSubObj.level"}},e._l([1,2,3,4,5,6,7,8,9,10],(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"计划天数"}},[t("el-input",{model:{value:e.curCaseSubObj.planDays,callback:function(t){e.$set(e.curCaseSubObj,"planDays",t)},expression:"curCaseSubObj.planDays"}})],1)],1)],1),t("el-form-item",{attrs:{label:"开始时间"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"开始日期"},model:{value:e.curCaseSubObj.startTime,callback:function(t){e.$set(e.curCaseSubObj,"startTime",t)},expression:"curCaseSubObj.startTime"}})],1),t("el-form-item",{attrs:{label:"结束时间"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"结束时间"},model:{value:e.curCaseSubObj.finishTime,callback:function(t){e.$set(e.curCaseSubObj,"finishTime",t)},expression:"curCaseSubObj.finishTime"}})],1),t("el-row",[t("el-col",{attrs:{span:21}},[t("el-form-item",{attrs:{label:"外界延期"}},[t("el-input",{attrs:{disabled:""},model:{value:e.curCaseSubObj.unforcedDays,callback:function(t){e.$set(e.curCaseSubObj,"unforcedDays",t)},expression:"curCaseSubObj.unforcedDays"}})],1)],1),t("el-col",{attrs:{span:2,offset:1}},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"添加外界因素延期",placement:"top"}},[t("el-button",{attrs:{icon:"el-icon-plus",type:"primary",size:"medium",round:""},on:{click:function(t){e.applyDelayVisible=!0,e.addDelayFlag=!0,e.editDelayFlag=!1}}})],1)],1)],1),t("el-table",{staticStyle:{width:"100%","margin-bottom":"5px"},attrs:{data:e.delayList,border:""}},[t("el-table-column",{attrs:{prop:"caseName",label:"专案"}}),t("el-table-column",{attrs:{prop:"subName",label:"阶段"}}),t("el-table-column",{attrs:{prop:"type",label:"延期类型"}}),t("el-table-column",{attrs:{prop:"applyReason",label:"延期原因"}}),t("el-table-column",{attrs:{prop:"applyDays",label:"申请天数"}}),t("el-table-column",{attrs:{prop:"predictTime",label:"预计完成时间",width:"120"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑",placement:"top"}},[t("el-button",{attrs:{icon:"el-icon-edit",type:"primary",size:"mini",round:""},on:{click:function(t){return e.editDelay(a.row)}}})],1),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除",placement:"top"}},[t("el-button",{attrs:{icon:"el-icon-delete",type:"danger",size:"mini",round:""},on:{click:function(t){return e.deleteDelay(a.row)}}})],1)]}}])})],1),t("el-form-item",{attrs:{label:"负责人"}},[null===e.curCaseSubObj.finishTime?t("el-transfer",{attrs:{data:e.editUser,"button-texts":["移除","添加"],titles:["源","目标"],props:{key:"id",label:"name"}},model:{value:e.curCaseSubObj.chargeId,callback:function(t){e.$set(e.curCaseSubObj,"chargeId",t)},expression:"curCaseSubObj.chargeId"}}):t("div",[t("el-tag",{staticClass:"chargeNameTag"},[e._v("专案子阶段结束状态下，不可修改负责人")]),t("div",e._l(e.curCaseSubObj.chargeName,(function(a){return t("el-tag",{key:a,staticClass:"chargeNameTag",attrs:{type:"warning"}},[e._v(e._s(a))])})),1)],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editCaseSubVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.enableEdit()}}},[e._v("修 改")])],1)],1),t("el-dialog",{attrs:{title:"申请延期",visible:e.applyDelayVisible,width:"30%"},on:{"update:visible":function(t){e.applyDelayVisible=t},close:e.closeApplyDelay}},[t("el-form",{ref:"applyDelayFormRef",staticClass:"form",attrs:{rules:e.delayRules,model:e.delayApplyObject,"label-width":"90px"}},[t("el-form-item",{attrs:{label:"专案"}},[t("el-input",{attrs:{value:e.curCaseSubObj.caseName,disabled:""}})],1),t("el-form-item",{attrs:{label:"阶段"}},[t("el-input",{attrs:{value:e.curCaseSubObj.subName,disabled:""}})],1),t("el-form-item",{attrs:{label:"延期类型",prop:"delayType"}},[t("el-select",{attrs:{placeholder:"请选择延期类型"},model:{value:e.delayApplyObject.delayType,callback:function(t){e.$set(e.delayApplyObject,"delayType",t)},expression:"delayApplyObject.delayType"}},e._l(["外界因素延期","人为因素延期"],(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("el-form-item",{attrs:{label:"原因描述:",prop:"applyReason"}},[t("el-input",{attrs:{autosize:"",type:"textarea",placeholder:"请输入延期原因描述"},model:{value:e.delayApplyObject.applyReason,callback:function(t){e.$set(e.delayApplyObject,"applyReason",t)},expression:"delayApplyObject.applyReason"}})],1),t("el-form-item",{attrs:{label:"申请天数",prop:"applyDays"}},[t("el-input",{attrs:{type:"number",placeholder:"请输入要申请的天数"},on:{input:e.computePresetTime},model:{value:e.delayApplyObject.applyDays,callback:function(t){e.$set(e.delayApplyObject,"applyDays",e._n(t))},expression:"delayApplyObject.applyDays"}})],1),e.delayApplyObject.applyDays>0?t("el-form-item",{attrs:{label:"预计完成"}},[t("el-input",{attrs:{value:e.presetTime,disabled:""}})],1):e._e()],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.applyDelayVisible=!1}}},[e._v("取 消")]),e.addDelayFlag?t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitDelayApply()}}},[e._v("确 定")]):e._e(),e.editDelayFlag?t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updateDelayApply()}}},[e._v("修 改")]):e._e()],1)],1),t("el-dialog",{attrs:{title:"选择完结日期",visible:e.pickFinishTime.pickFinishTimeVisible,width:"30%"},on:{"update:visible":function(t){return e.$set(e.pickFinishTime,"pickFinishTimeVisible",t)}}},[t("el-date-picker",{attrs:{type:"date",placeholder:"选择完结日期","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.pickFinishTime.preFinishTime,callback:function(t){e.$set(e.pickFinishTime,"preFinishTime",t)},expression:"pickFinishTime.preFinishTime"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.pickFinishTime.pickFinishTimeVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitFinishInfo()}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"选择开始日期",visible:e.pickStartTime.pickStartTimeVisible,width:"30%"},on:{"update:visible":function(t){return e.$set(e.pickStartTime,"pickStartTimeVisible",t)}}},[t("el-date-picker",{attrs:{type:"date",placeholder:"选择开始日期","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.pickStartTime.preStartTime,callback:function(t){e.$set(e.pickStartTime,"preStartTime",t)},expression:"pickStartTime.preStartTime"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.pickStartTime.pickStartTimeVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.launchSub()}}},[e._v("确 定")])],1)],1)],1)},dt=[];const ht=e=>ur.get(`/caseSubUser/countDirector/${e}`),mt=e=>ur.delete("/caseSubUser",{params:e}),bt=e=>ur.post("/caseSubUser/setDirector",e),ft=e=>ur.put("/caseSubUser/submitDirectorValue",e),yt=e=>ur.put("/caseSubUser/updateDescription",e),gt=e=>ur.put("/caseSubUser/updateChargeCaseSub",e),vt=e=>ur.post("/caseSubDelayApply",e),wt=()=>ur.get("/caseSubDelayApply/checkList"),kt=e=>ur.put("/caseSubDelayApply/judgeApply",e),Tt=e=>ur.get("/caseSubDelayApply/byUserAndStatus",{params:e}),St=e=>ur.get("/caseSubDelayApply/history",{params:e}),xt=e=>ur.get(`/caseSubDelayApply/checkList/${e}`),Ct=e=>ur.put("/caseSubDelayApply/updateDelay",e),Dt=e=>ur.delete(`/caseSubDelayApply/${e}`),It=e=>ur.delete(`/caseSubDelayApply/removeDelayApply/${e}`),_t=e=>ur.get("/caseSubDelayApply/getDelayById",{params:e}),Lt=()=>ur.get("/sub/all"),Ft=e=>ur.get("/sub/list",{params:e}),Ot=e=>ur.post("/subLevel",e),jt=e=>ur.put("/subLevel",e),At=e=>ur.get("/subLevel/getPresetDays",{params:e}),zt=e=>ur.delete(`/subLevel/${e}`),$t=e=>ur.get(`/subLevel/${e}`);var Rt={data(){var e=(e,t,a)=>{(t<=0||t>15)&&a(new Error("申请天数必须在1-15之间")),a()};return{subInfo:[],caseName:"",caseId:null,caseIndex:null,casePlanDays:0,caseUnforcedDays:0,caseExecutionDays:0,caseFinishDays:0,drawer:!1,direction:"rtl",delayDrawer:!1,delayList:[],userInfo:[],chargeName:"負責人",commitVisible:!1,commitForm:{content:[],newContent:null,chargeId:[]},rules:{newContent:[{required:!0,message:"备注不能为空",trigger:"blur"},{min:8,max:255,message:"备注应该大于8个字符，小于255个字符",trigger:"blur"}]},setDirectorVisible:!1,allUser:[{value:0,label:"机构",children:[]},{value:1,label:"电控",children:[]},{value:2,label:"IE",children:[]}],editUser:[],directors:null,curCaseSub:null,editCaseSubVisible:!1,curCaseSubObj:{},editDirectorRate:!1,directorList:[],applyDelayVisible:!1,delayRules:{applyReason:[{required:!0,message:"必须输入延期原因",trigger:"blur"}],applyDays:[{required:!0,message:"必须输入要延期的天数",trigger:"blur"},{validator:e,trigger:"blur"}],delayType:[{required:!0,message:"请选择延期类型",trigger:"change"}]},delayApplyObject:{delayType:"外界因素延期"},addDelayFlag:!1,editDelayFlag:!1,presetTime:"",oldApplyDays:"",expandRowKeys:[],pickFinishTime:{preFinishCaseSubId:null,pickFinishTimeVisible:null,preFinishTime:null},pickStartTime:{preStartCaseSubId:null,pickStartTimeVisible:null,preStartTime:null},gantt:null,casePercentage:0,caseSchedulePercentage:0}},computed:{...(0,k.rn)(["user"]),...(0,k.rn)("caseM",["caseList"])},created(){this.caseId=this.$route.query.caseId,this.caseName=this.$route.query.caseName,this.getAllUser();for(var e=0;e<this.caseList.length;e++)if(this.caseList[e].id===this.caseId){this.caseIndex=e;break}},async mounted(){await this.getSubInfo(this.$route.query.caseId),this.gantt=this.$echarts.init(document.getElementById("ganttChart")),this.showExecutionGantt()},methods:{async getSubInfo(e){this.caseFinishDays=0,this.casePlanDays=0,this.caseExecutionDays=0,this.caseUnforcedDays=0;var t=await pr(e);this.subInfo=t.data;var a=!1;for(let s=0;s<this.subInfo.length;s++)if(31===this.subInfo[s].subId){a=!0;break}for(let s=0;s<this.subInfo.length;s++)this.subInfo[s].startTime=Lr(this.subInfo[s].startTime),null!==this.subInfo[s].startTime&&(this.subInfo[s].targetTime=Or(this.subInfo[s].startTime,this.subInfo[s].planDays),this.subInfo[s].standardTime=Or(this.subInfo[s].startTime,this.subInfo[s].planDays,this.subInfo[s].unforcedDays)),0===s?this.subInfo[s].ideaTime=this.subInfo[s].targetTime:"undefined"!==typeof this.subInfo[s-1].ideaTime&&(this.subInfo[s].ideaTime=Or(this.subInfo[s-1].ideaTime,this.subInfo[s].planDays,1)),this.subInfo[s].finishTime=Lr(this.subInfo[s].finishTime),this.subInfo[s].status=Fr(this.subInfo[s].startTime,this.subInfo[s].standardTime,this.subInfo[s].finishTime),this.casePlanDays+=this.subInfo[s].planDays,this.caseFinishDays+=null===this.subInfo[s].finishTime?0:this.subInfo[s].planDays,this.caseUnforcedDays+=null===this.subInfo[s].unforcedDays?0:this.subInfo[s].unforcedDays,null!==this.subInfo[s].startTime&&(this.subInfo[s].executionDays=jr(this.subInfo[s].startTime,null===this.subInfo[s].finishTime?new Date:this.subInfo[s].finishTime),this.subInfo[s].executionDays-=null===this.subInfo[s].unforcedDays?0:this.subInfo[s].unforcedDays,this.caseExecutionDays+=this.subInfo[s].executionDays),null!==this.subInfo[s].finishTime&&7!==this.subInfo[s].subId&&(this.subInfo[s].value=(this.subInfo[s].planDays*(1*this.subInfo[s].planDays/this.subInfo[s].executionDays)**(2/3)).toFixed(2),a||9!==this.subInfo[s].subId||(this.subInfo[s].value*=2));this.casePercentage=Math.ceil(100*this.caseFinishDays/this.casePlanDays),this.caseSchedulePercentage=this.caseExecutionDays>this.casePlanDays?100:parseFloat((100*this.caseExecutionDays/this.casePlanDays).toFixed())},async handleDoubleClick(e,t){"外界因素延期"===t.label?(this.getUnforcedDays(e),this.delayDrawer=!0):"人为因素延期"===t.label?this.getApplyDelay(e):"积分"===t.label&&(0===this.expandRowKeys.length?this.expandRowKeys=this.subInfo.map((e=>e.id)):this.expandRowKeys=[])},async getUnforcedDays(e){var t=await Tt({caseSubId:e.id,status:1,delayType:"外界因素延期"});this.delayList=t.data,this.delayList.map((t=>{t.predictTime=Lr(t.predictTime),t.type="外界因素延期",t.caseName=e.caseName,t.subName=e.subName}))},async getApplyDelay(e){var t=await Tt({caseSubId:e.id,status:1,delayType:"人为因素延期"});this.delayList=t.data,this.delayList.map((t=>{t.predictTime=Lr(t.predictTime),t.type="人为因素延期",t.caseName=e.caseName,t.subName=e.subName})),this.delayDrawer=!0},async getCaseByUserId(e,t){var a=await hr(e);this.userInfo=a.data,this.chargeName=t;for(var s=0;s<this.userInfo.length;s++){this.userInfo[s].startTime=Lr(this.userInfo[s].startTime);const e=new Date(this.userInfo[s].startTime);this.userInfo[s].presetTime=Lr(e.setDate(e.getDate()+this.userInfo[s].planDays-1)),this.userInfo[s].status=Fr(this.userInfo[s].startTime,this.userInfo[s].presetTime,this.userInfo[s].finishTime),this.userInfo[s].deadLine=0===this.userInfo[s].status?jr(new Date,this.userInfo[s].presetTime):jr(this.userInfo[s].presetTime,new Date)-1}this.drawer=!0},async openCommentView(e){this.commitVisible=!0,this.commitForm.subName=e.subName,this.commitForm.caseSubId=e.id;var t=await Ne(e.id);t=t.data,this.commitForm.content=[];for(var a=0;a<t.length;a++)this.commitForm.content.push(t[a].content)},async submitCommitForm(){this.$refs.commitFormRef.validate((async e=>{if(!e)return;const t={};t.caseSubId=this.commitForm.caseSubId,t.content=this.commitForm.newContent,t.createUser=this.user.id;var a=await Pe(t);this.$message(a.data),this.commitVisible=!1}))},closeCommitDialog(){this.$refs.commitFormRef.resetFields()},async removeDirector(e,t){null===e.finishTime?1!==e.chargeId.length?this.$confirm("此操作将移除该负责人, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const a=await mt({userId:e.chargeId[t],caseSubId:e.id});200===a.code?(this.$message.success(a.data),e.chargeName.splice(t,1),e.chargeId.splice(t,1),this.$set(e,"chargeName",e.chargeName),this.$set(e,"chargeId",e.chargeId)):this.$message.error(a.msg)})).catch((()=>{this.$message({type:"info",message:"已取消移除"})})):this.$message.warning("当前阶段仅剩一个负责人，请先增加负责人再删除"):this.$message.error("该阶段已经结束，负责人信息不可再变更")},finish(e){0!==e.chargeId.length?this.initEditDirectorRate(e):(this.pickFinishTime.pickFinishTimeVisible=!0,this.pickFinishTime.preFinishCaseSubId=e.id)},async submitFinishInfo(){if(this.curCaseSubObj.startTime>this.pickFinishTime.preFinishTime)return void this.$message.error("结束时间不能小于开始时间");const e=await yr({id:this.pickFinishTime.preFinishCaseSubId,finishTime:this.pickFinishTime.preFinishTime});200===e.code?(this.$message.success(e.data),this.pickFinishTime.pickFinishTimeVisible=!1,this.getSubInfo(this.caseId)):this.$message.error(e.msg)},async launch(e){this.pickStartTime.pickStartTimeVisible=!0,this.pickStartTime.preStartCaseSubId=e.id},async launchSub(){var e=await yr({id:this.pickStartTime.preStartCaseSubId,startTime:this.pickStartTime.preStartTime});200===e.code?(this.$message.success(e.data),this.pickStartTime.pickStartTimeVisible=!1,this.getSubInfo(this.caseId)):this.$message.error(e.msg)},async getAllUser(){const e=await Me();200===e.code?(this.editUser=e.data,e.data.forEach((e=>{this.allUser[e.status].children.push(e)}))):this.$message.error(e.msg)},openEditCaseSub(e){this.curCaseSubObj={...e},this.getUnforcedDays(e),this.editCaseSubVisible=!0},async enableEdit(){null!==this.curCaseSubObj.startTime&&(this.curCaseSubObj.startTime=Lr(this.curCaseSubObj.startTime)+" 00:00:00"),null!==this.curCaseSubObj.finishTime&&(this.curCaseSubObj.finishTime=Lr(this.curCaseSubObj.finishTime)+" 00:00:00");var e=await fr(this.curCaseSubObj);200===e.code?(this.$message.success(e.data),this.getSubInfo(this.caseId),this.editCaseSubVisible=!1):this.$message.error(e.msg)},async getPlanDays(){const e=await At({subId:this.curCaseSubObj.subId,level:this.curCaseSubObj.level});200===e.code?this.$set(this.curCaseSubObj,"planDays",e.data):this.$message.error(e.msg)},async initEditDirectorRate(e){const t=await ht(e.id);this.directorList=t.data,this.curCaseSubObj={...e},1===this.directorList.length&&(this.directorList[0].value=100),this.editDirectorRate=!0},async submitDirectorRate(){const e=await ft(this.directorList);200===e.code?(this.$message.success(e.data),this.editDirectorRate=!1,null===this.curCaseSubObj.finishTime?this.$confirm("此操作将完结该阶段, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.pickFinishTime.pickFinishTimeVisible=!0,this.pickFinishTime.preFinishCaseSubId=this.curCaseSubObj.id})):this.getSubInfo(this.caseId)):this.$message.error(e.msg)},setCellColor({row:e,column:t,rowIndex:a,columnIndex:s}){return 5===s?"background-color:#fceadb":6===s?"background-color:#e1bbb8":7===s?"background-color:#C6DEF8":8===s?"background-color:#B9BFBF":9===s?"background-color:#B4EBB1":void 0},closeApplyDelay(){this.$refs.applyDelayFormRef.resetFields(),this.delayApplyObject={delayType:"外界因素延期"},this.presetTime="",this.oldApplyDays=""},submitDelayApply(){this.$refs.applyDelayFormRef.validate((async e=>{if(e){this.delayApplyObject.applyId=this.user.id,this.delayApplyObject.caseSubId=this.curCaseSubObj.id;const e=await vt(this.delayApplyObject);200===e.code&&"添加成功"===e.data?(this.$message.success(e.data),this.applyDelayVisible=!1,this.curCaseSubObj.unforcedDays=+this.curCaseSubObj.unforcedDays+ +this.delayApplyObject.applyDays,this.getUnforcedDays(this.curCaseSubObj),this.delayApplyObject={delayType:"外界因素延期"}):this.$message.error(e.msg)}}))},updateDelayApply(){this.$refs.applyDelayFormRef.validate((async e=>{if(e){this.delayApplyObject.predictTime=null;const e=await Ct(this.delayApplyObject);200===e.code?(this.$message.success(e.data),this.applyDelayVisible=!1,await this.getUnforcedDays(this.curCaseSubObj),this.curCaseSubObj.unforcedDays=0,this.delayList.forEach((e=>this.curCaseSubObj.unforcedDays=this.curCaseSubObj.unforcedDays+ +e.applyDays))):this.$message.error(e.msg)}}))},async deleteDelay(e){this.$confirm("此操作将删除该延期申请, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await Dt(e.id);200===t.code&&(this.$message.success(t.data),await this.getUnforcedDays(this.curCaseSubObj),this.curCaseSubObj.unforcedDays=0,this.delayList.forEach((e=>this.curCaseSubObj.unforcedDays=this.curCaseSubObj.unforcedDays+ +e.applyDays)))})).catch((e=>{this.$message({type:"info",message:"已取消删除"})}))},editDelay(e){this.addDelayFlag=!1,this.editDelayFlag=!0;const{id:t,delayType:a,applyReason:s,applyDays:i,predictTime:r}=e;this.oldApplyDays=i,this.delayApplyObject={id:t,delayType:a,applyReason:s,applyDays:i,predictTime:r},this.applyDelayVisible=!0},computePresetTime(){if(this.editDelayFlag){var e=this.delayApplyObject.applyDays-this.oldApplyDays;this.presetTime=Lr(Or(this.delayApplyObject.predictTime,e,1))}else this.presetTime=Lr(Or(this.curCaseSubObj.startTime,this.curCaseSubObj.planDays,+this.curCaseSubObj.unforcedDays,+this.curCaseSubObj.applyDelay,this.delayApplyObject.applyDays))},caseScheduleColor(){return this.caseFinishDays===this.casePlanDays?"#67c23a":1*this.caseFinishDays/this.casePlanDays>.6?"#e6a23c":"#409eff"},scheduleColor(){return this.caseExecutionDays>this.casePlanDays?"#f56c6c":1*this.caseExecutionDays/this.casePlanDays>.6?"#e6a23c":"#67c23a"},scheduleText(){return this.caseExecutionDays>=this.casePlanDays?`延误${this.caseExecutionDays-this.casePlanDays}天`:`剩余${this.casePlanDays-this.caseExecutionDays}天`},showExecutionGantt(){var e=[],t={},a={},s={};t=this.initGanttObj(t,"bar0",!0,"#6ED77E",4,"开始时间"),a=this.initGanttObj(a,"bar1",!0,"#6ED77E",4,"开始时间"),s=this.initGanttObj(s,"bar0",!1,"#6ED77E",3,"预计完成时间");var i={};i=this.initGanttObj(i,"bar0",!1,"skyblue",2,"目标完成时间");var r={};r=this.initGanttObj(r,"bar1",!1,"#FF7F50",1,"完成/当前时间");var l=[];for(let o=this.subInfo.length-1;o>=0;o--)null!==this.subInfo[o].startTime&&(t.data.push(new Date(this.subInfo[o].startTime)),a.data.push(new Date(this.subInfo[o].startTime)),s.data.push(new Date(this.subInfo[o].targetTime)),i.data.push(new Date(this.subInfo[o].standardTime)),r.data.push(null===this.subInfo[o].finishTime?new Date:new Date(this.subInfo[o].finishTime)),l.push(this.subInfo[o].subName));l.push("计划工期"),t.data.push(new Date(this.subInfo[0].startTime)),a.data.push(new Date(this.subInfo[0].startTime)),s.data.push(new Date(Or(this.subInfo[0].startTime,this.casePlanDays))),i.data.push(new Date(Or(this.subInfo[0].startTime,this.casePlanDays,this.caseUnforcedDays))),r.data.push(new Date),e.push(t),e.push(a),e.push(s),e.push(i),e.push(r);var n={title:{text:this.caseName,padding:20,textStyle:{fontSize:17,fontWeight:"bolder",color:"#333"},subtextStyle:{fontSize:13,fontWeight:"bolder"}},legend:{data:["开始时间","预计完成时间","目标完成时间","完成/当前时间"],align:"right",right:80,top:50},grid:{containLabel:!0,show:!1,right:130,left:40,bottom:40,top:90},xAxis:{type:"time",axisLabel:{show:!0,interval:5,formatter:function(e){var t=new Date(e),a=t.getFullYear(),s=t.getMonth()+1,i=t.getDate();return i>1?"{fontSizeMini|"+i+"}":s>1?"{fontSize|"+s+"月}":"{fontSizeLarge|"+a+"年}"},rich:{fontSizeMini:{fontSize:20},fontSize:{fontSize:25},fontSizeLarge:{fontSize:30}}}},yAxis:{axisLabel:{show:!0,interval:0,fontSize:18,color:"#555",fontWeight:"bolder"},data:l,type:"category",boundaryGap:!0},tooltip:{trigger:"axis",formatter:function(e){var t="";t+=e[0].axisValue+"<br/>";for(var a=new Set,s=0;s<e.length;s++)a.has(e[s].seriesName)||(a.add(e[s].seriesName),t+='<div style="display:inline-block;margin-right:5px;border-radius:50%;width:10px;height:10px;background-color:'+e[s].color+';"></div>'+e[s].seriesName+"："+Lr(e[s].value)+"<br/>");return t}},series:e};this.gantt.setOption(n)},initGanttObj(e,t,a,s,i,r){return e.name=r,e.stack=t,e.type="bar",i<=2&&(e.label={show:!0,color:"#333333",position:"right",fontSize:18,formatter:function(e){var t=new Date(e.value);return t.getMonth()+1+"-"+t.getDate()}}),e.zlevel=i,e.itemStyle=a?{normal:{color:"#fff"}}:{normal:{color:s,borderColor:"#fff",borderWidth:2}},e.data=[],e},async turnPage(e){this.caseIndex+=e,this.caseIndex<0?this.caseIndex=this.caseList.length-1:this.caseIndex>=this.caseList.length&&(this.caseIndex=0),this.caseId=this.caseList[this.caseIndex].id,this.caseName=this.caseList[this.caseIndex].name,await this.getSubInfo(this.caseId),this.showExecutionGantt()}}},Vt=Rt,qt=(0,o.Z)(Vt,pt,dt,!1,null,"590d349d",null),Ut=qt.exports,Nt=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/index"}}},[e._v("主页")]),t("el-breadcrumb-item",[e._v("专案管理")]),t("el-breadcrumb-item",[e._v("专案列表")])],1)],1),t("el-card",[t("div",{staticClass:"case_add"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{placeholder:"请输入专案名称查询"},on:{change:function(t){return e.getTableDate()}},model:{value:e.queryInfo.query,callback:function(t){e.$set(e.queryInfo,"query",t)},expression:"queryInfo.query"}})],1),t("el-col",{attrs:{span:4}},[t("el-select",{attrs:{placeholder:"请选择负责人",clearable:""},on:{change:e.getTableDate},model:{value:e.queryInfo.director,callback:function(t){e.$set(e.queryInfo,"director",t)},expression:"queryInfo.director"}},e._l(e.allUser,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.getTableDate()}}},[e._v("查询")])],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.openAddCase()}}},[e._v("新增专案")])],1),t("el-col",{attrs:{span:2,offset:10}},[t("el-switch",{attrs:{"active-text":"中断专案"},on:{change:e.getTableDate},model:{value:e.queryInfo.showTerminated,callback:function(t){e.$set(e.queryInfo,"showTerminated",t)},expression:"queryInfo.showTerminated"}})],1)],1)],1),t("el-table",{attrs:{data:e.pageInfo,border:"",scrope:"","max-height":"600"}},[t("el-table-column",{attrs:{type:"index",label:"#"}}),t("el-table-column",{attrs:{prop:"name",label:"任务名"}}),t("el-table-column",{attrs:{prop:"level",label:"难度"}}),t("el-table-column",{attrs:{prop:"directorName",label:"负责人"}}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}}),t("el-table-column",{attrs:{prop:"startTime",label:"开始时间"}}),t("el-table-column",{attrs:{prop:"finishTime",label:"完结时间"}}),t("el-table-column",{attrs:{label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini",round:""},on:{click:function(t){return e.editCase(a.row)}}}),a.row.hasSub?e._e():t("el-tooltip",{attrs:{effect:"dark",content:"分配子流程",placement:"top"}},[t("el-button",{attrs:{type:"warning",icon:"el-icon-setting",size:"mini",round:""},on:{click:function(t){return e.openAddRelationMenu(a.row)}}})],1),null!==a.row.finishTime||a.row.terminate?e._e():t("el-tooltip",{attrs:{effect:"dark",content:"终止专案",placement:"top"}},[t("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-circle-close",round:""},on:{click:function(t){return e.terminateCase(a.row,!0)}}})],1),null===a.row.finishTime&&a.row.terminate?t("el-tooltip",{attrs:{effect:"dark",content:"重启专案",placement:"top"}},[t("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-success",round:""},on:{click:function(t){return e.terminateCase(a.row,!1)}}})],1):e._e(),t("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete",round:""},on:{click:function(t){return e.deleteCase(a.row)}}}),a.row.hasSub?t("el-tooltip",{attrs:{effect:"dark",content:"专案详情",placement:"top"}},[t("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-s-promotion",round:""},on:{click:function(t){return e.jump2detail(a.row)}}})],1):e._e(),a.row.hasSub?t("el-tooltip",{attrs:{effect:"dark",content:"子流程编辑",placement:"top"}},[t("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-s-operation",round:""},on:{click:function(t){return e.openEditCaseSub(a.row)}}})],1):e._e()]}}])})],1),t("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"left"},attrs:{"current-page":e.queryInfo.page,"page-sizes":[5,7,10,20],"page-size":e.queryInfo.pageSize,layout:"total, sizes, prev, pager, next",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){return e.$set(e.queryInfo,"page",t)},"update:current-page":function(t){return e.$set(e.queryInfo,"page",t)}}})],1),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.addCaseVisible,width:"35%"},on:{"update:visible":function(t){e.addCaseVisible=t},close:function(t){return e.addCaseFormClose()}}},[t("el-form",{ref:"addCaseFormRef",attrs:{model:e.addCaseForm,rules:e.addCaseRules,"label-width":"80px"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",[t("el-form-item",{attrs:{label:"专案名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入专案名称"},model:{value:e.addCaseForm.name,callback:function(t){e.$set(e.addCaseForm,"name",t)},expression:"addCaseForm.name"}})],1)],1)],1),t("el-row",{attrs:{gutter:40}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"专案号"}},[t("el-input",{attrs:{placeholder:"如专案号未申请下来，为空"},model:{value:e.addCaseForm.number,callback:function(t){e.$set(e.addCaseForm,"number",t)},expression:"addCaseForm.number"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"难度",prop:"level"}},[t("el-input",{attrs:{placeholder:"请输入专案难度"},model:{value:e.addCaseForm.level,callback:function(t){e.$set(e.addCaseForm,"level",e._n(t))},expression:"addCaseForm.level"}})],1)],1)],1),t("el-row",{attrs:{gutter:40}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"预估费用",prop:"estimatedCost"}},[t("el-input",{attrs:{type:"number",placeholder:"单位（元）"},model:{value:e.addCaseForm.estimatedCost,callback:function(t){e.$set(e.addCaseForm,"estimatedCost",t)},expression:"addCaseForm.estimatedCost"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"实际费用",prop:"actualCost"}},[t("el-input",{attrs:{type:"number",placeholder:"单位（元）"},model:{value:e.addCaseForm.actualCost,callback:function(t){e.$set(e.addCaseForm,"actualCost",t)},expression:"addCaseForm.actualCost"}})],1)],1)],1),t("el-form-item",{attrs:{label:"负责人",prop:"directors"}},[t("el-cascader",{attrs:{options:e.directorOptions,"show-all-levels":!1,placeholder:"请选择负责人"},model:{value:e.addCaseForm.directors,callback:function(t){e.$set(e.addCaseForm,"directors",t)},expression:"addCaseForm.directors"}})],1),t("el-form-item",{attrs:{label:"专案描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",placeholder:"简要介绍专案"},model:{value:e.addCaseForm.description,callback:function(t){e.$set(e.addCaseForm,"description",t)},expression:"addCaseForm.description"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addCase()}}},[e._v("确 定")]),t("el-button",{on:{click:function(t){e.addCaseVisible=!1}}},[e._v("取 消")])],1)],1),t("el-dialog",{attrs:{title:"模式选择",visible:e.addRelationMenuVisible,width:"30%"},on:{"update:visible":function(t){e.addRelationMenuVisible=t}}},[t("el-col",{attrs:{span:8}},[t("el-dropdown",{attrs:{"split-button":"",type:"warning"},on:{command:e.openAddRelationSubByTemplate}},[e._v(" 按模板 "),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.templateList,(function(a){return t("el-dropdown-item",{key:a.id,attrs:{command:a.id}},[e._v(e._s(a.description))])})),1)],1)],1),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.openAddRelationSub(1)}}},[e._v("按流程")])],1),t("el-dialog",{attrs:{title:"关联子流程",visible:e.addRelationSubVisible,width:"50%"},on:{"update:visible":function(t){e.addRelationSubVisible=t},close:function(t){return e.addRelationSubClose()}}},[t("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.relationSub,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{prop:"realSort",label:"序号"}}),t("el-table-column",{attrs:{prop:"name",label:"名称"}}),t("el-table-column",{attrs:{label:"难度"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-select",{attrs:{placeholder:e.curLevel+""},on:{change:function(t){return e.getPresetDays(a.row)}},model:{value:a.row.level,callback:function(t){e.$set(a.row,"level",t)},expression:"scope.row.level"}},e._l(e.levelInfo,(function(e){return t("el-option",{key:e,attrs:{value:e}})})),1)]}}])}),t("el-table-column",{attrs:{label:"计划天数"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-input",{attrs:{placeholder:e.defaultDays[a.row.id]},model:{value:a.row.planDays,callback:function(t){e.$set(a.row,"planDays",t)},expression:"scope.row.planDays"}})]}}])}),t("el-table-column",{attrs:{label:"负责人"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-select",{key:e.forceUpdateKey,attrs:{multiple:"",filterable:"",placeholder:"请选择"},on:{change:function(t){return e.selectChange()}},model:{value:a.row.chargeId,callback:function(t){e.$set(a.row,"chargeId",t)},expression:"scope.row.chargeId"}},e._l(e.directorOptions,(function(a){return t("el-option-group",{key:a.value,attrs:{label:a.label}},e._l(a.children,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)})),1)]}}])})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addRelation()}}},[e._v("确 定")]),t("el-button",{on:{click:function(t){e.addRelationSubVisible=!1}}},[e._v("取 消")])],1)],1),t("el-dialog",{attrs:{title:"模板关联子流程",visible:e.addTempleteRelationSubVisible,width:"50%"},on:{"update:visible":function(t){e.addTempleteRelationSubVisible=t}}},[t("el-table",{attrs:{data:e.relationTemplateSub}},[t("el-table-column",{attrs:{prop:"name",label:"名称"}}),t("el-table-column",{attrs:{label:"难度"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-select",{attrs:{placeholder:e.curLevel+""},on:{change:function(t){return e.getPlanDays(a.row)}},model:{value:a.row.level,callback:function(t){e.$set(a.row,"level",t)},expression:"scope.row.level"}},e._l(e.levelInfo,(function(e){return t("el-option",{key:e,attrs:{value:e}})})),1)]}}])}),t("el-table-column",{attrs:{label:"计划天数"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-input",{attrs:{placeholder:e.defaultDays[a.row.id]+""},model:{value:a.row.planDays,callback:function(t){e.$set(a.row,"planDays",e._n(t))},expression:"scope.row.planDays"}})]}}])}),t("el-table-column",{attrs:{label:"负责人"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-select",{key:e.forceUpdateKey,attrs:{multiple:"",filterable:"",placeholder:"请选择负责人"},on:{change:function(t){return e.selectChange()}},model:{value:a.row.chargeId,callback:function(t){e.$set(a.row,"chargeId",t)},expression:"scope.row.chargeId"}},e._l(e.directorOptions,(function(a){return t("el-option-group",{key:a.value,attrs:{label:a.label}},e._l(a.children,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)})),1)]}}])})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addRelationByTemplate()}}},[e._v("确 定")]),t("el-button",{on:{click:function(t){e.addTempleteRelationSubVisible=!1}}},[e._v("取 消")])],1)],1),t("el-dialog",{attrs:{title:"编辑子流程",visible:e.editCaseSubRelationVisible,width:"70%"},on:{"update:visible":function(t){e.editCaseSubRelationVisible=t}}},[t("el-table",{attrs:{data:e.subInfo,border:"",stripe:""}},[t("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(a){return[e._l(a.row.chargeName,(function(s,i){return t("el-row",{key:s},[t("el-col",{attrs:{span:2}},[t("el-tag",{staticClass:"chargeNameTag",on:{click:function(t){return e.getCaseByUserId(a.row.chargeId[i],s)}}},[e._v(" "+e._s(s)+" ")])],1)],1)})),0===a.row.chargeId.length?t("el-tag",[e._v("暂无负责人")]):e._e()]}}])}),t("el-table-column",{attrs:{prop:"subName",label:"子流程"}}),t("el-table-column",{staticStyle:{display:"flex","align-items":"center"},attrs:{prop:"sort",label:"执行顺序"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{round:"",type:"primary",size:"mini",icon:"el-icon-minus"},on:{click:function(e){a.row.sort--}}}),t("span",{staticStyle:{"font-size":"20px","padding-left":"5px","padding-right":"5px"}},[e._v(e._s(a.row.sort))]),t("el-button",{attrs:{round:"",type:"primary",size:"mini",icon:"el-icon-plus"},on:{click:function(e){a.row.sort++}}})]}}])}),t("el-table-column",{attrs:{prop:"startTime",label:"开始时间"}}),t("el-table-column",{attrs:{prop:"finishTime",label:"完成时间"}}),t("el-table-column",{attrs:{prop:"planDays",label:"计划时间"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tooltip",{attrs:{effect:"dark",content:"添加在该阶段之后",placement:"top"}},[t("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus",round:""},on:{click:function(t){return e.openAddRelationSub(2,a.row)}}})],1),null===a.row.startTime?t("el-tooltip",{attrs:{effect:"dark",content:"删除该阶段",placement:"top"}},[t("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete",round:""},on:{click:function(t){return e.deleteRelationSub(a.row)}}})],1):e._e()]}}])})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.updateCaseSubSort()}}},[e._v("修改顺序并刷新")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.editCaseSubRelationVisible=!1}}},[e._v("确 定")]),t("el-button",{on:{click:function(t){e.editCaseSubRelationVisible=!1}}},[e._v("取 消")])],1)],1),t("el-dialog",{attrs:{title:`添加新阶段(${e.lastSubObj.subName}之后)`,visible:e.addNewSubVisible,width:"30%"},on:{"update:visible":function(t){e.addNewSubVisible=t},close:function(t){e.newSubObj={}}}},[t("el-form",{ref:"addNewSubFormRef",attrs:{rules:e.addNewSubRules,model:e.newSubObj,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"子流程",prop:"id"}},[t("el-select",{attrs:{placeholder:"请选择子流程"},model:{value:e.newSubObj.id,callback:function(t){e.$set(e.newSubObj,"id",t)},expression:"newSubObj.id"}},e._l(e.relationSub,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"难度",prop:"level"}},[t("el-select",{attrs:{placeholder:"请选择难度"},on:{change:function(t){return e.getPresetDays(e.newSubObj)}},model:{value:e.newSubObj.level,callback:function(t){e.$set(e.newSubObj,"level",t)},expression:"newSubObj.level"}},e._l([1,2,3,4,5,6,7,8,9,10],(function(e){return t("el-option",{key:e,attrs:{value:e}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"计划时间",prop:"planDays"}},[t("el-input",{model:{value:e.newSubObj.planDays,callback:function(t){e.$set(e.newSubObj,"planDays",t)},expression:"newSubObj.planDays"}})],1)],1)],1),t("el-form-item",{attrs:{label:"负责人",prop:"chargeId"}},[t("el-select",{attrs:{multiple:"",placeholder:"请选择负责人"},model:{value:e.newSubObj.chargeId,callback:function(t){e.$set(e.newSubObj,"chargeId",t)},expression:"newSubObj.chargeId"}},e._l(e.directorOptions,(function(a){return t("el-option-group",{key:a.value,attrs:{label:a.label}},e._l(a.children,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addNewSub()}}},[e._v("确 定")]),t("el-button",{on:{click:function(t){e.addNewSubVisible=!1}}},[e._v("取 消")])],1)],1)],1)},Pt=[];const Et=e=>ur.post("/subTemplate",e),Mt=e=>ur.get(`/subTemplate/${e}`),Bt=e=>ur.get("/template/list",{params:e}),Gt=e=>ur.put("/subTemplate",e),Ht=e=>ur.delete(`/subTemplate/${e}`),Zt=e=>ur.get(`subTemplate/getSubs/${e}`);var Yt={name:"caseManage",data(){var e=(e,t,a)=>{t<0&&a(new Error("费用必须是非负数")),a()};return{dialogTitle:"新增专案",pageInfo:[],queryInfo:{page:1,pageSize:7,query:"",director:"",showTerminated:!1},total:0,addCaseVisible:!1,addCaseForm:{name:"",description:"",number:null,level:null,directors:null,estimatedCost:null,actualCost:null},newFlag:0,addRelationSubVisible:!1,addTempleteRelationSubVisible:!1,addCaseRules:{name:[{required:!0,message:"请输入专案名称",trigger:"blur"}],level:[{required:!0,message:"请输入难度",trigger:"blur"}],directors:[{required:!0,message:"请选择负责人",trigger:"blur"}],estimatedCost:[{validator:e,trigger:"blur"}],actualCost:[{validator:e,trigger:"blur"}]},directorOptions:[{value:0,label:"机构",children:[]},{value:1,label:"电控",children:[]},{value:2,label:"IE",children:[]}],addRelationMenuVisible:!1,allUser:[],relationSub:[],relationTemplateSub:[],levelInfo:[1,2,3,4,5,6,7,8,9,10],insertInfo:[],templateLidirectorOptionsallUst:[],case_sub_sort:0,forceUpdateKey:null,templateList:[],subTemplate:{description:"",subIds:[]},editCaseSubRelationVisible:!1,subInfo:[],addNewSubVisible:!1,addNewSubRules:{id:[{required:!0,message:"请选择要插入的子流程",trigger:"blur"}],level:[{required:!0,message:"请选择难度",trigger:"blur"}],planDays:[{required:!0,message:"计划时间不能为空",trigger:"blur"}],chargeId:[{required:!0,message:"请选择负责人",trigger:"blur"}]},newSubObj:{},lastSubObj:{}}},computed:{...(0,k.rn)(["user"])},created(){this.getTableDate(),this.getAllUser()},async mounted(){for(var{data:e}=await Me(),t=0;t<e.length;t++)this.directorOptions[e[t].status].children.push({value:e[t].id,label:e[t].name})},methods:{async getTableDate(){var e=await _e(this.queryInfo);this.pageInfo=e.data.records,this.total=e.data.total},async editCase(e){this.addCaseForm={...e};const t=await We(e.director);200===t.code?(this.addCaseForm["directors"]=[t.data,e.director],this.dialogTitle="修改专案",this.newFlag=1,this.addCaseVisible=!0):this.$message.error("获取用户职务失败")},handleSizeChange(e){this.queryInfo.pageSize=e,this.queryInfo.page=1,this.getTableDate()},handleCurrentChange(e){this.queryInfo.page=e,this.getTableDate()},async openAddCase(){this.dialogTitle="新增专案",this.newFlag=0,this.addCaseVisible=!0},addCaseFormClose(){this.$refs.addCaseFormRef.resetFields(),this.addCaseForm.director=null},addCase(){this.$refs.addCaseFormRef.validate((async e=>{if(e){if(this.addCaseForm.director=this.addCaseForm.directors[1],this.addCaseForm.createUser=this.user.id,this.addCaseForm.terminate=0,0===this.newFlag)var t=await Le(this.addCaseForm);else t=await Fe(this.addCaseForm);Ar(t),200===t.code&&(this.addCaseVisible=!1,this.getTableDate())}}))},async openAddRelationSub(e,t){await this.getAllSub(e),1===e?this.addRelationSubVisible=!0:2===e&&(this.addNewSubVisible=!0,this.newSubObj.sort=t.sort+1,this.lastSubObj={...t})},async getAllSub(e){const t=await Lt();if(this.defaultDays={},200===t.code){if(this.relationSub=t.data,2!==e)for(var a=0;a<this.relationSub.length;a++){const e=await At({subId:this.relationSub[a].id,level:this.curLevel});this.defaultDays[this.relationSub[a].id]=e.data,this.relationSub[a].chargeId=[this.curDirector]}}else this.$message.error(t.msg)},async getAllUser(){const e=await Me();200===e.code?this.allUser=e.data:this.$message.error(e.msg)},async getPresetDays(e){if(!("id"in e))return this.$message.error("未找到子流程数据，请确认是否已经选择子流程"),void this.$set(e,"level",null);const t=await At({subId:e.id,level:e.level});this.$set(e,"planDays",t.data)},handleSelectionChange(e){this.insertInfo=e;for(var t=1,a=0;a<this.relationSub.length;a++)this.relationSub[a].realSort=null;for(var s=0;s<this.insertInfo.length;s++)for(a=0;a<this.relationSub.length;a++)if(this.relationSub[a].id===this.insertInfo[s].id){this.relationSub[a].realSort=t,t++;break}},addRelationSubClose(){this.relationSub=[],this.case_sub_sort=-1},async addRelation(){if(0===this.insertInfo.length)return void this.$message.error("请勾选要添加的子流程");for(var e=0;e<this.insertInfo.length;e++){if(this.insertInfo[e].subId=this.insertInfo[e].id,!("planDays"in this.insertInfo[e])||this.insertInfo[e].planDays<=0){if(null===this.defaultDays[this.insertInfo[e].id])return void this.$message.error("部分阶段的计划天数为空或者小于等于0，请检查输入");this.insertInfo[e].planDays=this.defaultDays[this.insertInfo[e].id]}"level"in this.insertInfo[e]||null===this.insertInfo[e].level||(this.insertInfo[e].level=this.curLevel),this.insertInfo[e].caseId=this.curCaseId}for(e=0;e<this.insertInfo.length;e++)this.insertInfo[e].id=null;const t=await mr(this.insertInfo);200===t.code?(this.$message.success(t.data),this.addRelationSubVisible=!1,this.addRelationMenuVisible=!1,this.getTableDate(),this.subTemplate.subIds=this.insertInfo.map((e=>e.subId)),this.$confirm("存储模板","是否要将当前勾选顺序存储为模板",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$prompt("请输入模板描述（名称）","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\S+$/,inputErrorMessage:"模板描述不可为空"}).then((async({value:e})=>{this.subTemplate.description=e;const t=await Et(this.subTemplate);200===t.code?this.$message.success(t.data):this.$message.error(t.msg)}))}))):this.$message.error(t.msg)},async openAddRelationMenu(e){this.curCaseId=e.id,this.curLevel=e.level,this.curDirector=e.director;const t=await Bt({page:1,pageSize:20,query:""});this.templateList=t.data.records,this.addRelationMenuVisible=!0},deleteCase(e){this.$confirm(`此操作将永久删除 “${e.name}” 专案以及关联负责人、子流程信息, 是否继续?`,"操作不可逆",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await Oe(e.id);200===t.code?(this.$message.success(t.data),this.getTableDate()):this.$message.error(t.msg)})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},async openAddRelationSubByTemplate(e){const t=await Zt(e);200===t.code?(this.relationTemplateSub=t.data,await this.setDefaultRelationSub()):this.$message.error(t.msg),this.addTempleteRelationSubVisible=!0},async addRelationByTemplate(){for(var e=0;e<this.relationTemplateSub.length;e++)this.relationTemplateSub[e].subId=this.relationTemplateSub[e].id,"level"in this.relationTemplateSub[e]&&null!==this.relationTemplateSub[e].level||(this.relationTemplateSub[e].level=this.curLevel),"planDays"in this.relationTemplateSub[e]&&null!==this.relationTemplateSub[e].planDays||(this.relationTemplateSub[e].planDays=this.defaultDays[this.relationTemplateSub[e].id]),this.relationTemplateSub[e].caseId=this.curCaseId,this.relationTemplateSub[e].id=null;const t=await mr(this.relationTemplateSub);200===t.code?(this.$message.success(t.data),this.addTempleteRelationSubVisible=!1,this.addRelationMenuVisible=!1,this.getTableDate()):this.$message.error(t.msg)},async setDefaultRelationSub(){this.defaultDays={};for(var e=0;e<this.relationTemplateSub.length;e++){const t=await At({subId:this.relationTemplateSub[e].id,level:this.curLevel});this.defaultDays[this.relationTemplateSub[e].id]=t.data,this.relationTemplateSub[e].chargeId=[this.curDirector]}},async getPlanDays(e){e.subId=e.id;const t=await At({subId:e.subId,level:e.level});this.$set(e,"planDays",t.data)},selectChange(){this.forceUpdateKey=Math.random(),this.$forceUpdate()},async terminateCase(e,t){this.$confirm(`此操作将${t?"冻结":"重启"} “${e.name}” 专案,${t?"正在执行的阶段数据将丢失，":""} 是否继续?`,"操作不可逆",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{e.terminate=t;const a=await Ae(e);200==a.code?(this.$message.success(a.data),this.getTableDate()):this.$message.error(a.msg)}))},jump2detail(e){this.$router.push({name:"子流程详情",query:{caseName:e.name,caseId:e.id}})},async openEditCaseSub(e){this.newSubObj.caseId=e.id,this.curLevel=e.level,this.editCaseSubRelationVisible=!0;var t=await pr(e.id);200===t.code?this.subInfo=t.data:this.$message.error(t.msg)},addNewSub(){this.$refs.addNewSubFormRef.validate((async e=>{if(e){this.newSubObj.subId=this.newSubObj.id,this.newSubObj.id=null;var t=await Tr(this.newSubObj);200===t.code&&(this.$message.success(t.data),this.addNewSubVisible=!1);t=await pr(this.newSubObj.caseId);200===t.code&&(this.subInfo=t.data)}}))},async deleteRelationSub(e){var t=await Sr(e);if(200===t.code){this.$message.success(t.data);t=await pr(e.caseId);200===t.code&&(this.subInfo=t.data)}},async updateCaseSubSort(){var e=await xr(this.subInfo);if(200===e.code){this.$message.success(e.data);e=await pr(this.newSubObj.caseId);200===e.code&&(this.subInfo=e.data)}}}},Wt=Yt,Xt=(0,o.Z)(Wt,Nt,Pt,!1,null,"66036f82",null),Qt=Xt.exports,Jt=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/index"}}},[e._v("主页")]),t("el-breadcrumb-item",[e._v("专案管理")]),t("el-breadcrumb-item",[e._v("子流程管理")])],1)],1),t("el-card",[t("div",{staticClass:"query_and_add"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{placeholder:"请输入子流程名称",disabled:""}})],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-search",disabled:""}},[e._v("查询")])],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){e.addSubFormVisible=!0}}},[e._v("新增子流程")])],1)],1)],1),t("el-table",{attrs:{data:e.subList,border:"",scrope:""}},[t("el-table-column",{attrs:{prop:"id",label:"编号"}}),t("el-table-column",{attrs:{prop:"name",label:"流程名"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(t){return e.openEditSub(a.row)}}}),e._e()]}}])})],1),t("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"left"},attrs:{"current-page":e.queryInfo.page,"page-sizes":[5,7,10,20],"page-size":e.queryInfo.pageSize,layout:"total, sizes, prev, pager, next",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){return e.$set(e.queryInfo,"page",t)},"update:current-page":function(t){return e.$set(e.queryInfo,"page",t)}}})],1),t("el-dialog",{attrs:{title:"新增子流程",visible:e.addSubFormVisible,width:"30%"},on:{"update:visible":function(t){e.addSubFormVisible=t},close:function(t){return e.resetFields()}}},[t("el-form",{ref:"subFormRef",attrs:{model:e.subForm,"label-width":"100px",rules:e.subFormRules}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"子流程名称",prop:"name"}},[t("el-input",{model:{value:e.subForm.name,callback:function(t){e.$set(e.subForm,"name",t)},expression:"subForm.name"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"子流程序号",prop:"sort"}},[t("el-input",{model:{value:e.subForm.sort,callback:function(t){e.$set(e.subForm,"sort",e._n(t))},expression:"subForm.sort"}})],1)],1)],1),t("el-row",[t("label",{staticStyle:{display:"flex","justify-content":"center","font-size":"20px","margin-bottom":"3px"}},[e._v("难度对应执行天数")])]),e._l([1,2,3,4,5,6,7,8,9,10],(function(a){return t("el-form-item",{key:a,attrs:{label:`难度:${a}`}},[t("el-input",{attrs:{placeholder:a},model:{value:e.subForm.l2p[a-1],callback:function(t){e.$set(e.subForm.l2p,a-1,e._n(t))},expression:"subForm.l2p[item - 1]"}})],1)}))],2),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addSubFormVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addSub(1)}}},[e._v("确 定")]),t("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.addSub(2)}}},[e._v("确定并继续添加")])],1)],1),t("el-dialog",{attrs:{title:"修改子流程",visible:e.editSubFormVisible,width:"30%"},on:{"update:visible":function(t){e.editSubFormVisible=t},close:function(t){e.subForm.name=null}}},[t("el-form",{ref:"editSubFormRef",attrs:{model:e.subForm,"label-width":"90px"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"子流程名称",prop:"name"}},[t("el-input",{model:{value:e.subForm.name,callback:function(t){e.$set(e.subForm,"name",t)},expression:"subForm.name"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"子流程序号",prop:"sort"}},[t("el-input",{model:{value:e.subForm.sort,callback:function(t){e.$set(e.subForm,"sort",e._n(t))},expression:"subForm.sort"}})],1)],1)],1),t("el-row",[t("label",{staticStyle:{display:"flex","justify-content":"center","font-size":"20px","margin-bottom":"3px"}},[e._v("难度对应执行天数")])]),e._l([1,2,3,4,5,6,7,8,9,10],(function(a){return t("el-form-item",{key:a,attrs:{label:`难度:${a}`}},[t("el-input",{attrs:{placeholder:a},model:{value:e.subForm.l2p[a-1],callback:function(t){e.$set(e.subForm.l2p,a-1,e._n(t))},expression:"subForm.l2p[item - 1]"}})],1)}))],2),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editSubFormVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.editSub()}}},[e._v("修 改")])],1)],1)],1)},Kt=[],ea={data(){return{subList:[],queryInfo:{query:"",page:1,pageSize:7},total:null,addSubFormVisible:!1,editSubFormVisible:!1,subForm:{name:"",sort:"",l2p:[1,1,1,1,1,1,1,1,1,1]},subFormRules:{name:[{required:!0,message:"请输入子流程名称",trigger:"blur"}],sort:[{required:!0,message:"请输入子流程序号",trigger:"blur"}]}}},created(){this.getSubList()},methods:{async getSubList(){const e=await Ft(this.queryInfo);this.subList=e.data.records,this.total=e.data.total},handleSizeChange(e){this.queryInfo.pageSize=e,this.queryInfo.page=1,this.getSubList()},handleCurrentChange(e){this.queryInfo.page=e,this.getSubList()},addSub(e){this.subForm.id=null,this.$refs.subFormRef.validate((async t=>{if(t){if(!this.checkLevel(this.subForm.l2p))return void this.$message.error("计划天数设定不合理，请检查是否有空值或者非正数值");const t=await Ot(this.subForm);200===t.code?(this.$message.success(t.data),1===e?(this.addSubFormVisible=!1,this.getSubList()):2===e&&this.resetFields()):this.$message.error(t.msg)}}))},async openEditSub(e){const t=await $t(e.id);this.subForm={...t.data},this.editSubFormVisible=!0},async editSub(){""!==this.subForm.name?this.$refs.editSubFormRef.validate((async e=>{if(e){if(!this.checkLevel(this.subForm.l2p))return void this.$message.error("计划天数设定不合理，请检查是否有空值或者非正数值");const e=await jt(this.subForm);200===e.code?(this.$message.success(e.data),this.editSubFormVisible=!1,this.getSubList()):this.$message.error(e.msg)}})):this.$message.error("名称不可为空")},resetFields(){this.subForm={name:"",sort:"",l2p:[1,1,1,1,1,1,1,1,1,1]}},checkLevel(e){for(var t=0;t<10;t++){if(null===e[t]||""===e[t])return!1;if(e[t]<=0)return!1}return!0},removeSub(e){this.$confirm(`你正在删除 "${e.name}"，此操作将永久删除该子流程以及对应计划天数信息，是否继续`,"危险操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"danger"}).then((async()=>{const t=await zt(e.id);200===t.code?(this.$message.success(t.data),this.getSubList()):this.$message.error(t.msg)})).catch((()=>{}))}}},ta=ea,aa=(0,o.Z)(ta,Jt,Kt,!1,null,"25c31c12",null),sa=aa.exports,ia=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/index"}}},[e._v("主页")]),t("el-breadcrumb-item",[e._v("专案管理")]),t("el-breadcrumb-item",[e._v("模板管理")])],1)],1),t("el-card",[t("div",{staticClass:"query_and_add"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{placeholder:"请输入模板名称",disabled:""}})],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-search",disabled:""}},[e._v("查询")])],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.openAddTemplete()}}},[e._v("新增模板")])],1)],1)],1),t("el-table",{attrs:{data:e.templeteList,border:"",scrope:""}},[t("el-table-column",{attrs:{type:"index"}}),t("el-table-column",{attrs:{prop:"description",label:"模板描述"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(t){return e.showDetail(a.row)}}}),t("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:function(t){return e.deleteTemplete(a.row.id)}}})]}}])})],1),t("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"left"},attrs:{"current-page":e.queryInfo.page,"page-sizes":[5,7,10,20],"page-size":e.queryInfo.pageSize,layout:"total, sizes, prev, pager, next",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){return e.$set(e.queryInfo,"page",t)},"update:current-page":function(t){return e.$set(e.queryInfo,"page",t)}}})],1),t("el-dialog",{attrs:{title:"新增模板",visible:e.addTempleteFormVisible,width:"50%"},on:{"update:visible":function(t){e.addTempleteFormVisible=t},close:function(t){return e.closeAddTemplete()}}},[t("el-form",{ref:"addTempleteFormRef",attrs:{model:e.templeteForm,"label-width":"90px"}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"模板描述"}},[t("el-input",{model:{value:e.templeteForm.description,callback:function(t){e.$set(e.templeteForm,"description",t)},expression:"templeteForm.description"}})],1)],1)],1),t("el-form-item",{attrs:{label:"内容"}},[t("el-transfer",{staticClass:"custom-transfer",attrs:{"target-order":"push",data:e.allSub,"button-texts":["移除","添加"],titles:["源","目标"],props:{key:"id",label:"name"}},model:{value:e.templeteForm.subIds,callback:function(t){e.$set(e.templeteForm,"subIds",t)},expression:"templeteForm.subIds"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addTempleteFormVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addTemplete()}}},[e._v("提 交")])],1)],1),t("el-dialog",{attrs:{title:"修改模板",visible:e.editTempleteFormVisible,width:"50%"},on:{"update:visible":function(t){e.editTempleteFormVisible=t}}},[t("el-form",{attrs:{model:e.editTempleteForm,"label-width":"90px"}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"模板描述"}},[t("el-input",{model:{value:e.editTempleteForm.description,callback:function(t){e.$set(e.editTempleteForm,"description",t)},expression:"editTempleteForm.description"}})],1)],1)],1),t("el-form-item",{attrs:{label:"内容"}},[t("el-transfer",{attrs:{"target-order":"push",data:e.allSub,"button-texts":["移除","添加"],titles:["源","目标"],props:{key:"id",label:"name"}},model:{value:e.editTempleteForm.subIds,callback:function(t){e.$set(e.editTempleteForm,"subIds",t)},expression:"editTempleteForm.subIds"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editTempleteFormVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.editTemplete()}}},[e._v("提 交")])],1)],1)],1)},ra=[],la={data(){return{allSub:[],templeteList:[],queryInfo:{query:"",page:1,pageSize:7},total:null,addTempleteFormVisible:!1,templeteForm:{description:"",subIds:[]},editTempleteFormVisible:!1,editTempleteForm:{id:"",description:"",subIds:[]}}},created(){this.getAllSub(),this.getTempleteList()},methods:{async getTempleteList(){const e=await Bt(this.queryInfo);this.templeteList=e.data.records,this.total=e.data.total},async getAllSub(){const e=await Lt();200===e.code?this.allSub=e.data:this.$message.error(e.msg)},handleSizeChange(e){this.queryInfo.pageSize=e,this.queryInfo.page=1,this.getTempleteList()},handleCurrentChange(e){this.queryInfo.page=e,this.getTempleteList()},async openAddTemplete(){this.addTempleteFormVisible=!0},closeAddTemplete(){this.templeteForm={description:"",subIds:[]}},async addTemplete(){if(0===this.templeteForm.subIds.length)return void this.$message.error("子流程勾选后需要放置到右边才生效");if(""===this.templeteForm.description)return void this.$message.error("模板描述不可为空");const e=await Et(this.templeteForm);200===e.code?(this.$message.success(e.data),this.getTempleteList(),this.addTempleteFormVisible=!1):this.$message.error(e.msg)},async showDetail(e){this.$set(this.editTempleteForm,"id",e.id),this.$set(this.editTempleteForm,"description",e.description);const t=await Mt(e.id);this.$set(this.editTempleteForm,"subIds",t.data),this.editTempleteFormVisible=!0},async editTemplete(){if(0===this.editTempleteForm.subIds.length)return void this.$message.error("子流程勾选后需要放置到右边才生效");if(""===this.editTempleteForm.description)return void this.$message.error("模板描述不可为空");const e=await Gt(this.editTempleteForm);200===e.code?(this.$message.success(e.data),this.getTempleteList(),this.editTempleteFormVisible=!1):this.$message.error(e.msg)},deleteTemplete(e){this.$confirm("此操作将永久删除该模板, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await Ht(e);200===t.code?(this.$message.success(t.data),this.getTempleteList()):this.$message.error(t.msg)})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))}}},na=la,oa=(0,o.Z)(na,ia,ra,!1,null,"708f4ab5",null),ca=oa.exports,ua=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",[e._v("专案管理")]),t("el-breadcrumb-item",[e._v("任务管理")])],1)],1),t("el-card",[t("el-row",[t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus"},on:{click:function(t){return e.openAddTask()}}},[e._v("新建任务")])],1),t("el-col",{attrs:{span:3,offset:19}},[t("el-select",{attrs:{placeholder:"请选择科员"},on:{change:function(t){return e.handleUserChange()}},model:{value:e.curUser,callback:function(t){e.curUser=t},expression:"curUser"}},e._l(e.directorOptions,(function(a){return t("el-option-group",{key:a.value,attrs:{label:a.label}},e._l(a.children,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)})),1)],1)],1),t("br"),t("el-table",{attrs:{data:e.taskList}},[t("el-table-column",{attrs:{label:"类型"},scopedSlots:e._u([{key:"default",fn:function(a){return[1===a.row.type?t("el-tag",{attrs:{effect:"dark",type:"warning"}},[e._v("临时事务")]):2===a.row.type?t("el-tag",{attrs:{effect:"dark",type:"primary"}},[e._v("技术研究")]):e._e()]}}])}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"startTime",label:"开始时间"}}),t("el-table-column",{attrs:{prop:"predictTime",label:"预计时间"}}),t("el-table-column",{attrs:{prop:"finishTime",label:"完成时间"}}),t("el-table-column",{attrs:{prop:"planDays",label:"计划时间"}}),t("el-table-column",{attrs:{prop:"executionDays",label:"执行时间"}}),t("el-table-column",{attrs:{prop:"unforcedDays",label:"外界因素延期"}}),t("el-table-column",{attrs:{prop:"applyDelay",label:"人为因素延期"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"任务详情",placement:"right-start"}},[t("el-button",{attrs:{icon:"el-icon-edit",type:"primary",size:"mini",round:""},on:{click:function(t){return e.openTaskDetail(a.row)}}})],1)]}}])})],1)],1),t("el-dialog",{attrs:{title:"任务详情",visible:e.taskDetailVisible,width:"30%"},on:{"update:visible":function(t){e.taskDetailVisible=t}}},[t("el-form",{ref:"editCaseSubRef",attrs:{"label-width":"90px"}},[t("el-form-item",{attrs:{label:"描述"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.curTaskObj.description,callback:function(t){e.$set(e.curTaskObj,"description",t)},expression:"curTaskObj.description"}})],1),t("el-row",[t("el-col",{attrs:{span:10}},[t("el-form-item",{attrs:{label:"计划天数"}},[t("el-input",{model:{value:e.curTaskObj.planDays,callback:function(t){e.$set(e.curTaskObj,"planDays",t)},expression:"curTaskObj.planDays"}})],1)],1),t("el-col",{attrs:{span:12,offset:2}},[t("el-form-item",{attrs:{label:"负责人"}},[t("el-select",{attrs:{placeholder:"请选择科员"},on:{change:function(t){return e.handleUserChange()}},model:{value:e.curTaskObj.director,callback:function(t){e.$set(e.curTaskObj,"director",t)},expression:"curTaskObj.director"}},e._l(e.directorOptions,(function(a){return t("el-option-group",{key:a.value,attrs:{label:a.label}},e._l(a.children,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)})),1)],1)],1)],1),t("el-form-item",{attrs:{label:"开始时间"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"开始日期"},model:{value:e.curTaskObj.startTime,callback:function(t){e.$set(e.curTaskObj,"startTime",t)},expression:"curTaskObj.startTime"}})],1),t("el-form-item",{attrs:{label:"结束时间"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"结束时间"},model:{value:e.curTaskObj.finishTime,callback:function(t){e.$set(e.curTaskObj,"finishTime",t)},expression:"curTaskObj.finishTime"}})],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"外界延期"}},[t("el-input",{model:{value:e.curTaskObj.unforcedDays,callback:function(t){e.$set(e.curTaskObj,"unforcedDays",t)},expression:"curTaskObj.unforcedDays"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"人为延期"}},[t("el-input",{model:{value:e.curTaskObj.applyDelay,callback:function(t){e.$set(e.curTaskObj,"applyDelay",t)},expression:"curTaskObj.applyDelay"}})],1)],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.taskDetailVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitTaskChange()}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"任务详情",visible:e.addTaskVisible,width:"30%"},on:{"update:visible":function(t){e.addTaskVisible=t}}},[t("el-form",{ref:"addTaskFormRef",attrs:{rules:e.applyTaskRules,model:e.addTaskObj,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"任务类型",prop:"type"}},[t("el-select",{attrs:{placeholder:"请选择任务类型"},model:{value:e.addTaskObj.type,callback:function(t){e.$set(e.addTaskObj,"type",t)},expression:"addTaskObj.type"}},e._l([{label:"技术研究",value:2},{label:"临时事务",value:1}],(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"任务描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入任务描述"},model:{value:e.addTaskObj.description,callback:function(t){e.$set(e.addTaskObj,"description",t)},expression:"addTaskObj.description"}})],1),t("el-form-item",{attrs:{label:"预估时间",prop:"planDays"}},[t("el-input",{attrs:{type:"number",placeholder:"请输入预估完成时间（天）"},model:{value:e.addTaskObj.planDays,callback:function(t){e.$set(e.addTaskObj,"planDays",e._n(t))},expression:"addTaskObj.planDays"}})],1),t("el-form-item",{attrs:{label:"负责人",prop:"director"}},[t("el-select",{attrs:{placeholder:"请选择科员"},model:{value:e.addTaskObj.director,callback:function(t){e.$set(e.addTaskObj,"director",t)},expression:"addTaskObj.director"}},e._l(e.directorOptions,(function(a){return t("el-option-group",{key:a.value,attrs:{label:a.label}},e._l(a.children,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addTaskVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addTask()}}},[e._v("确 定")])],1)],1)],1)},pa=[];const da=e=>ur.get(`/task/taskList/${e}`),ha=e=>ur.get(`/task/notStartTaskList/${e}`),ma=e=>ur.get(`/task/allFinishTask/${e}`),ba=e=>ur.get("/task/taskList",{params:{userId:e}}),fa=e=>ur.put("/task/updateTask",e),ya=e=>ur.post("/task/addTask",e),ga=e=>ur.get(`/task/exception/${e}`);var va={data(){var e=(e,t,a)=>{null!==t&&""!==t||a(new Error("申请天数不能为空")),t<1&&a(new Error("申请天数必须大于1")),a()};return{taskList:[],directorOptions:[{value:0,label:"机构",children:[]},{value:1,label:"电控",children:[]},{value:2,label:"IE",children:[]}],curUser:null,taskDetailVisible:!1,curTaskObj:{},addTaskVisible:!1,applyTaskRules:{type:[{required:!0,message:"请选择任务类型",trigger:"blur"}],description:[{required:!0,message:"请填写任务内容描述",trigger:"blur"}],planDays:[{required:!0,message:"申请天数不能为空",trigger:"blur"},{validator:e,trigger:"blur"}],director:[{required:!0,message:"请指派负责人",trigger:"change"}]},addTaskObj:{director:null}}},async created(){await this.getAllUser(),this.curUser=this.directorOptions[0].children[0].value,this.getAllTaskList()},computed:{...(0,k.rn)(["user"])},methods:{async getAllTaskList(){const e=await ba(this.curUser);200===e.code?(this.taskList=e.data,this.taskList.forEach((e=>{e.predictTime=Or(e.startTime,e.planDays),null!==e.finishTime?(e.executionDays=jr(e.startTime,e.finishTime),e.executionDays-=e.unforcedDays):(e.executionDays=jr(e.startTime,new Date),e.executionDays-=e.unforcedDays)}))):this.$message.error(e.msg)},async getAllUser(){for(var{data:e}=await Me(),t=0;t<e.length;t++)this.directorOptions[e[t].status].children.push({value:e[t].id,label:e[t].name})},handleUserChange(){this.getAllTaskList()},openTaskDetail(e){this.taskDetailVisible=!0,this.curTaskObj={},this.curTaskObj={...e}},async submitTaskChange(){if(""===this.curTaskObj.description||null===this.curTaskObj.description)return void this.$message.error("描述请不要置空");if(""===this.curTaskObj.planDays||null===this.curTaskObj.planDays)return void this.$message.error("计划天数请不要置空");if(null===this.curTaskObj.startTime&&null!==this.curTaskObj.finishTime)return void this.$message.error("开始时间为空，但是结束时间不为空");this.curTaskObj.startTime=_r(this.curTaskObj.startTime),this.curTaskObj.finishTime=_r(this.curTaskObj.finishTime);const e=await fa(this.curTaskObj);200===e.code?(this.$message.success(e.data),this.taskDetailVisible=!1,this.getAllTaskList()):this.$message.error(e.msg)},openAddTask(){this.addTaskVisible=!0},addTask(){this.$refs.addTaskFormRef.validate((async e=>{if(e){this.addTaskObj.createUser=this.user.id;const e=await ya(this.addTaskObj);200===e.code?(this.addTaskVisible=!1,this.$message.success(e.data),this.getAllTaskList()):this.$message.error(e.msg)}}))}}},wa=va,ka=(0,o.Z)(wa,ua,pa,!1,null,null,null),Ta=ka.exports,Sa=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",{attrs:{to:"/index"}},[e._v("主页")]),t("el-breadcrumb-item",[e._v("审批流程")]),t("el-breadcrumb-item",[e._v("异常专案处理")])],1)],1),t("el-card",[t("div",[t("el-row",[t("el-col",{attrs:{span:1,offset:8}},[t("h1",[t("i",{staticClass:"el-icon-error",staticStyle:{color:"red"}})])]),t("el-col",{attrs:{span:4,offset:0}},[t("h1",{staticStyle:{"text-align":"center"}},[e._v("异常专案处理")])])],1)],1),t("el-table",{staticStyle:{"font-size":"15px"},attrs:{data:e.subInfo,"highlight-current-row":!0}},[t("el-table-column",{attrs:{prop:"caseName",label:"专案"}}),t("el-table-column",{attrs:{prop:"subName",label:"子流程"}}),t("el-table-column",{attrs:{prop:"level",label:"难度"}}),t("el-table-column",{attrs:{prop:"planDays",label:"计划时间"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[1===e.user.type&&null===a.row.startTime?t("el-tooltip",{attrs:{effect:"dark",content:"开始阶段",placement:"top",enterable:!1}},[t("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-video-play",round:""},on:{click:function(t){return e.launch(a.row)}}})],1):e._e(),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"专案详情",placement:"right-start"}},[t("el-button",{attrs:{icon:"el-icon-s-promotion",type:"primary",size:"mini",round:""},on:{click:function(t){return e.openCaseDetail(a.row)}}})],1)]}}])})],1)],1),t("el-dialog",{attrs:{title:"阶段暂无负责人",visible:e.setDirectorVisible,width:"30%"},on:{"update:visible":function(t){e.setDirectorVisible=t}}},[t("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择负责人"},model:{value:e.directors,callback:function(t){e.directors=t},expression:"directors"}},e._l(e.allUser,(function(a){return t("el-option-group",{key:a.value,attrs:{label:a.label}},e._l(a.children,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)})),1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.setDirectorVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.launchSub(e.curCaseSub)}}},[e._v("无负责人启动")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.setDirectorFn()}}},[e._v("确 定")])],1)],1)],1)},xa=[],Ca={name:"checkException",data(){return{subInfo:[],setDirectorVisible:!1,directors:[],curCaseSub:null,allUser:[{value:0,label:"机构",children:[]},{value:1,label:"电控",children:[]},{value:2,label:"IE",children:[]}]}},created(){this.exceptionSub(),this.getAllUser()},computed:{...(0,k.rn)(["user"])},methods:{async exceptionSub(){const e=await br();this.subInfo=e.data},async launch(e){this.initSetDirector(e.id)},initSetDirector(e){this.setDirectorVisible=!0,this.directors=null,this.curCaseSub=e},async getAllUser(){const e=await Me();200===e.code?(this.editUser=e.data,e.data.forEach((e=>{this.allUser[e.status].children.push(e)}))):this.$message.error(e.msg)},async launchSub(e){var t=await yr({id:e,startTime:Lr(new Date)+" 00:00:00"});200===t.code?(this.$message.success(t.data),this.setDirectorVisible=!1,this.exceptionSub(this.caseId)):this.$message.error(t.msg)},async setDirectorFn(){const e=await bt({id:this.curCaseSub,chargeId:this.directors});200===e.code?(this.$message.success(e.data),this.launchSub(this.curCaseSub)):this.$message.error(e.msg)},openCaseDetail(e){this.$router.push({name:"子流程详情",query:{caseId:e.caseId,caseName:e.caseName}})}}},Da=Ca,Ia=(0,o.Z)(Da,Sa,xa,!1,null,"94c11eea",null),_a=Ia.exports,La=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/index"}}},[e._v("主页")]),t("el-breadcrumb-item",[e._v("审批流程")]),t("el-breadcrumb-item",[e._v("延期申请")])],1)],1),!1===e.checkHistoryVisible?t("el-card",[t("div",{staticClass:"btns"},[t("el-row",[t("el-col",{attrs:{span:4,offset:9}},[t("h1",[e._v("审核延期申请")])]),t("el-col",{attrs:{span:2,offset:9}},[t("el-button",{attrs:{type:"info",icon:"el-icon-s-order"},on:{click:function(t){return e.openHistory()}}},[e._v(" 历史记录 ")])],1)],1)],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.delayList}},[t("el-table-column",{attrs:{label:"类型"},scopedSlots:e._u([{key:"default",fn:function(a){return[null!==a.row.caseSubId?t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v("专案类")]):2===a.row.type?t("el-tag",{attrs:{effect:"dark"}},[e._v("技术研究")]):1===a.row.type?t("el-tag",{attrs:{effect:"dark",type:"warning"}},[e._v("临时事务")]):e._e()]}}],null,!1,3720325953)}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"delayType",label:"延期类型"}}),t("el-table-column",{attrs:{label:"延期原因",width:"250"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(a.row.applyReason))])]}}],null,!1,3580559954)}),t("el-table-column",{attrs:{prop:"applyDays",label:"申请天数"}}),t("el-table-column",{attrs:{prop:"formatPredictTime",label:"预计完成时间"}}),t("el-table-column",{attrs:{prop:"applyName",label:"申请人"}}),t("el-table-column",{attrs:{prop:"applyTime",label:"申请创建时间"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"success"},on:{click:function(t){return e.handleCheck(a.row,1)}}},[e._v("通过")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleCheck(a.row,2)}}},[e._v("拒绝")])]}}],null,!1,1566428842)})],1)],1):e._e(),e.checkHistoryVisible?t("el-card",[t("el-page-header",{attrs:{content:"延期审核历史记录"},on:{back:function(t){e.checkHistoryVisible=!1}}}),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.checkedApplyList}},[t("el-table-column",{attrs:{label:"结果"},scopedSlots:e._u([{key:"default",fn:function(a){return[1===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v("通过")]):2===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"danger"}},[e._v("拒绝")]):e._e()]}}],null,!1,1498281898)}),t("el-table-column",{attrs:{prop:"rejectReason",label:"拒绝原因"}}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"applyName",label:"申请人"}}),t("el-table-column",{attrs:{prop:"delayType",label:"延期类型"}}),t("el-table-column",{attrs:{prop:"applyReason",label:"申请原因"}}),t("el-table-column",{attrs:{prop:"applyDays",label:"申请天数"}}),t("el-table-column",{attrs:{prop:"predictTime",label:"预计完成时间"}}),t("el-table-column",{attrs:{prop:"createTime",label:"申请时间"}}),t("el-table-column",{attrs:{prop:"checkName",label:"审核人",width:"80"}}),t("el-table-column",{attrs:{prop:"checkTime",label:"审核时间"}})],1),t("el-pagination",{staticStyle:{"margin-top":"10px"},attrs:{"current-page":e.queryInfo.page,"page-sizes":[5,8,10,15],"page-size":e.queryInfo.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1):e._e()],1)},Fa=[],Oa=a(6724),ja={data(){return{checkHistoryVisible:!1,queryInfo:{page:1,pageSize:5},total:0,checkedApplyList:[]}},computed:{...(0,k.rn)("apply",["delayList"]),...(0,k.rn)(["user"])},created(){const e=+localStorage.getItem("pim_check_delay_pageSize");this.queryInfo.pageSize=0===e?5:e,this.getDelay()},methods:{...(0,k.nv)("apply",["getDelay"]),async handleCheck(e,t){e.status=t,e.checkUser=this.user.id,2===t?this.$prompt("请输入原因","您正在拒绝申请",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((async({value:t})=>{if(""===t||null===t)return this.$message.error("请输入拒绝原因"),0;e.rejectReason=t;const a=await kt(e);200===a.code?(this.$message.success("已拒绝审核"),this.getDelay()):this.$message.error(a.msg)})).catch((()=>{})):this.$prompt("请再次核查申请天数","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:e.applyDays,inputPattern:/[1-9]\d?/,inputErrorMessage:"申请天数至少包含一位数字,且第一位不能为0"}).then((async({value:t})=>{e.applyDays=+t;const a=await kt(e);200===a.code?(this.$message.success("已通过审核"),this.getDelay()):this.$message.error(a.msg)})).catch((()=>{this.$message({type:"info",message:"取消通过"})}))},openHistory(){this.checkHistoryVisible=!0,this.checkHistory()},async checkHistory(){const e=await St(this.queryInfo);this.total=e.data.total,this.checkedApplyList=e.data.records,this.checkedApplyList.forEach((e=>{e.predictTime=Lr(e.predictTime)}))},handleSizeChange(e){localStorage.setItem("pim_check_delay_pageSize",e),this.queryInfo.pageSize=e,this.queryInfo.page=1,this.checkHistory()},handleCurrentChange(e){this.queryInfo.page=e,this.checkHistory()}}},Aa=ja,za=(0,o.Z)(Aa,La,Fa,!1,null,"b6aa8a98",null),$a=za.exports,Ra=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/index"}}},[e._v("主页")]),t("el-breadcrumb-item",[e._v("审批流程")]),t("el-breadcrumb-item",[e._v("完结申请")])],1)],1),!1===e.checkHistoryVisible?t("el-card",[t("div",{staticClass:"btns"},[t("el-row",[t("el-col",{attrs:{span:4,offset:9}},[t("h1",[e._v("审核完结申请")])]),t("el-col",{attrs:{span:2,offset:9}},[t("el-button",{attrs:{type:"info",icon:"el-icon-s-order"},on:{click:function(t){return e.openHistory()}}},[e._v(" 历史记录 ")])],1)],1)],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.finishList},on:{"cell-dblclick":e.handleDoubleClick}},[t("el-table-column",{attrs:{label:"类型"},scopedSlots:e._u([{key:"default",fn:function(a){return[null!==a.row.caseSubId?t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v("专案类")]):2===a.row.type?t("el-tag",{attrs:{effect:"dark"}},[e._v("技术研究")]):1===a.row.type?t("el-tag",{attrs:{effect:"dark",type:"warning"}},[e._v("临时事务")]):e._e()]}}],null,!1,3720325953)}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"startTime",label:"开始时间"}}),t("el-table-column",{attrs:{prop:"applyTime",label:"申请完结时间"}}),t("el-table-column",{attrs:{prop:"estimateValue",label:"预计积分",width:"80"}}),t("el-table-column",{attrs:{prop:"planDays",label:"计划时间"}}),t("el-table-column",{attrs:{prop:"executionDays",label:"执行时间"}}),t("el-table-column",{attrs:{prop:"unforcedDays",label:"外界因素延期",width:"110"}}),t("el-table-column",{attrs:{prop:"applyName",label:"申请人"}}),t("el-table-column",{attrs:{prop:"createTime",label:"申请创建时间"}}),t("el-table-column",{attrs:{label:"备注",width:"90"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.caseSubId?t("el-button",{attrs:{type:"primary",icon:"el-icon-info",size:"mini",round:""},on:{click:function(t){return e.showCommit(a.row)}}},[e._v("备注")]):e._e()]}}],null,!1,2494430346)}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"success",size:"mini",round:""},on:{click:function(t){return e.handleCheck(a.row,1)}}},[e._v("通过")]),t("el-button",{attrs:{type:"primary",size:"mini",round:""},on:{click:function(t){return e.handleCheck(a.row,2)}}},[e._v("拒绝")])]}}],null,!1,1176426602)})],1)],1):e._e(),t("el-dialog",{attrs:{title:"确定积分比例",visible:e.editDirectorRate,width:"40%"},on:{"update:visible":function(t){e.editDirectorRate=t}}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.directorList}},[t("el-table-column",{attrs:{prop:"name",label:"姓名"}}),t("el-table-column",{attrs:{label:"比例"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-input",{attrs:{type:"number",placeholder:"例：33，单位%"},model:{value:a.row.value,callback:function(t){e.$set(a.row,"value",t)},expression:"scope.row.value"}})]}}])}),t("el-table-column",{attrs:{label:"工作描述"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-input",{attrs:{placeholder:"工作内容"},model:{value:a.row.description,callback:function(t){e.$set(a.row,"description",t)},expression:"scope.row.description"}})]}}])}),t("el-table-column",{attrs:{label:"获得积分"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-input",{attrs:{value:1*a.row.value/100*e.curObj.estimateValue,disabled:""}})]}}])})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editDirectorRate=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitDirectorRate()}}},[e._v("确 定")])],1)],1),e.checkHistoryVisible?t("el-card",[t("el-page-header",{attrs:{content:"完结审核历史记录"},on:{back:function(t){e.checkHistoryVisible=!1}}}),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.checkedApplyList}},[t("el-table-column",{attrs:{label:"结果"},scopedSlots:e._u([{key:"default",fn:function(a){return[1===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v("通过")]):2===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"danger"}},[e._v("拒绝")]):e._e()]}}],null,!1,1498281898)}),t("el-table-column",{attrs:{label:"类型"},scopedSlots:e._u([{key:"default",fn:function(a){return[null!==a.row.caseSubId?t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v("专案类")]):2===a.row.type?t("el-tag",{attrs:{effect:"dark"}},[e._v("技术研究")]):1===a.row.type?t("el-tag",{attrs:{effect:"dark",type:"warning"}},[e._v("临时事务")]):e._e()]}}],null,!1,3720325953)}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"rejectReason",label:"拒绝原因"}}),t("el-table-column",{attrs:{prop:"applyName",label:"申请人"}}),t("el-table-column",{attrs:{prop:"applyTime",label:"申请时间"}}),t("el-table-column",{attrs:{prop:"createTime",label:"申请创建时间"}}),t("el-table-column",{attrs:{prop:"checkName",label:"审核人"}}),t("el-table-column",{attrs:{prop:"checkTime",label:"审核时间"}})],1),t("el-pagination",{staticStyle:{"margin-top":"10px"},attrs:{"current-page":e.queryInfo.page,"page-sizes":[5,8,10,15],"page-size":e.queryInfo.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1):e._e(),t("el-dialog",{attrs:{title:"备注信息",visible:e.commitVisible,width:"40%"},on:{"update:visible":function(t){e.commitVisible=t}}},[t("el-form",{ref:"commitFormRef",attrs:{model:e.commitForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"专案"}},[t("el-input",{attrs:{disabled:""},model:{value:e.commitForm.caseName,callback:function(t){e.$set(e.commitForm,"caseName",t)},expression:"commitForm.caseName"}})],1),t("el-form-item",{attrs:{label:"阶段"}},[t("el-input",{attrs:{disabled:""},model:{value:e.commitForm.subName,callback:function(t){e.$set(e.commitForm,"subName",t)},expression:"commitForm.subName"}})],1),t("el-form-item",{attrs:{label:"备注信息"}},[t("el-card",{staticClass:"box-card"},[e._l(e.commitForm.content,(function(a){return t("div",{key:a,staticClass:"text item"},[e._v(" "+e._s(a)+" ")])})),0===e.commitForm.content.length?t("label",[e._v("暂无备注")]):e._e()],2)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.commitVisible=!1}}},[e._v("返 回")])],1)],1)],1)},Va=[];const qa=e=>ur.post("/caseSubFinishApply/applyFinish",e),Ua=e=>ur.get("/caseSubFinishApply/checkList"),Na=e=>ur.put("/caseSubFinishApply/judgeApply",e),Pa=e=>ur.get("/caseSubFinishApply/history",{params:e}),Ea=e=>ur.get(`/caseSubFinishApply/checkList/${e}`),Ma=e=>ur.delete(`/caseSubFinishApply/removeFinishApply/${e}`);var Ba={data(){return{tableData:[],editDirectorRate:!1,curObj:{},directorList:[],checkHistoryVisible:!1,queryInfo:{page:1,pageSize:5},total:0,checkedApplyList:[],commitVisible:!1,commitForm:{caseName:"",subName:"",content:[]}}},computed:{...(0,k.rn)(["user"]),...(0,k.rn)("apply",["finishList"])},created(){const e=+localStorage.getItem("pim_check_finish_pageSize");this.queryInfo.pageSize=0===e?5:e,this.getFinish()},methods:{...(0,k.nv)("apply",["getFinish"]),async handleCheck(e,t){if(e.status=t,e.checkUser=this.user.id,this.curObj={...e},1===t){if(null!==e.type)return void this.$confirm("您正在通过该任务的完结申请, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await Na(this.curObj);200===e.code?(this.$message.success(e.data),setTimeout((()=>this.getFinish()),500)):this.$message.error(e.msg)})).catch((()=>{this.$message({type:"info",message:"已取消操作"})}));const t=await ht(e.caseSubId);if(200!==t.code)return void this.$message.error(t.msg);if(this.directorList=t.data,1===this.directorList.length){this.directorList[0].value=100;const e=await ft(this.directorList);if(200!==e.code)return void this.$message.error(e.msg);this.$message.success(e.data),this.$confirm("您正在通过该阶段的完结申请, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await Na(this.curObj);200===e.code?(this.$message.success(e.data),setTimeout((()=>this.getFinish()),500)):this.$message.error(e.msg)})).catch((()=>{this.$message({type:"info",message:"已取消操作"})}))}else this.editDirectorRate=!0}else 2===t&&this.$prompt("请输入原因","您正在拒绝申请",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((async({value:a})=>{if(""===a||null===a)return void this.$message.error("请输入拒绝原因");e.status=t,e.checkUser=this.user.id,e.rejectReason=a;const s=await Na(e);200===s.code?(this.$message.success(s.data),setTimeout((()=>this.getFinish()),500)):this.$message.error(s.msg)})).catch((()=>{}))},async submitDirectorRate(){const e=await ft(this.directorList);200===e.code?(this.$message.success(e.data),this.editDirectorRate=!1,this.$confirm("您正在通过该阶段的完结申请, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await Na(this.curObj);200===e.code?(this.$message.success(e.data),setTimeout((()=>this.getFinish()),500)):this.$message.error(e.msg)})).catch((()=>{this.$message({type:"info",message:"已取消操作"})}))):this.$message.error(e.msg)},openHistory(){this.checkHistoryVisible=!0,this.checkHistory()},async checkHistory(){const e=await Pa(this.queryInfo);this.total=e.data.total,this.checkedApplyList=e.data.records},handleSizeChange(e){localStorage.setItem("pim_check_finish_pageSize",e),this.queryInfo.pageSize=e,this.queryInfo.page=1,this.checkHistory()},handleCurrentChange(e){this.queryInfo.page=e,this.checkHistory()},openCaseSubDetail(e){},async showCommit(e){this.commitVisible=!0;var t=e.description.split("->");this.commitForm.caseName=t[0],this.commitForm.subName=t[1];var a=await Ne(e.caseSubId);if(200==a.code){a=a.data,this.commitForm.content=[];for(var s=0;s<a.length;s++)this.commitForm.content.push(a[s].content)}else this.$message.error(a.msg)},async handleDoubleClick(e,t){if(e.caseSubId){var a=await kr(e.caseSubId);if(200!=a.code)return void this.$message.error(a.msg);a=a.data,this.$router.push({name:"子流程详情",query:{caseName:e.description.split("->")[0],caseId:a}})}}}},Ga=Ba,Ha=(0,o.Z)(Ga,Ra,Va,!1,null,"bdad585c",null),Za=Ha.exports,Ya=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/index"}}},[e._v("主页")]),t("el-breadcrumb-item",[e._v("审批流程")]),t("el-breadcrumb-item",[e._v("技术研究申请")])],1)],1),!1===e.checkTaskHistoryVisible?t("el-card",[t("div",{staticClass:"btns"},[t("el-row",[t("el-col",{attrs:{span:4,offset:9}},[t("h1",[e._v("审核任务申请")])]),t("el-col",{attrs:{span:2,offset:9}},[t("el-button",{attrs:{type:"info",icon:"el-icon-s-order"},on:{click:function(t){return e.openHistory()}}},[e._v(" 历史记录 ")])],1)],1)],1),t("el-table",{attrs:{data:e.taskList}},[t("el-table-column",{attrs:{label:"类别"},scopedSlots:e._u([{key:"default",fn:function(a){return[1===a.row.type?t("el-tag",{attrs:{effect:"dark",type:"warning"}},[e._v("临时事务")]):2===a.row.type?t("el-tag",{attrs:{effect:"dark",type:"primary"}},[e._v("技术研究")]):e._e()]}}],null,!1,3501709187)}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"planDays",label:"计划天数"}}),t("el-table-column",{attrs:{prop:"predictTime",label:"预计完成时间"}}),t("el-table-column",{attrs:{prop:"applyName",label:"申请人"}}),t("el-table-column",{attrs:{prop:"createTime",label:"申请时间"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"success"},on:{click:function(t){return e.judgeApply(a.row,1)}}},[e._v("通 过")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.judgeApply(a.row,2)}}},[e._v("拒 绝")])]}}],null,!1,723186890)})],1)],1):e.checkTaskHistoryVisible?t("el-card",[t("el-page-header",{attrs:{content:"任务申请审核历史记录"},on:{back:function(t){e.checkTaskHistoryVisible=!1}}}),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.applyHistoryList}},[t("el-table-column",{attrs:{label:"结果"},scopedSlots:e._u([{key:"default",fn:function(a){return[1===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v("通过")]):2===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"danger"}},[e._v("拒绝")]):e._e()]}}])}),t("el-table-column",{attrs:{prop:"comment",label:"拒绝原因"}}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"planDays",label:"计划时间"}}),t("el-table-column",{attrs:{prop:"predictTime",label:"预计完成时间"}}),t("el-table-column",{attrs:{prop:"applyName",label:"申请人"}}),t("el-table-column",{attrs:{prop:"createTime",label:"申请时间"}}),t("el-table-column",{attrs:{prop:"checkName",label:"审核人"}}),t("el-table-column",{attrs:{prop:"checkTime",label:"审核时间"}})],1),t("el-pagination",{staticStyle:{"margin-top":"10px"},attrs:{"current-page":e.queryInfo.page,"page-sizes":[5,8,10,15],"page-size":e.queryInfo.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1):e._e()],1)},Wa=[];const Xa=e=>ur.post("/applyTask/saveApplyTask",e),Qa=()=>ur.get("/applyTask/applyList"),Ja=e=>ur.put("/applyTask/judgeApply",e),Ka=e=>ur.get("/applyTask/applyHistoryList",{params:e}),es=e=>ur.get("/applyTask/checkingApply/"+e),ts=e=>ur.delete(`/applyTask/removeTaskApply/${e}`);var as={data(){return{applyList:[],checkTaskHistoryVisible:!1,queryInfo:{page:1,pageSize:7},total:0,applyHistoryList:[]}},created(){var e=+localStorage.getItem("pim_check_apply_task_pageSize");this.queryInfo.pageSize=0==e?7:e,this.getTaskList()},computed:{...(0,k.rn)(["user"]),...(0,k.rn)("apply",["taskList"])},methods:{...(0,k.nv)("apply",["getTaskList"]),judgeApply(e,t){e.status=t,e.checkUser=this.user.id,1===t?this.$confirm("确定同意该科员的任务申请?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await Ja(e);200===t.code?(this.$message.success(t.data),this.getApplyList()):this.$message.error(t.msg)})).catch((()=>{this.$message({type:"info",message:"取消操作"})})):2===t&&this.$prompt("请输入拒绝理由","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((async({value:t})=>{e.comment=t;const a=await Ja(e);200===a.code?(this.$message.success(a.data),this.getApplyList()):this.$message.error(a.msg)})).catch((()=>{this.$message({type:"info",message:"取消操作"})}))},openHistory(){this.checkTaskHistoryVisible=!0,this.getApplyHistoryList()},async getApplyHistoryList(){const e=await Ka(this.queryInfo);200===e.code?(this.applyHistoryList=e.data.records,this.total=e.data.total,this.applyHistoryList.forEach((e=>e.predictTime=Or(e.createTime,e.planDays)))):this.$message.error(e.msg)},handleSizeChange(e){localStorage.setItem("pim_check_apply_task_pageSize",e),this.queryInfo.pageSize=e,this.queryInfo.page=1,this.getApplyHistoryList()},handleCurrentChange(e){this.queryInfo.page=e,this.getApplyHistoryList()}}},ss=as,is=(0,o.Z)(ss,Ya,Wa,!1,null,"5d86c81a",null),rs=is.exports,ls=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/index"}}},[e._v("主页")]),t("el-breadcrumb-item",[e._v("审批流程")]),t("el-breadcrumb-item",[e._v("专案类申请")])],1)],1),!1===e.checkCaseSubHistoryVisible?t("el-card",[t("div",{staticClass:"btns"},[t("el-row",[t("el-col",{attrs:{span:5,offset:9}},[t("h1",[e._v("审核专案类申请")])]),t("el-col",{attrs:{span:2,offset:8}},[t("el-button",{attrs:{type:"info",icon:"el-icon-s-order"},on:{click:function(t){return e.openHistory()}}},[e._v(" 历史记录 ")])],1)],1)],1),t("el-table",{attrs:{data:e.caseSubList}},[t("el-table-column",{attrs:{prop:"caseName",label:"专案"}}),t("el-table-column",{attrs:{prop:"subName",label:"子流程"}}),t("el-table-column",{attrs:{prop:"description",label:"工作描述"}}),t("el-table-column",{attrs:{prop:"applyName",label:"申请人"}}),t("el-table-column",{attrs:{prop:"createTime",label:"申请时间"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"success"},on:{click:function(t){return e.judgeApply(a.row,1)}}},[e._v("通过")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.judgeApply(a.row,2)}}},[e._v("拒绝")])]}}],null,!1,1040409226)})],1)],1):e.checkCaseSubHistoryVisible?t("el-card",[t("el-page-header",{attrs:{content:"专案类审核历史记录"},on:{back:function(t){e.checkCaseSubHistoryVisible=!1}}}),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.applyHistoryList}},[t("el-table-column",{attrs:{prop:"caseName",label:"专案"}}),t("el-table-column",{attrs:{prop:"subName",label:"阶段"}}),t("el-table-column",{attrs:{prop:"applyName",label:"申请人"}}),t("el-table-column",{attrs:{prop:"createTime",label:"申请时间"}}),t("el-table-column",{attrs:{prop:"checkName",label:"审核人"}}),t("el-table-column",{attrs:{prop:"checkTime",label:"审核时间"}}),t("el-table-column",{attrs:{prop:"rejectReason",label:"拒绝原因"}}),t("el-table-column",{attrs:{label:"结果"},scopedSlots:e._u([{key:"default",fn:function(a){return[1===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v("通过")]):2===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"danger"}},[e._v("拒绝")]):e._e()]}}])})],1),t("el-pagination",{staticStyle:{"margin-top":"10px"},attrs:{"current-page":e.queryInfo.page,"page-sizes":[5,8,10,15],"page-size":e.queryInfo.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1):e._e()],1)},ns=[];const os=e=>ur.post("/applyCaseSub/saveApplyCaseSub",e),cs=()=>ur.get("/applyCaseSub/applyList"),us=e=>ur.put("/applyCaseSub/judgeApply",e),ps=e=>ur.get("/applyCaseSub/applyHistoryList",{params:e}),ds=e=>ur.get(`/applyCaseSub/checkingApply/${e}`),hs=e=>ur.delete(`/applyCaseSub/removeCaseSubApply/${e}`);var ms={data(){return{applyList:[],checkCaseSubHistoryVisible:!1,applyHistoryList:[],queryInfo:{page:1,pageSize:7},total:0}},created(){var e=+localStorage.getItem("pim_check_apply_caseSub_pageSize");this.queryInfo.pageSize=0==e?7:e,this.getCaseSubApplyList()},computed:{...(0,k.rn)(["user"]),...(0,k.rn)("apply",["caseSubList"])},methods:{...(0,k.nv)("apply",["getCaseSubApplyList"]),judgeApply(e,t){e.status=t,e.checkUser=this.user.id,1===t?this.$confirm("此操作将添加科员到该阶段, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await us(e);200===t.code?(this.$message.success(t.data),this.getCaseSubApplyList()):this.$message.error(t.msg)})).catch((()=>{this.$message({type:"info",message:"取消操作"})})):2===t&&this.$prompt("请输入拒绝理由","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((async({value:t})=>{e.rejectReason=t;const a=await us(e);200===a.code?(this.$message.success(a.data),this.getCaseSubApplyList()):this.$message.error(a.msg)})).catch((e=>{this.$message({type:"info",message:"取消操作"})}))},openHistory(){this.checkCaseSubHistoryVisible=!0,this.getApplyHistoryList()},async getApplyHistoryList(){const e=await ps(this.queryInfo);200===e.code?(this.applyHistoryList=e.data.records,this.total=e.data.total):this.$message.error(e.msg)},handleSizeChange(e){localStorage.setItem("pim_check_apply_caseSub_pageSize",e),this.queryInfo.pageSize=e,this.queryInfo.page=1,this.getApplyHistoryList()},handleCurrentChange(e){this.queryInfo.page=e,this.getApplyHistoryList()}}},bs=ms,fs=(0,o.Z)(bs,ls,ns,!1,null,"55749bc4",null),ys=fs.exports,gs=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/index"}}},[e._v("主页")]),t("el-breadcrumb-item",[e._v("数据统计")]),t("el-breadcrumb-item",[e._v("专案数据分析")])],1)],1),t("el-card",[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:2}},[t("el-select",{attrs:{placeholder:e.defaultYear[0]+""},model:{value:e.year,callback:function(t){e.year=t},expression:"year"}},e._l(e.defaultYear,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("el-col",{attrs:{span:2}},[t("el-select",{attrs:{placeholder:"请选择要查询的月份"},model:{value:e.month,callback:function(t){e.month=t},expression:"month"}},e._l([1,2,3,4,5,6,7,8,9,10,11,12],(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary",round:""},on:{click:e.getFinishSubList}},[e._v("查询")])],1),t("el-col",{attrs:{span:4,offset:14}},[e.showSubList.length!==e.finishSubList.length?t("el-button",{attrs:{type:"warning",round:""},on:{click:function(t){e.showSubList=e.finishSubList}}},[e._v("显示所有")]):t("el-button",{attrs:{type:"warning",round:""},on:{click:function(t){return e.showPart()}}},[e._v("部分显示")]),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"设定达成率上界",placement:"top"}},[t("el-button",{attrs:{icon:"el-icon-top",type:"success",round:""},on:{click:e.changeTopRate}})],1),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"不良阈值下限",placement:"top"}},[t("el-button",{attrs:{icon:"el-icon-bottom",type:"danger",round:""},on:{click:e.changeBottomRate}})],1)],1)],1),t("br"),t("div",[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:6}},[t("el-statistic",{attrs:{value:e.statisticsObj.planFinishCount,title:"本月计划完成"}})],1),t("el-col",{attrs:{span:6}},[t("el-statistic",{attrs:{value:e.statisticsObj.finishCount,title:"本月实际完成"}})],1),t("el-col",{attrs:{span:6}},[t("el-statistic",{attrs:{value:e.statisticsObj.highAchievingCount,title:`达成率高于${e.showTopRate}`}})],1),t("el-col",{attrs:{span:6}},[t("el-statistic",{attrs:{precision:2,suffix:"%",value:e.statisticsObj.highAchievingRate,title:"优达率"}})],1)],1)],1),t("br"),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.showSubList,"cell-style":e.setCellColor}},[t("el-table-column",{attrs:{prop:"caseName",label:"专案"}}),t("el-table-column",{attrs:{prop:"subName",label:"阶段"}}),t("el-table-column",{attrs:{prop:"startTime",label:"开始时间"}}),t("el-table-column",{attrs:{prop:"finishTime",label:"结束时间"}}),t("el-table-column",{attrs:{prop:"planDays",label:"计划天数"}}),t("el-table-column",{attrs:{prop:"executionDays",label:"执行天数"}}),t("el-table-column",{attrs:{label:"达成率"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.achievingRate.toFixed(2))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"primary",icon:"el-icon-info",size:"mini"},on:{click:function(t){return e.openComment(a.row)}}})]}}])})],1)],1),t("el-dialog",{attrs:{title:"备注信息",visible:e.commentVisible,width:"40%"},on:{"update:visible":function(t){e.commentVisible=t}}},[t("el-form",{ref:"commitFormRef",attrs:{"label-width":"100px"}},[t("el-form-item",{attrs:{label:"专案"}},[t("el-input",{attrs:{disabled:""},model:{value:e.commentObj.caseName,callback:function(t){e.$set(e.commentObj,"caseName",t)},expression:"commentObj.caseName"}})],1),t("el-form-item",{attrs:{label:"阶段"}},[t("el-input",{attrs:{disabled:""},model:{value:e.commentObj.subName,callback:function(t){e.$set(e.commentObj,"subName",t)},expression:"commentObj.subName"}})],1),t("el-form-item",{attrs:{label:"备注信息"}},[t("el-card",{staticClass:"box-card"},[e._l(e.commentObj.comments,(function(a){return t("div",{key:a,staticClass:"text item"},[e._v(" "+e._s(a)+" ")])})),0===e.commentObj.comments.length?t("label",[e._v("暂无备注")]):e._e()],2)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.commentVisible=!1}}},[e._v("确 定")])],1)],1)],1)},vs=[],ws={data(){return{finishSubList:[],showSubList:[],defaultYear:this.initYear(),year:"",month:this.getDefaultMonth(),title:"达成率",value:123.78,commentObj:{comments:[]},commentVisible:!1,showTopRate:.7,showBottomRate:.4,statisticsObj:{planFinishCount:0,finishCount:0,highAchievingCount:0,highAchievingRate:0}}},created(){const e=+localStorage.getItem("pim_statistic_topRate");0!==e&&(this.showTopRate=e);const t=+localStorage.getItem("pim_statistic_bottomRate");0!==t&&(this.showBottomRate=t),this.getFinishSubList()},methods:{async getFinishSubList(){""===this.year&&(this.year=this.defaultYear[0]);var e=await wr({year:this.year,month:this.month});200===e.code?this.statisticsObj.planFinishCount=e.data:this.$message.error(e.msg),e=await vr({year:this.year,month:this.month}),200===e.code?(this.finishSubList=e.data,this.showSubList=[],this.finishSubList.forEach((e=>{e.executionDays=jr(e.startTime,e.finishTime),e.executionDays-=+e.unforcedDays,e.achievingRate<this.showTopRate&&this.showSubList.push(e)})),this.statisticsObj.finishCount=this.finishSubList.length,this.statisticsObj.highAchievingCount=this.statisticsObj.finishCount-this.showSubList.length,this.statisticsObj.highAchievingRate=100*this.statisticsObj.highAchievingCount/this.statisticsObj.finishCount):this.$message.error(e.msg)},getDefaultMonth(){const e=new Date;return e.getMonth()+1},initYear(){var e=[];const t=new Date;var a=t.getFullYear();while(a>=2018)e.push(+a),a--;return e},setCellColor({row:e,column:t,rowIndex:a,columnIndex:s}){return e.achievingRate>=this.showTopRate?"background-color:#ABEFBA":e.achievingRate>=this.showBottomRate?"background-color:#EFEAAB":"background-color:#F1B9CB"},async openComment(e){this.commentVisible=!0,this.commentObj.caseName=e.caseName,this.commentObj.subName=e.subName;var t=await Ne(e.id);this.commentObj.comments=[],200===t.code&&t.data.forEach((e=>this.commentObj.comments.push(e.content)))},showPart(){this.showSubList=[],this.finishSubList.forEach((e=>{e.achievingRate<this.showTopRate&&this.showSubList.push(e)})),this.statisticsObj.highAchievingCount=this.statisticsObj.finishCount-this.showSubList.length,this.statisticsObj.highAchievingRate=100*this.statisticsObj.highAchievingCount/this.statisticsObj.finishCount},changeTopRate(){this.$prompt("请输入达成率上界，低于此达成率的阶段才显示","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:this.showTopRate,inputPattern:/^0.\d+/,inputErrorMessage:"达成率必须是0-1之间的小数"}).then((({value:e})=>{localStorage.setItem("pim_statistic_topRate",e),this.showTopRate=e,this.$message({type:"success",message:"当前达成率上界是: "+e}),this.showPart()})).catch((()=>{this.$message({type:"info",message:"取消输入"})}))},changeBottomRate(){this.$prompt("请输入不良阈值下限，低于此达成率的阶段会标红显示","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:this.showBottomRate,inputPattern:/^0.\d+/,inputErrorMessage:"达成率必须是0-1之间的小数"}).then((({value:e})=>{localStorage.setItem("pim_statistic_bottomRate",e),this.showBottomRate=e,this.$message({type:"success",message:"当前不良阈值下限是: "+e}),this.showPart()})).catch((()=>{this.$message({type:"info",message:"取消输入"})}))}}},ks=ws,Ts=(0,o.Z)(ks,gs,vs,!1,null,"344bc3e2",null),Ss=Ts.exports,xs=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",[e._v("数据统计")]),t("el-breadcrumb-item",[e._v("专案分析")])],1)],1),t("el-card",[t("div",{staticStyle:{width:"100%",height:"700px"},attrs:{id:"ganttChart"}}),t("el-row",{staticStyle:{"margin-bottom":"10px"}},[t("el-col",{attrs:{span:1}},[t("el-button",{attrs:{icon:"el-icon-back",round:"",type:"primary"},on:{click:function(t){return e.nextPage(-1)}}})],1),t("el-col",{attrs:{span:1}},[t("el-button",{attrs:{icon:"el-icon-right",round:"",type:"primary"},on:{click:function(t){return e.nextPage(1)}}})],1)],1),t("el-row",[t("el-col",{attrs:{span:1,offset:23}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.showCaseSubGantt,expression:"showCaseSubGantt"}],attrs:{type:"danger",icon:"el-icon-circle-close"},on:{click:function(t){e.showCaseSubGantt=!1}}})],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showCaseSubGantt,expression:"showCaseSubGantt"}],staticStyle:{width:"100%",height:"1000px"},attrs:{id:"caseSubGanttChart"}}),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showCaseSubGantt,expression:"showCaseSubGantt"}],staticStyle:{width:"100%",height:"700px"},attrs:{id:"caseSubBarChart"}})],1)],1)},Cs=[],Ds={name:"caseAnalysis",data(){return{finishCaseList:[],page:1,pageSize:5,totalPage:null,subInfo:[],caseId:null,map:new Map,showCaseSubGantt:!1,caseList:[]}},async created(){await this.getFinishedCaseList(!0);for(let e=0;e<this.caseList.length;e++)this.map.set(this.caseList[e].name,this.caseList[e]);this.finishCaseList=this.caseList.slice((this.page-1)*this.pageSize,this.page*this.pageSize),this.totalPage=Math.ceil(this.caseList.length/this.pageSize),this.gantt=this.$echarts.init(document.getElementById("ganttChart")),this.initGantt()},methods:{async getFinishedCaseList(){var e=await Ie(!0);e=e.data;for(let a=0;a<e.length;a++){if(null===e[a].startTime)continue;const s=new Date(e[a]["startTime"]);e[a].startTime=Lr(s),null!==e[a].finishTime&&(e[a].finishTime=Lr(new Date(e[a]["finishTime"])));var t=new Date(s);t.setDate(t.getDate()+e[a].planDay-1),e[a].presetTime=Lr(t),null===e[a].curStage&&(e[a].curStage="已结案")}e.sort(((e,t)=>new Date(t.finishTime)-new Date(e.finishTime))),this.caseList=e},async getSubInfo(e){var t=await pr(e);this.subInfo=t.data;for(let a=0;a<this.subInfo.length;a++)this.subInfo[a].startTime=Lr(this.subInfo[a].startTime),null!==this.subInfo[a].startTime&&(this.subInfo[a].targetTime=Or(this.subInfo[a].startTime,this.subInfo[a].planDays),this.subInfo[a].standardTime=Or(this.subInfo[a].startTime,this.subInfo[a].planDays,this.subInfo[a].unforcedDays)),0===a?this.subInfo[a].ideaTime=this.subInfo[a].targetTime:"undefined"!==typeof this.subInfo[a-1].ideaTime&&(this.subInfo[a].ideaTime=Or(this.subInfo[a-1].ideaTime,this.subInfo[a].planDays)),this.subInfo[a].finishTime=Lr(this.subInfo[a].finishTime)},initGanttObj(e,t,a,s,i,r,l){return e.name=r,e.stack=t,e.type="bar",e.label={show:!0,color:"#000",position:"right",fontSize:16,formatter:function(e){var t=new Date(e.value);return l?4===i||1===i||2===i?(""+t.getFullYear()).substring(2,4)+"-"+(t.getMonth()+1)+"-"+t.getDate():"":1===i||2===i?t.getMonth()+1+"-"+t.getDate():""}},e.zlevel=i,e.itemStyle=a?{color:"#fff"}:{color:s,borderColor:"#fff",borderWidth:2},e.data=[],e},initGantt(){let e=[];var t=[],a={},s={};a=this.initGanttObj(a,"bar0",!0,"#fff",4,"开始时间",!0),s=this.initGanttObj(s,"bar1",!0,"#fff",4,"开始时间",!0);var i={};i=this.initGanttObj(i,"bar0",!1,"#6ED77E",3,"预计完成",!0);var r={};r=this.initGanttObj(r,"bar0",!1,"skyblue",2,"目标时间",!0);var l={};l=this.initGanttObj(l,"bar1",!1,"#FF7F50",1,"完成时间",!0);for(let o=this.finishCaseList.length-1;o>=0;o--)a.data.push(new Date(this.finishCaseList[o].startTime)),s.data.push(new Date(this.finishCaseList[o].startTime)),i.data.push(new Date(this.finishCaseList[o].presetTime)),r.data.push(new Date(Or(this.finishCaseList[o].presetTime,null===this.finishCaseList[o].unforcedDay?0:this.finishCaseList[o].unforcedDay,1))),l.data.push(new Date(this.finishCaseList[o].finishTime)),e.push(this.finishCaseList[o].name);t.push(a),t.push(s),t.push(i),t.push(r),t.push(l);var n={backgrindColor:"#fff",title:{text:"专案完结甘特图",padding:20,textStyle:{fontSize:17,fontWeight:"bolder",color:"#333"},subtextStyle:{fontSize:13,fontWeight:"bolder"}},legend:{data:["开始时间","预计完成","目标时间","完成时间"],align:"right",right:80,top:50},grid:{containLabel:!0,show:!1,right:130,left:40,bottom:40,top:90},xAxis:{type:"time",axisLabel:{show:!0,interval:0,formatter:function(e){var t=new Date(e),a=t.getFullYear(),s=t.getMonth()+1,i=t.getDate();return i>1?"{fontSizeMini|"+i+"}":s>1?"{fontSize|"+s+"月}":"{fontSizeLarge|"+a+"年}"},rich:{fontSizeMini:{fontSize:20},fontSize:{fontSize:25},fontSizeLarge:{fontSize:30}}}},yAxis:{axisLabel:{show:!0,interval:0,fontSize:15,fontWeight:"bolder"},data:e},tooltip:{trigger:"axis",formatter:function(e){var t="";t+=e[0].axisValue+"<br/>";for(var a=new Set,s=0;s<e.length;s++)a.has(e[s].seriesName)||(a.add(e[s].seriesName),t+='<div style="display:inline-block;margin-right:5px;border-radius:50%;width:10px;height:10px;background-color:'+e[s].color+';"></div>'+e[s].seriesName+"："+Lr(e[s].value)+"<br/>");return t}},series:t};this.gantt.setOption(n),this.gantt.on("click",(async e=>{var t=this.map.get(e.name);this.caseId=t.id,await this.getSubInfo(this.caseId),this.showCaseSubGantt=!0,setTimeout((()=>{this.caseSubGantt=this.$echarts.init(document.getElementById("caseSubGanttChart")),this.caseSubBar=this.$echarts.init(document.getElementById("caseSubBarChart")),this.initCaseSubGantt(e.name,t),this.initCaseSubBar(e.name,t)}),100)}))},updateGantt(){let e=[];var t=[],a={},s={};a=this.initGanttObj(a,"bar0",!0,"#fff",4,"开始时间",!0),s=this.initGanttObj(s,"bar1",!0,"#fff",4,"开始时间",!0);var i={};i=this.initGanttObj(i,"bar0",!1,"#6ED77E",3,"预计完成",!0);var r={};r=this.initGanttObj(r,"bar0",!1,"skyblue",2,"目标时间",!0);var l={};l=this.initGanttObj(l,"bar1",!1,"#FF7F50",1,"完成时间",!0);for(let o=this.finishCaseList.length-1;o>=0;o--)a.data.push(new Date(this.finishCaseList[o].startTime)),s.data.push(new Date(this.finishCaseList[o].startTime)),i.data.push(new Date(this.finishCaseList[o].presetTime)),r.data.push(new Date(Or(this.finishCaseList[o].presetTime,null===this.finishCaseList[o].unforcedDay?0:this.finishCaseList[o].unforcedDay,1))),l.data.push(new Date(this.finishCaseList[o].finishTime)),e.push(this.finishCaseList[o].name);t.push(a),t.push(s),t.push(i),t.push(r),t.push(l);var n={yAxis:{axisLabel:{show:!0,interval:0,fontSize:15,fontWeight:"bolder"},data:e},series:t};this.gantt.setOption(n)},nextPage(e){return this.page+=e,this.page<=0?(this.$message.warning("当前已是第一页"),void(this.page=1)):this.page>this.totalPage?(this.$message.warning("当前已是最后一页"),void(this.page=this.totalPage)):(this.$message.warning(`当前第${this.page}页,共${this.totalPage}页`),this.finishCaseList=this.caseList.slice((this.page-1)*this.pageSize,this.page*this.pageSize),void this.updateGantt())},initCaseSubGantt(e,t){let a=[];var s=[],i={},r={};i=this.initGanttObj(i,"bar0",!0,"#fff",4,"开始时间",!1),r=this.initGanttObj(r,"bar1",!0,"#fff",4,"开始时间",!1);var l={};l=this.initGanttObj(l,"bar0",!1,"#6ED77E",3,"预计完成",!1);var n={};n=this.initGanttObj(n,"bar0",!1,"skyblue",2,"目标时间",!1);var o={};o=this.initGanttObj(o,"bar1",!1,"#FF7F50",1,"完成时间",!1);for(let u=this.subInfo.length-1;u>=0;u--)i.data.push(new Date(this.subInfo[u].startTime)),r.data.push(new Date(this.subInfo[u].startTime)),l.data.push(new Date(this.subInfo[u].targetTime)),n.data.push(new Date(this.subInfo[u].standardTime)),o.data.push(new Date(this.subInfo[u].finishTime)),a.push(this.subInfo[u].subName);a.push("计划工期"),i.data.push(new Date(this.subInfo[0].startTime)),r.data.push(new Date(this.subInfo[0].startTime)),l.data.push(new Date(t.presetTime)),n.data.push(new Date(Or(t.presetTime,null===t.unforcedDay?0:t.unforcedDay,1))),o.data.push(new Date(Or(t.startTime,null===t.unforcedDay?0:t.unforcedDay,1,t.executionDays))),s.push(i),s.push(r),s.push(l),s.push(n),s.push(o);var c={backgrindColor:"#fff",title:{text:e,padding:20,textStyle:{fontSize:24,fontWeight:"bolder",color:"#333"},subtextStyle:{fontSize:13,fontWeight:"bolder"}},legend:{data:["开始时间","预计完成","目标时间","完成时间"],align:"right",right:80,top:50},grid:{containLabel:!0,show:!1,right:130,left:40,bottom:40,top:90},xAxis:{type:"time",axisLabel:{show:!0,interval:0,formatter:function(e){var t=new Date(e),a=t.getFullYear(),s=t.getMonth()+1,i=t.getDate();return i>1?"{fontSizeMini|"+i+"}":s>1?"{fontSize|"+s+"月}":"{fontSizeLarge|"+a+"年}"},rich:{fontSizeMini:{fontSize:20},fontSize:{fontSize:25},fontSizeLarge:{fontSize:30}}}},yAxis:{axisLabel:{show:!0,interval:0,fontSize:15,fontWeight:"bolder"},data:a},tooltip:{trigger:"axis",formatter:function(e){var t="";t+=e[0].axisValue+"<br/>";for(var a=new Set,s=0;s<e.length;s++)a.has(e[s].seriesName)||(a.add(e[s].seriesName),t+='<div style="display:inline-block;margin-right:5px;border-radius:50%;width:10px;height:10px;background-color:'+e[s].color+';"></div>'+e[s].seriesName+"："+Lr(e[s].value)+"<br/>");return e[e.length-1].value>e[e.length-2].value?t+="延期"+(jr(e[e.length-2].value,e[e.length-1].value)-1)+"天":t+="提前"+(jr(e[e.length-1].value,e[e.length-2].value)-1)+"天",t}},series:s};this.caseSubGantt.setOption(c)},initCaseSubBar(e,t){this.subInfo.forEach((e=>{e.executionDays=jr(e.startTime,e.finishTime),e.executionDays-=+e.unforcedDays}));var a={backgrindColor:"#fff",title:{text:e+"  执行条形图",padding:20,textStyle:{fontSize:17,fontWeight:"bolder",color:"#333"},subtextStyle:{fontSize:13,fontWeight:"bolder"}},legend:{data:["计划时间","执行时间"],align:"right",right:80,top:50},grid:{containLabel:!0,show:!1,right:130,left:40,bottom:40,top:90},xAxis:{axisLabel:{show:!0,interval:0,fontSize:20,fontWeight:"bolder"},data:this.subInfo.map((e=>e.subName))},yAxis:{axisLabel:{show:!0,interval:0,fontSize:15,fontWeight:"bolder"}},tooltip:{trigger:"axis"},series:[{name:"计划时间",type:"bar",data:this.subInfo.map((e=>e.planDays)),label:{show:!0,position:"top"}},{name:"执行时间",type:"bar",data:this.subInfo.map((e=>e.executionDays)),label:{show:!0,position:"top"}}]};this.caseSubBar.setOption(a)}}},Is=Ds,_s=(0,o.Z)(Is,xs,Cs,!1,null,"0c317771",null),Ls=_s.exports,Fs=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/index"}}},[e._v("主页")]),t("el-breadcrumb-item",[e._v("部员管理")]),t("el-breadcrumb-item",[e._v("部员信息管理")])],1)],1),t("el-card",[t("div",{staticClass:"query-area"},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{placeholder:"请输入姓名查询"},on:{change:function(t){return e.searchUser()}},model:{value:e.queryInfo.query,callback:function(t){e.$set(e.queryInfo,"query",t)},expression:"queryInfo.query"}})],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.searchUser()}}},[e._v("查询")])],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){e.addFormVisible=!0}}},[e._v("添加用户")])],1),t("el-col",{attrs:{span:1,offset:15}},[t("el-dropdown",{on:{command:e.handleCommand}},[t("el-button",{attrs:{round:""}},[t("i",{staticClass:"el-icon-setting el-icon-arrow-down"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"editUser"}},[e._v("修改资料")]),t("el-dropdown-item",{attrs:{command:"password"}},[e._v("修改密码")])],1)],1)],1)],1)],1),t("el-table",{attrs:{data:e.userList,border:""}},[t("el-table-column",{attrs:{type:"index"}}),t("el-table-column",{attrs:{prop:"name",label:"姓名"}}),t("el-table-column",{attrs:{prop:"number",label:"工号"}}),t("el-table-column",{attrs:{prop:"status",label:"权限"},scopedSlots:e._u([{key:"default",fn:function(a){return[1===a.row.type?t("el-tag",[e._v("管理员")]):t("el-tag",{attrs:{type:"success"}},[e._v("用户")])]}}])}),t("el-table-column",{attrs:{label:"职务"},scopedSlots:e._u([{key:"default",fn:function(a){return[0===a.row.status?t("el-tag",{attrs:{effect:"dark"}},[e._v("机构")]):1===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v("电控")]):2===a.row.status?t("el-tag",{attrs:{effect:"dark",type:"warning"}},[e._v("IE")]):e._e()]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{icon:"el-icon-edit",type:"primary",round:"",size:"mini"},on:{click:function(t){return e.openEditUser(a.row.id)}}}),t("el-button",{attrs:{icon:"el-icon-delete",type:"danger",round:"",size:"mini"},on:{click:function(t){return e.removeUser(a.row.id)}}})]}}])})],1),t("el-pagination",{attrs:{"current-page":e.queryInfo.page,"page-sizes":[5,7,10,20],"page-size":e.queryInfo.pageSize,layout:"total, sizes, prev, pager, next",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("el-dialog",{attrs:{title:"添加用户",visible:e.addFormVisible,width:"30%"},on:{"update:visible":function(t){e.addFormVisible=t},close:function(t){return e.$refs.addFormRef.resetFields()}}},[t("el-form",{ref:"addFormRef",attrs:{model:e.addForm,"label-width":"80px",rules:e.addFormRules}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"姓名",prop:"name"}},[t("el-input",{model:{value:e.addForm.name,callback:function(t){e.$set(e.addForm,"name",t)},expression:"addForm.name"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"工号",prop:"number"}},[t("el-input",{model:{value:e.addForm.number,callback:function(t){e.$set(e.addForm,"number",e._n(t))},expression:"addForm.number"}})],1)],1)],1),t("el-form-item",{attrs:{label:"职务",prop:"status"}},[t("el-select",{attrs:{placeholder:"请选择职务"},model:{value:e.addForm.status,callback:function(t){e.$set(e.addForm,"status",t)},expression:"addForm.status"}},e._l(e.statusOps,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addFormVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addUser()}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"修改用户",visible:e.editFormVisible,width:"30%"},on:{"update:visible":function(t){e.editFormVisible=t},close:function(t){return e.$refs.editFormRef.resetFields()}}},[t("el-form",{ref:"editFormRef",attrs:{model:e.editForm,"label-width":"80px",rules:e.addFormRules}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"姓名",prop:"name"}},[t("el-input",{model:{value:e.editForm.name,callback:function(t){e.$set(e.editForm,"name",t)},expression:"editForm.name"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"工号",prop:"number"}},[t("el-input",{model:{value:e.editForm.number,callback:function(t){e.$set(e.editForm,"number",e._n(t))},expression:"editForm.number"}})],1)],1)],1),t("el-form-item",{attrs:{label:"职务",prop:"status"}},[t("el-select",{attrs:{placeholder:"请选择职务"},model:{value:e.editForm.status,callback:function(t){e.$set(e.editForm,"status",t)},expression:"editForm.status"}},e._l(e.statusOps,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editFormVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.editUser()}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"修改资料",visible:e.editUserVisible,width:"30%"},on:{"update:visible":function(t){e.editUserVisible=t}}},[t("el-form",{ref:"editUserRef",attrs:{rules:e.editUserRule,model:e.editingUser,"label-width":"80px"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"姓名",prop:"name"}},[t("el-input",{model:{value:e.editingUser.name,callback:function(t){e.$set(e.editingUser,"name",t)},expression:"editingUser.name"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"工号",prop:"number"}},[t("el-input",{model:{value:e.editingUser.number,callback:function(t){e.$set(e.editingUser,"number",t)},expression:"editingUser.number"}})],1)],1)],1),t("el-form-item",{attrs:{label:"职务",prop:"status"}},[t("el-select",{attrs:{placeholder:"请选择职务"},model:{value:e.editingUser.status,callback:function(t){e.$set(e.editingUser,"status",t)},expression:"editingUser.status"}},e._l([{label:"机构",value:0},{label:"电控",value:1}],(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"电子邮件",prop:"email"}},[t("el-input",{attrs:{placeholder:"请输入电子邮件地址"},model:{value:e.editingUser.email,callback:function(t){e.$set(e.editingUser,"email",t)},expression:"editingUser.email"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editUserVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleEditUser()}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"修改密码",visible:e.editPasswordVisible,width:"30%"},on:{"update:visible":function(t){e.editPasswordVisible=t}}},[t("el-form",{ref:"editPasswordRef",attrs:{model:e.passwordInfo,rules:e.passwordInfoRule,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"新密码",prop:"password"}},[t("el-input",{attrs:{type:"password"},model:{value:e.passwordInfo.password,callback:function(t){e.$set(e.passwordInfo,"password",t)},expression:"passwordInfo.password"}})],1),t("el-form-item",{attrs:{label:"确认密码",prop:"doublecheck"}},[t("el-input",{attrs:{type:"password"},model:{value:e.passwordInfo.doublecheck,callback:function(t){e.$set(e.passwordInfo,"doublecheck",t)},expression:"passwordInfo.doublecheck"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editPasswordVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updatePassword()}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"更换负责人",visible:e.chargeCaseSubVisible,width:"40%"},on:{"update:visible":function(t){e.chargeCaseSubVisible=t}}},[t("el-table",{attrs:{data:e.chargingTask}},[t("el-table-column",{attrs:{prop:"desc",label:"描述"}}),t("el-table-column",{attrs:{label:"开始时间"},scopedSlots:e._u([{key:"default",fn:function(a){return[null===a.row.startTime?t("el-tag",{attrs:{effect:"dark",type:"info"}},[e._v("未开始")]):t("el-tag",{attrs:{effect:"dark",type:"primary"}},[e._v(e._s(a.row.startTime))])]}}])}),t("el-table-column",{attrs:{label:"负责人"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-select",{attrs:{placeholder:"请选择负责人"},model:{value:a.row.userId,callback:function(t){e.$set(a.row,"userId",t)},expression:"scope.row.userId"}},e._l(e.allUser,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:function(t){return e.deleteByChargeId(a.row.caseSubId,a.row.userId)}}})]}}])})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updateChargeTask()}}},[e._v("确 定")]),t("el-button",{on:{click:function(t){e.chargeCaseSubVisible=!1}}},[e._v("取 消")])],1)],1)],1)},Os=[],js={data(){var e=(e,t,a)=>/^\d{6}$/.test(t)?a():a(new Error("工号是6位纯数字")),t=(e,t,a)=>{if(!/^(?=.*[a-zA-Z])(?=.*\d).{8,}$/.test(t))return a(new Error("密码必须包含字母、数字，长度大于8"));a()},a=(e,t,a)=>{if(t!==this.passwordInfo.password)return a(new Error("两次密码不一致"));a()},s=(e,t,a)=>{/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(t)&&a(),a(new Error("电子邮箱格式不正确"))};return{userList:[],total:0,queryInfo:{page:1,pageSize:7,query:""},addFormVisible:!1,addForm:{name:"",number:"",status:null},statusOps:[{value:0,label:"机构"},{value:1,label:"电控"},{value:2,label:"IE"}],addFormRules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}],number:[{required:!0,message:"请输入工号",trigger:"blur"},{validator:e,trigger:"blur"}],status:[{required:!0,message:"请选择职务",trigger:"blur"}]},editFormVisible:!1,editForm:{id:null,name:"",number:"",status:null,email:""},editUserVisible:!1,editPasswordVisible:!1,editingUser:{},editUserRule:{name:[{required:!0,message:"名字不可为空",trigger:"blur"},{min:2,max:10,message:"名字必须在2-10个字符之间",trigger:"blur"}],number:[{validator:e,trigger:"blur"}],email:[{required:!0,message:"电子邮箱不能为空",trigger:"blur"},{validator:s,trigger:"blur"}]},passwordInfo:{password:"",doublecheck:""},passwordInfoRule:{password:[{validator:t,trigger:"blur"}],doublecheck:[{validator:a,trigger:"blur"}]},chargingTask:[],chargeCaseSubVisible:!1,allUser:[]}},created(){this.getUserPage(),this.getAllUser()},computed:{...(0,k.rn)(["user"])},methods:{...(0,k.nv)(["editUserInfo"]),async getAllUser(){var e=await Me();200===e.code&&(this.allUser=e.data)},async getUserPage(){const e=await Be(this.queryInfo);this.userList=e.data.records,this.total=e.data.total},handleSizeChange(e){this.queryInfo.page=1,this.queryInfo.pageSize=e,this.getUserPage()},handleCurrentChange(e){this.queryInfo.page=e,this.getUserPage()},searchUser(){this.queryInfo.page=1,this.getUserPage()},addUser(){this.$refs.addFormRef.validate((async e=>{if(!e)return;const t=await Ge(this.addForm);200===t.code?(this.$message.success(t.data),this.getUserPage(),setTimeout((()=>{this.addFormVisible=!1}),1e3)):this.$message.error(t.msg)}))},async openEditUser(e){const t=await He(e);if(200!==t.code)return this.$message.error("用户信息查询失败");this.editForm=t.data,this.editFormVisible=!0},async editUser(){const e=await Ze(this.editForm);200===e.code?(this.$message.success(e.data),this.getUserPage(),this.editFormVisible=!1):this.$message.error(e.msg)},async removeUser(e){1===this.userList.length&&(this.queryInfo.page-=1);const t=await Ye(e);200===t.code?(this.$message.success(t.data),this.getUserPage()):"当前职员还有未完成的专案类任务，请为他负责的专案子阶段重新选择负责人后重试"===t.msg&&setTimeout((async()=>{var t=await Cr(e);this.chargingTask=t.data,this.chargeCaseSubVisible=!0}),1e3)},handleCommand(e){"editUser"===e?(this.editingUser={...this.user},this.editUserVisible=!0):this.editPasswordVisible=!0},handleEditUser(){this.$refs.editUserRef.validate((async e=>{if(e){const e=await this.editUserInfo(this.editingUser);200===e.code?(this.$message.success(e.data),this.editUserVisible=!1):this.$message.error(e.msg)}}))},updatePassword(){this.$refs.editPasswordRef.validate((async e=>{if(e){const e=await Xe({password:this.passwordInfo.password,id:this.user.id});200===e.code&&(this.$message.success(e.data),this.editPasswordVisible=!1)}}))},async deleteByChargeId(e,t){var a=await mt({caseSubId:e,userId:t});200===a.code?(this.$message.success(a.data),this.chargingTask=this.chargingTask.filter((a=>a.caseSubId!==e||a.userId!==t))):this.$message.error(a.msg)},async updateChargeTask(){var e=await gt(this.chargingTask);200===e.code&&(this.$message.success(e.data),this.chargingTask=[],this.chargeCaseSubVisible=!1)}}},As=js,zs=(0,o.Z)(As,Fs,Os,!1,null,"58394c8c",null),$s=zs.exports,Rs=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",[e._v("部员管理")]),t("el-breadcrumb-item",[e._v("部员专案管理")])],1)],1),t("el-card",[t("el-row",{attrs:{gutter:5}},[t("el-col",{attrs:{span:3}},[t("el-select",{attrs:{placeholder:"请选择任务类型",clearable:""},on:{change:function(t){return e.handleTypeChange()}},model:{value:e.curType,callback:function(t){e.curType=t},expression:"curType"}},e._l([{value:0,label:"专案类"},{value:1,label:"临时事务"},{value:2,label:"技术研究"}],(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-col",{attrs:{span:3}},[t("el-select",{attrs:{placeholder:"完成情况",clearable:""},model:{value:e.finishType,callback:function(t){e.finishType=t},expression:"finishType"}},e._l([{value:0,label:"正常"},{value:1,label:"延误"}],(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-col",{attrs:{span:6}},[t("el-date-picker",{attrs:{type:"daterange",align:"left","unlink-panels":"","range-separator":"——","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.timeOptions,"value-format":"yyyy-MM-dd"},model:{value:e.start_stop_time,callback:function(t){e.start_stop_time=t},expression:"start_stop_time"}})],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.filter()}}},[e._v("查询")])],1),t("el-col",{attrs:{span:1,offset:5}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-top",round:""},on:{click:function(t){return e.changeUser(-1)}}})],1),t("el-col",{attrs:{span:1}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-bottom",round:""},on:{click:function(t){return e.changeUser(1)}}})],1),t("el-col",{attrs:{span:3}},[t("el-select",{attrs:{placeholder:"请选择科员"},on:{change:function(t){return e.handleUserChange()}},model:{value:e.curUser,callback:function(t){e.curUser=t},expression:"curUser"}},e._l(e.directorOptions,(function(a){return t("el-option-group",{key:a.value,attrs:{label:a.label}},e._l(a.children,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)})),1)],1)],1),t("el-table",{staticStyle:{"font-size":"18px"},attrs:{data:e.showList,"default-sort":{prop:"finishTime",order:"descending"}},on:{"sort-change":e.handlesortChange}},[t("el-table-column",{attrs:{label:"类型"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.caseSubId?t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v("专案类")]):2===a.row.type?t("el-tag",{attrs:{effect:"dark"}},[e._v("技术研究")]):1===a.row.type?t("el-tag",{attrs:{effect:"dark",type:"warning"}},[e._v("临时事务")]):e._e()]}}])}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"startTime",sortable:"custom",label:"开始时间"}}),t("el-table-column",{attrs:{prop:"finishTime",sortable:"",label:"完成时间"}}),t("el-table-column",{attrs:{prop:"planDays",sortable:"",label:"计划时间"}}),t("el-table-column",{attrs:{prop:"executionDays",sortable:"",label:"执行时间"}}),t("el-table-column",{attrs:{prop:"unforcedDays",sortable:"",label:"外因延期"}}),t("el-table-column",{attrs:{prop:"applyDelay",sortable:"",label:"人为延期"}}),t("el-table-column",{attrs:{prop:"achievingRate",sortable:"",label:"达成率(%)"}}),t("el-table-column",{attrs:{label:"是否延误"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.isDelay?t("el-tag",{attrs:{effect:"dark",type:"danger"}},[e._v("延误")]):t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v("正常")])]}}])})],1),t("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"center"},attrs:{"current-page":e.pageInfo.page,"page-sizes":[8,10,15,20],"page-size":e.pageInfo.pageSize,layout:"total, sizes, prev, pager, next",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){return e.$set(e.pageInfo,"page",t)},"update:current-page":function(t){return e.$set(e.pageInfo,"page",t)}}}),t("div",{staticClass:"statistics_container"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:5}},[t("el-statistic",{attrs:{value:e.statisticsObj.executionDays,title:"总执行时长"}})],1),t("el-col",{attrs:{span:5}},[t("el-statistic",{attrs:{value:e.statisticsObj.delayDays,title:"总延误时长"}})],1),t("el-col",{attrs:{span:5}},[t("el-statistic",{attrs:{value:e.statisticsObj.sumTask,title:"完成任务总件数"}})],1),t("el-col",{attrs:{span:5}},[t("el-statistic",{attrs:{precision:2,suffix:"%",value:e.statisticsObj.taskAchievingRate,title:"任务按期达成率"}})],1),t("el-col",{attrs:{span:4}},[t("el-statistic",{attrs:{precision:2,suffix:"%",value:e.statisticsObj.avgAchievingRate,title:"总达成率"}})],1)],1)],1)],1),t("br"),t("div",{staticClass:"charts-area"},[t("el-card",{staticClass:"pie-chart"},[t("h2",[e._v("任务类别")]),t("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"taskType"}})]),t("el-card",{staticClass:"bar-chart"},[t("h2",[e._v("任务达成")]),t("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"taskAchieve"}})])],1)],1)},Vs=[],qs={name:"userStatistics",data(){return{showList:[],filterList:[],allTaskList:[],pageInfo:{page:1,pageSize:8},total:0,start_stop_time:null,timeOptions:{shortcuts:[{text:"最近一月",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}},{text:"最近半年",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-15552e6),e.$emit("pick",[a,t])}},{text:"最近一年",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-31536e6),e.$emit("pick",[a,t])}}]},curType:null,finishType:null,statisticsObj:{executionDays:0,delayDays:0,delayTask:0,sumTask:0,taskAchievingRate:0,avgAchievingRate:0},directorOptions:[{value:0,label:"机构",children:[]},{value:1,label:"电控",children:[]},{value:2,label:"IE",children:[]}],userMap:new Map,curUser:null,curIndex:0,curGroup:0,barInfo:{months:[],finishCount:[],finishDaysCount:[],taskAchieveRate:[],timeAchieveRate:[]},pieChart:null,barChart:null}},created(){var e=+localStorage.getItem("pim_user_statistics_pageSize");this.pageInfo.pageSize=0===e?8:e},async mounted(){await this.getAllUser(),this.curUser=this.directorOptions[0].children[0].value,this.barChart=this.$echarts.init(document.getElementById("taskAchieve")),this.pieChart=this.$echarts.init(document.getElementById("taskType")),await this.getFinishedTaskList()},beforeRouteEnter(e,t,a){a((t=>{"curUser"in e.query&&(t.curUser=e.query.curUser,t.getFinishedTaskList())}))},methods:{async getFinishedTaskList(){const e=await ma(this.curUser);200===e.code?(this.allTaskList=e.data,this.total=this.allTaskList.length,this.allTaskList.forEach((e=>{e.executionDays=jr(e.startTime,e.finishTime),e.achievingRate=+(100*(e.planDays+ +e.unforcedDays)/e.executionDays).toFixed(),e.isDelay=e.achievingRate<100})),this.filter()):this.$message.error(e.msg)},handleSizeChange(e){localStorage.setItem("pim_user_statistics_pageSize",e),this.pageInfo.pageSize=e,this.pageInfo.page=1,this.showList=this.filterList.slice((this.pageInfo.page-1)*this.pageInfo.pageSize,this.pageInfo.page*this.pageInfo.pageSize)},handleCurrentChange(e){this.pageInfo.page=e,this.showList=this.filterList.slice((this.pageInfo.page-1)*this.pageInfo.pageSize,this.pageInfo.page*this.pageInfo.pageSize)},handlesortChange(e){"ascending"===e.order?e.order=1:"descending"===e.order?e.order=-1:(e.order=-1,e.prop="finishTime"),this.filterList.sort(((t,a)=>t[e.prop]<a[e.prop]?-1*e.order:t[e.prop]>a[e.prop]?1*e.order:0)),this.showList=this.filterList.slice((this.pageInfo.page-1)*this.pageInfo.pageSize,this.pageInfo.page*this.pageInfo.pageSize)},filter(){if(this.filterList=this.allTaskList,null!==this.start_stop_time){const e=this.start_stop_time[0],t=this.start_stop_time[1];this.filterList=this.filterList.filter((a=>a.finishTime>=e&&a.finishTime<=t))}null!==this.curType&&""!==this.curType&&(0===this.curType?this.filterList=this.filterList.filter((e=>e.caseSubId)):this.filterList=this.filterList.filter((e=>e.type===this.curType))),null!==this.finishType&&""!==this.finishType&&(this.filterList=this.filterList.filter((e=>+e.isDelay===this.finishType))),this.initPie(),this.initBar(),this.generateStatistics(this.filterList),this.pageInfo.page=1,this.showList=this.filterList.slice((this.pageInfo.page-1)*this.pageInfo.pageSize,this.pageInfo.page*this.pageInfo.pageSize),this.total=this.filterList.length},generateStatistics(e){this.statisticsObj.executionDays=0,this.statisticsObj.delayDays=0,this.statisticsObj.delayTask=0,e.forEach((e=>{this.statisticsObj.executionDays+=e.executionDays,e.isDelay&&(this.statisticsObj.delayDays+=e.executionDays-(e.planDays+ +e.unforcedDays),this.statisticsObj.delayTask++)})),this.statisticsObj.sumTask=e.length,this.statisticsObj.taskAchievingRate=0===this.statisticsObj.sumTask?0:100*(this.statisticsObj.sumTask-this.statisticsObj.delayTask)/this.statisticsObj.sumTask,this.statisticsObj.avgAchievingRate=0===this.statisticsObj.sumTask?0:100*(this.statisticsObj.executionDays-this.statisticsObj.delayDays)/this.statisticsObj.executionDays},openCharts(){this.$router.push({name:"图表统计",query:{allTaskList:this.filterList,start_stop_time:this.start_stop_time}})},async getAllUser(){for(var{data:e}=await Me(),t=0;t<e.length;t++)this.directorOptions[e[t].status].children.push({value:e[t].id,label:e[t].name});for(t=0;t<this.directorOptions.length;t++)for(var a=0;a<this.directorOptions[t].children.length;a++)this.userMap.set(this.directorOptions[t].children[a].value,[t,a])},handleUserChange(){const e=this.userMap.get(this.curUser);this.curGroup=e[0],this.curIndex=e[1],this.getFinishedTaskList()},changeUser(e){this.curIndex+=e,this.curIndex>=this.directorOptions[this.curGroup].children.length&&(this.curGroup==this.directorOptions.length-1?this.curGroup=0:this.curGroup++,this.curIndex=0),this.curIndex<0&&(0==this.curGroup?this.curGroup=this.directorOptions.length-1:this.curGroup--,this.curIndex=this.directorOptions[this.curGroup].children.length-1),this.curUser=this.directorOptions[this.curGroup].children[this.curIndex].value,this.getFinishedTaskList()},initPie(){var e=[{name:"专案类",value:0},{name:"临时事务",value:0},{name:"技术研究",value:0}];this.allTaskList.forEach((t=>{t.caseSubId?e[0].value++:1===t.type?e[1].value++:2===t.type&&e[2].value++})),this.pieChart.setOption({legend:{orient:"vertical",left:0,top:"bottom"},tooltip:{trigger:"item",formatter:"<h4>{b}:{c}</h4><br><h4>比例:{d}%<h4>"},series:[{type:"pie",stillShowZeroSum:!1,data:e,radius:"90%",itemStyle:{color:function(e){return"专案类"===e.data.name?"#67c23a":"临时事务"===e.data.name?"#e6a23c":"技术研究"===e.data.name?"#409eff":void 0}}}]})},initBar(){this.handleBarInfo();var e=Object.keys(this.barInfo);e=e.filter((e=>"months"!==e)).map((e=>("finishCount"===e?e="完成任务（件）":"finishDaysCount"===e?e="完成任务时长（天）":"taskAchieveRate"===e?e="任务达成率":"timeAchieveRate"===e&&(e="时长达成率"),e))),this.barChart.setOption({legend:{orient:"vertical",data:e,top:"top",right:0},grid:{top:"6%",left:"2%",right:"15%",bottom:"0%",containLabel:!0},xAxis:{data:this.barInfo.months},yAxis:[{type:"value",nameTextStyle:{padding:[0,50,-50,200]},min:0,max:this.calMax(this.barInfo.finishDaysCount),splitNumber:6,interval:((this.calMax(this.barInfo.finishDaysCount)-0)/6).toFixed()},{type:"value",nameTextStyle:{padding:[0,50,-50,200]},min:0,max:this.calMax(this.barInfo.timeAchieveRate),splitNumber:6,interval:((this.calMax(this.barInfo.timeAchieveRate)-0)/6).toFixed(),axisLabel:{formatter:function(e){return e.toFixed(2)+"%"}}}],tooltip:{trigger:"axis",formatter:function(e){var t=e[0].axisValue+"<br/>";return e.forEach((function(e){e.seriesName.includes("率")?t+=e.marker+e.seriesName+": "+e.value+"%<br/>":t+=e.marker+e.seriesName+": "+e.value+"<br/>"})),t}},series:[{name:e[0],type:"bar",data:this.barInfo.finishCount,label:{show:!0,position:"top",fontSize:20}},{name:e[1],type:"bar",data:this.barInfo.finishDaysCount,label:{show:!0,position:"top",fontSize:20}},{name:e[2],type:"line",data:this.barInfo.taskAchieveRate,yAxisIndex:1,label:{show:!0,position:"top",fontSize:20,formatter:"{c}%"}},{name:e[3],type:"line",data:this.barInfo.timeAchieveRate,yAxisIndex:1,label:{show:!0,position:"top",fontSize:20,formatter:"{c}%"}}]})},handleBarInfo(){if(this.barInfo={months:[],finishCount:[],finishDaysCount:[],taskAchieveRate:[],timeAchieveRate:[]},0!==this.filterList.length){var e=this.filterList.reduce(((e,t)=>e.finishTime<t.finishTime?e:t)),t=this.filterList.reduce(((e,t)=>e.finishTime>t.finishTime?e:t));e=e.finishTime,e=e.split("-").slice(0,2),t=t.finishTime,t=t.split("-").slice(0,2);var a=+e[0],s=+e[1],i=+t[0],r=+t[1];while(a<i||a===i&&s<=r){var l=a+"-"+(s<10?"0"+s++:s++);s>12&&(s-=12,a++);var n=a+"-"+(s<10?"0"+s:s),o=0,c=0,u=0,p=0;this.allTaskList.forEach((e=>{e.finishTime>=l&&e.finishTime<n&&(o++,c+=e.executionDays,p+=e.planDays+e.unforcedDays,e.executionDays<=e.planDays+e.unforcedDays&&u++)})),this.barInfo.months.push(l),this.barInfo.finishCount.push(o),this.barInfo.finishDaysCount.push(c),this.barInfo.taskAchieveRate.push(0===o?0:(100*u/o).toFixed()),this.barInfo.timeAchieveRate.push(0===c?0:(100*p/c).toFixed())}}},calMax(e){var t=Math.max.apply(null,e),a=Math.ceil(t/5),s=5*a+5;return s},calMin(e){var t=Math.min.apply(null,e),a=Math.floor(t/1),s=1*a-5;return s}}},Us=qs,Ns=(0,o.Z)(Us,Rs,Vs,!1,null,"27613c16",null),Ps=Ns.exports,Es=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",[e._v("部员管理")]),t("el-breadcrumb-item",[e._v("部员专案追踪")])],1)],1),t("el-card",[t("el-row",[t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.navigateToUserProjectManagerPage()}}},[e._v("近况追踪")])],1),t("el-col",{attrs:{span:1,offset:17}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-top",round:""},on:{click:function(t){return e.changeUser(-1)}}})],1),t("el-col",{attrs:{span:1}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-bottom",round:""},on:{click:function(t){return e.changeUser(1)}}})],1),t("el-col",{attrs:{span:3}},[t("el-select",{attrs:{placeholder:"请选择科员"},on:{change:function(t){return e.handleUserChange()}},model:{value:e.curUser,callback:function(t){e.curUser=t},expression:"curUser"}},e._l(e.directorOptions,(function(a){return t("el-option-group",{key:a.value,attrs:{label:a.label}},e._l(a.children,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)})),1)],1)],1),t("br"),t("el-table",{staticStyle:{"font-size":"17px"},attrs:{data:e.userInfo},on:{"cell-dblclick":e.handleDoubleClick}},[t("el-table-column",{attrs:{label:"进度"},scopedSlots:e._u([{key:"default",fn:function(a){return[null===a.row.startTime?t("el-progress",{attrs:{"stroke-width":24,percentage:100,color:"#30E0D4","show-text":!1}}):a.row.pausing?a.row.pausing?t("el-progress",{attrs:{"stroke-width":24,percentage:100,color:"#909399","show-text":!1}}):e._e():t("el-progress",{attrs:{"stroke-width":24,percentage:a.row.percentage,status:a.row.finishedOwnWork?"primary":"leftDelay"in a.row?a.row.leftDelay>=0?"warning":"exception":"success"}})]}}])}),t("el-table-column",{attrs:{prop:"comment",label:"备注",width:"130"}}),t("el-table-column",{attrs:{label:"类型"},scopedSlots:e._u([{key:"default",fn:function(a){return[0===a.row.type?t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v("专案类")]):2===a.row.type?t("el-tag",{attrs:{effect:"dark"}},[e._v("技术研究")]):1===a.row.type?t("el-tag",{attrs:{effect:"dark",type:"warning"}},[e._v("临时事务")]):e._e()]}}])}),t("el-table-column",{attrs:{prop:"caseName",label:"专案/任务",width:"250"}}),t("el-table-column",{attrs:{prop:"subName",label:"阶段"}}),t("el-table-column",{attrs:{prop:"startTime",label:"开始时间"}}),t("el-table-column",{attrs:{prop:"presetTime",label:"预计完成"}}),t("el-table-column",{attrs:{prop:"pauseStart",label:"暂停时间"}}),t("el-table-column",{attrs:{prop:"planDays",label:"计划时间"}}),t("el-table-column",{attrs:{prop:"executionDays",label:"执行时间"}}),t("el-table-column",{attrs:{prop:"unforcedDays",label:"外因延期"}}),t("el-table-column",{attrs:{prop:"applyDelay",label:"人为延期"}}),t("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"显示备注",placement:"top"}},[a.row.caseSubId?t("el-button",{attrs:{icon:"el-icon-info",type:"primary",size:"mini",round:""},on:{click:function(t){return e.openCommentView(a.row)}}}):e._e()],1),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"专案详情",placement:"top"}},[a.row.caseSubId?t("el-button",{attrs:{icon:"el-icon-s-promotion",type:"primary",size:"mini",round:""},on:{click:function(t){return e.openCaseDetail(a.row)}}}):e._e()],1),1===e.user.type?t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"暂停",placement:"top"}},[a.row.pausing?e._e():t("el-button",{attrs:{icon:"el-icon-video-pause",type:"info",size:"mini",round:""},on:{click:function(t){return e.openPause(a.row)}}})],1):e._e(),1===e.user.type?t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"重启",placement:"top"}},[a.row.pausing?t("el-button",{attrs:{icon:"el-icon-video-play",type:"success",size:"mini",round:""},on:{click:function(t){return e.finishPause(a.row.pauseId)}}}):e._e()],1):e._e()]}}])})],1)],1),e.exceptionList.length>0?t("el-card",{staticStyle:{"margin-top":"5px"}},[t("h2",[e._v("中断专案")]),t("el-table",{staticStyle:{width:"100%","font-size":"18px"},attrs:{data:e.exceptionList,stripe:"",border:""}},[t("el-table-column",{attrs:{prop:"caseName",label:"专案"}}),t("el-table-column",{attrs:{prop:"subName",label:"阶段"}}),t("el-table-column",{attrs:{prop:"level",label:"难度"}}),t("el-table-column",{attrs:{prop:"planDays",label:"计划时间"}}),t("el-table-column",{attrs:{prop:"lastFinishTime",label:"上阶段完结时间"}}),t("el-table-column",{attrs:{prop:"interruptDays",label:"中断时间(天)"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"专案详情",placement:"top"}},[t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-s-promotion",round:""},on:{click:function(t){return e.openCaseDetail(a.row)}}})],1)]}}],null,!1,3712667071)})],1)],1):e._e(),e.commitVisible?t("el-card",[t("el-row",[2===e.user.status||1===e.user.type?t("el-col",{attrs:{span:23}},[t("el-row",[t("el-col",{attrs:{span:21}},[t("el-input",{attrs:{placeholder:"请输入最新备注"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitCommitForm.apply(null,arguments)}},model:{value:e.commitForm.newContent,callback:function(t){e.$set(e.commitForm,"newContent",t)},expression:"commitForm.newContent"}})],1),t("el-col",{attrs:{span:1,offset:1}},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"提交备注",placement:"top"}},[t("el-button",{attrs:{size:"medium",type:"primary",icon:"el-icon-finished",round:""},on:{click:e.submitCommitForm}})],1)],1),t("el-col",{attrs:{span:1}},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"撤回最新",placement:"top"}},[t("el-button",{attrs:{size:"medium",type:"danger",icon:"el-icon-toilet-paper",round:""},on:{click:e.deleteCommit}})],1)],1)],1)],1):e._e(),t("el-col",{attrs:{span:1,offset:2===e.user.status||1===e.user.type?0:23}},[t("el-button",{staticStyle:{"margin-bottom":"5px"},attrs:{type:"primary",icon:"el-icon-back",round:""},on:{click:function(t){e.commitVisible=!1}}})],1)],1),t("div",{staticClass:"commit_area"},[t("el-card",{staticStyle:{width:"40%","margin-right":"20px"}},[t("h2",[e._v("专案："+e._s(e.commitForm.caseName))]),t("br"),t("br"),t("h3",[e._v("阶段："+e._s(e.commitForm.subName))])]),t("el-card",{staticClass:"box-card",staticStyle:{width:"55%"}},[t("h2",[e._v("备注信息")]),t("ul",{directives:[{name:"show",rawName:"v-show",value:!e.showAllCommit,expression:"!showAllCommit"}]},e._l(e.commitForm.content.slice(0,4),(function(a,s){return t("li",{key:a.id,staticClass:"text item"},[t("h3",{style:{color:s<2?"red":"black"}},[e._v(e._s(a.content))])])})),0),t("ul",{directives:[{name:"show",rawName:"v-show",value:e.showAllCommit,expression:"showAllCommit"}]},e._l(e.commitForm.content,(function(a,s){return t("li",{key:a.id,staticClass:"text item"},[t("h3",{style:{color:s<2?"red":"black"}},[e._v(e._s(a.content))])])})),0),0===e.commitForm.content.length?t("label",[e._v("暂无备注")]):e._e(),t("el-row",[t("el-col",{attrs:{span:2,offset:10}},[e.showAllCommit?t("a",{staticClass:"viewItem",on:{click:e.showAll}},[e._v("收起")]):t("a",{staticClass:"viewItem",on:{click:e.showAll}},[e._v("展开全部")])])],1)],1)],1)],1):e._e(),t("el-card",{staticClass:"gantt-chart"},[t("div",{staticStyle:{width:"100%",height:"500px"},attrs:{id:"ganttChart"}})]),t("el-drawer",{attrs:{direction:"ltr",visible:e.delayDrawer,"with-header":!1,size:"50%"},on:{"update:visible":function(t){e.delayDrawer=t}}},[t("el-table",{staticStyle:{"font-size":"20px"},attrs:{data:e.delayList}},[t("el-table-column",{attrs:{prop:"applyReason",label:"延期原因",width:"550"}}),t("el-table-column",{attrs:{prop:"applyDays",label:"延期天数"}}),t("el-table-column",{attrs:{prop:"delayType",label:"延期类型"}})],1)],1),t("el-dialog",{attrs:{title:"暂停描述",visible:e.pauseVisible,width:"30%"},on:{"update:visible":function(t){e.pauseVisible=t}}},[t("el-input",{attrs:{placeholder:"描述暂停原因，后续将作为外界因素延期原因，请认真填写"},model:{value:e.pauseObj.description,callback:function(t){e.$set(e.pauseObj,"description",t)},expression:"pauseObj.description"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.pauseVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.startPause()}}},[e._v("确 定")])],1)],1)],1)},Ms=[];const Bs=e=>ur.post("/pause/startPause",e),Gs=e=>ur.put(`/pause/finishPause/${e}`);var Hs={name:"caseTracking",data(){return{userInfo:[],directorOptions:[{value:0,label:"机构",children:[]},{value:1,label:"电控",children:[]},{value:2,label:"IE",children:[]}],userMap:new Map,curUser:null,curGroup:null,curIndex:null,typePie:null,barInfo:null,commitVisible:!1,commitForm:{content:[],newContent:this.getToday()},exceptionList:[],showAllCommit:!1,delayList:[],delayDrawer:!1,pauseVisible:!1,pauseObj:{description:"",taskId:null,caseSubId:null,target:""}}},async mounted(){await this.getAllUser(),this.curUser=this.directorOptions[0].children[0].value,await this.getExceptionList(),this.curGroup=0,this.curIndex=0,this.getTaskByUserId(),this.gantt=this.$echarts.init(document.getElementById("ganttChart")),setTimeout((()=>{this.initGantt()}),100)},computed:{...(0,k.rn)(["user"])},methods:{async getExceptionList(){const e=await ga(this.curUser);200===e.code?(this.exceptionList=e.data,this.exceptionList.forEach((e=>{e.interruptDays=jr(e.lastFinishTime,new Date)-1,e.lastFinishTime=Lr(e.lastFinishTime)}))):this.$message.error(e.msg)},getToday(){var e=new Date,t=e.getMonth()+1,a=e.getDate();return t+"/"+a+"："},async getTaskByUserId(){var e=await da(this.curUser);this.userInfo=e.data;for(var t=0;t<this.userInfo.length;t++){this.userInfo[t].executionDays=jr(this.userInfo[t].startTime,new Date),this.userInfo[t].executionDays-=+this.userInfo[t].unforcedDays;var a=new Date(this.userInfo[t].startTime);a=a.setDate(a.getDate()+this.userInfo[t].planDays+this.userInfo[t].unforcedDays-1),this.userInfo[t].presetTime=a,this.userInfo[t].pauseStart=this.userInfo[t].pauseStart?Lr(this.userInfo[t].pauseStart):null;var s=new Date;if(s.setHours(0,0,0,0),s<=this.userInfo[t].presetTime){var i=jr(this.userInfo[t].startTime,s);this.userInfo[t].percentage=1*i/(this.userInfo[t].planDays+ +this.userInfo[t].unforcedDays)*100}else{var r=jr(this.userInfo[t].presetTime,s)-1;this.userInfo[t].leftDelay=this.userInfo[t].applyDelay-r,this.userInfo[t].leftDelay>=0?this.userInfo[t].percentage=r/this.userInfo[t].applyDelay*100:this.userInfo[t].percentage=jr(this.userInfo[t].startTime,s)/this.userInfo[t].planDays*100}this.userInfo[t].presetTime=Lr(this.userInfo[t].presetTime),this.userInfo[t].comment=this.percentageText(this.userInfo[t]),this.userInfo[t].percentage>100&&(this.userInfo[t].percentage=100)}if(0===this.userInfo.length&&(e=await ha(this.curUser),this.userInfo=e.data,this.userInfo.forEach((e=>e.comment="未开始"))),this.commitVisible){if(0===this.userInfo.length)return this.commitForm.content="",this.commitForm.caseName="暂无数据",void(this.commitForm.subName="暂无数据");var l=0;for(t=0;t<this.userInfo.length;t++)if(null!==this.userInfo[t].caseSubId){l++,this.openCommentView(this.userInfo[t]);break}0===l&&(this.commitForm.content=[],this.commitForm.caseName="暂无数据",this.commitForm.subName="暂无数据")}},percentageText(e){return e.pausing?"暂停中":"leftDelay"in e?e.leftDelay>=0?`延期剩余${e.leftDelay}天`:`已延误${e.applyDelay-e.leftDelay}天`:`执行剩余${e.planDays+1-e.executionDays}天`},async getAllUser(){for(var{data:e}=await Me(),t=0;t<e.length;t++)this.directorOptions[e[t].status].children.push({value:e[t].id,label:e[t].name});for(t=0;t<this.directorOptions.length;t++)for(var a=0;a<this.directorOptions[t].children.length;a++)this.userMap.set(this.directorOptions[t].children[a].value,[t,a])},handleUserChange(){const e=this.userMap.get(this.curUser);this.curGroup=e[0],this.curIndex=e[1],this.updateView()},async updateView(){await this.getTaskByUserId(),this.getExceptionList(),this.initGantt()},initGanttObj(e,t,a,s,i,r){return e.name=r,e.stack=t,e.type="bar",e.label={show:!0,color:"#000",position:"right",fontSize:15,formatter:function(e){var t=new Date(e.value);return 1===i||2===i?t.getMonth()+1+"-"+t.getDate():""}},e.zlevel=i,e.itemStyle=a?{normal:{color:"#fff"}}:{normal:{color:s,borderColor:"#fff",borderWidth:2}},e.data=[],e},initGantt(){var e=[];for(let o=this.userInfo.length-1;o>=0;o--)e.push(this.userInfo[o].description);var t=[],a={},s={},i={};a=this.initGanttObj(a,"bar0",!0,"#6ED77E",4,"开始时间"),s=this.initGanttObj(s,"bar1",!0,"#6ED77E",4,"开始时间"),i=this.initGanttObj(i,"bar0",!1,"#6ED77E",3,"预计完成时间");var r={};r=this.initGanttObj(r,"bar0",!1,"skyblue",2,"目标完成时间");var l={};l=this.initGanttObj(l,"bar1",!1,"#E23D3D",1,"当前时间");for(let o=this.userInfo.length-1;o>=0;o--)a.data.push(new Date(this.userInfo[o].startTime)),s.data.push(new Date(this.userInfo[o].startTime)),i.data.push(new Date(Or(this.userInfo[o].startTime,this.userInfo[o].planDays))),r.data.push(new Date(Or(this.userInfo[o].startTime,this.userInfo[o].planDays,this.userInfo[o].unforcedDays))),l.data.push(new Date);t.push(a),t.push(s),t.push(i),t.push(r),t.push(l);var n={backgroundColor:"#fff",title:{text:"执行甘特图",padding:20,textStyle:{fontSize:17,fontWeight:"bolder",color:"#333"},subtextStyle:{fontSize:13,fontWeight:"bolder"}},legend:{data:["开始时间","预计完成时间","目标完成时间","当前时间"],align:"right",right:80,top:50},grid:{containLabel:!0,show:!1,right:130,left:40,bottom:40,top:90},xAxis:{type:"time",axisLabel:{show:!0,interval:0}},yAxis:{axisLabel:{show:!0,interval:0},data:e},tooltip:{trigger:"axis",formatter:function(e){var t="",a=new Set;t+=e[0].axisValue+"<br/>";for(var s=0;s<e.length;s++)a.has(e[s].seriesName)||(a.add(e[s].seriesName),t+='<div style="display:inline-block;margin-right:5px;border-radius:50%;width:10px;height:10px;background-color:'+e[s].color+';"></div>'+e[s].seriesName+"："+Lr(e[s].value)+"<br/>");return t}},series:t};this.gantt.setOption(n)},calMax(e){var t=Math.max.apply(null,e),a=Math.ceil(t/5),s=5*a+5;return s},calMin(e){var t=Math.min.apply(null,e),a=Math.floor(t/1),s=1*a-5;return s},async openCommentView(e){this.commitForm.caseName=e.caseName,this.commitForm.subName=e.subName,this.commitForm.caseSubId=e.caseSubId,this.getAndShowCommit()},async getAndShowCommit(){var e=await Ne(this.commitForm.caseSubId);e=e.data,this.commitForm.content=[];for(var t=0;t<e.length;t++)this.commitForm.content.push({content:e[t].content,id:e[t].id});this.commitVisible=!0},async submitCommitForm(e){if(null===this.commitForm.newContent||""===this.commitForm.newContent)return void this.$message({message:"备注内容不能为空",type:"warning"});const t={};t.caseSubId=this.commitForm.caseSubId,t.content=this.commitForm.newContent,t.createUser=this.user.idw;var a=await Pe(t);200===a.code?(this.$message.success(a.data),this.initInput(),await this.getAndShowCommit()):this.$message.error(a.msg)},initInput(){this.commitForm.newContent=this.getToday()},deleteCommit(){this.$confirm("此操作将删除最新评论, 操作不可逆，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await Ee(this.commitForm.content[0].id);200===e.code?(this.$message.success(e.data),this.getAndShowCommit()):this.$message.error(e.msg)}))},openCaseDetail(e){this.$router.push({name:"子流程详情",query:{caseId:e.caseId,caseName:e.caseName}})},changeUser(e){this.curIndex+=e,this.curIndex>=this.directorOptions[this.curGroup].children.length&&(this.curGroup==this.directorOptions.length-1?this.curGroup=0:this.curGroup++,this.curIndex=0),this.curIndex<0&&(0==this.curGroup?this.curGroup=this.directorOptions.length-1:this.curGroup--,this.curIndex=this.directorOptions[this.curGroup].children.length-1),this.curUser=this.directorOptions[this.curGroup].children[this.curIndex].value,this.updateView()},showAll(){this.showAllCommit=!this.showAllCommit},navigateToUserProjectManagerPage(){this.$router.push({name:"部员专案统计",query:{curUser:this.curUser}})},handleDoubleClick(e,t){"专案/任务"===t.label||"阶段"===t.label?(null!==e.caseSubId&&this.navigateToDetailPage(e),null!==e.taskId&&this.showTaskDescription(e)):"外因延期"===t.label?this.showDelay(e,"外界因素延期"):"人为延期"===t.label&&this.showDelay(e,"人为因素延期")},navigateToDetailPage(e){null!==e.caseId&&this.$router.push({name:"子流程详情",query:{caseId:e.caseId,caseName:e.caseName}})},async showDelay(e,t){var a=await _t({caseSubId:e.caseSubId,taskId:e.taskId,delayType:t});this.delayList=a.data,this.delayDrawer=!0},showTaskDescription(e){this.commitForm.content=[{content:e.description}]},openPause(e){this.pauseObj.taskId=e.taskId,this.pauseObj.caseSubId=e.caseSubId,this.pauseObj.target=e.description,this.pauseVisible=!0},async startPause(){if(null===this.pauseObj.description||""===this.pauseObj.description)return void this.$message.error("暂停原因不能为空");const e=await Bs(this.pauseObj);200===e.code&&(this.$message.success(e.data),this.pauseObj.description="",this.pauseObj.taskId=null,this.pauseObj.caseSubId=null,this.pauseObj.target=null,this.pauseVisible=!1),this.getTaskByUserId()},finishPause(e){this.$confirm("确定重启该任务吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await Gs(e);200===t.code&&(this.$message.success(t.data),this.getTaskByUserId())}))}}},Zs=Hs,Ys=(0,o.Z)(Zs,Es,Ms,!1,null,"71d1baf3",null),Ws=Ys.exports,Xs=function(){var e=this,t=e._self._c;return t("div",{staticClass:"index_container"},[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",[e._v("个人中心")]),t("el-breadcrumb-item",[e._v("个人总览")])],1)],1),t("div",[t("div",{staticClass:"userHeader"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{placeholder:"输入专案查询"},model:{value:e.caseName,callback:function(t){e.caseName=t},expression:"caseName"}})],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.jump2QueryCase}})],1),t("el-col",{attrs:{span:1,offset:15}},[t("el-badge",{staticClass:"item",attrs:{value:e.logList.length,hidden:0===e.logList.length}},[t("el-button",{attrs:{round:""},on:{click:function(t){return e.$router.push("/user/info")}}},[t("i",{staticClass:"el-icon-chat-dot-round"})])],1)],1),t("el-col",{attrs:{span:1}},[t("el-dropdown",{on:{command:e.handleCommand}},[t("el-button",{attrs:{round:""}},[t("i",{staticClass:"el-icon-setting el-icon-arrow-down"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"editUser"}},[e._v("修改资料")]),t("el-dropdown-item",{attrs:{command:"password"}},[e._v("修改密码")])],1)],1)],1)],1)],1),t("div",{staticClass:"notice-container"},[t("el-card",[t("h2",{staticStyle:{"margin-bottom":"10px"}},[e._v("快捷访问")]),t("div",{staticClass:"link-container"},[t("el-link",{attrs:{type:"primary",target:"_blank",href:"https://scmail.ude-corp.com/"}},[e._v("邮件系统"),t("i",{staticClass:"el-icon-s-promotion"})]),t("el-button",{attrs:{type:"primary"},on:{click:e.jump2Case}},[e._v("申请子流程"),t("i",{staticClass:"el-icon-plus"})]),t("el-button",{attrs:{type:"primary"},on:{click:e.jump2Task}},[e._v("申请技术研究"),t("i",{staticClass:"el-icon-plus"})]),t("el-button",{attrs:{type:"primary"},on:{click:e.jump2CaseIndex}},[e._v("专案主页"),t("i",{staticClass:"el-icon-view"})]),t("el-button",{attrs:{type:"info"}},[e._v("待定")])],1)])],1),t("div",{staticClass:"task-container"},[t("el-card",{staticClass:"taskTable"},[t("h2",[e._v("最近任务")]),t("el-table",{staticStyle:{"margin-bottom":"15px"},attrs:{data:e.taskList}},[t("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(a){return[0===a.row.type?t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v("专案类")]):e._e(),1===a.row.type?t("el-tag",{attrs:{effect:"dark",type:"info"}},[e._v("临时事务")]):e._e(),2===a.row.type?t("el-tag",{attrs:{effect:"dark"}},[e._v("技术研究")]):e._e()]}}])}),t("el-table-column",{attrs:{prop:"caseName"}}),t("el-table-column",{attrs:{prop:"subName"}}),t("el-table-column",{attrs:{prop:"comment"}}),t("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(a){return[null===a.row.startTime?t("el-progress",{attrs:{"stroke-width":24,percentage:100,color:"#30E0D4","show-text":!1}}):a.row.pausing?a.row.pausing?t("el-progress",{attrs:{"stroke-width":24,percentage:a.row.percentage,color:"#909399","show-text":!1}}):e._e():t("el-progress",{attrs:{"stroke-width":24,percentage:a.row.percentage,status:a.row.finishedOwnWork?"primary":"leftDelay"in a.row?a.row.leftDelay>=0?"warning":"exception":"success"}})]}}])})],1)],1),t("el-calendar",{staticStyle:{width:"50%"},scopedSlots:e._u([{key:"dateCell",fn:function({data:a}){return[t("div",{staticStyle:{width:"100%",height:"100%","font-size":"25px","text-align":"center","line-height":"70px"},style:{"background-color":e.isFinishDay(a.day)?"skyblue":e.isSunDay(a.day)?"#5BEE58":"white"}},[e.isFinishDay(a.day)?t("el-tooltip",{attrs:{content:e.isFinishDay(a.day),placement:"top"},scopedSlots:e._u([{key:"content",fn:function(){return[t("div",{staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(e.isFinishDay(a.day)))])]},proxy:!0}],null,!0)},[t("p",{staticStyle:{color:"#F13E32"}},[e._v(e._s(e.formatData(a.day)+"★"))])]):e.isToday(a.day)?t("el-tooltip",{attrs:{content:"就在今天!",placement:"top"}},[t("p",[e._v(e._s(e.formatData(a.day)+"✔️"))])]):t("p",[e._v(" "+e._s(e.formatData(a.day))+" ")])],1)]}}])})],1),t("div",{staticClass:"applyArea"},[t("caseStatus")],1)]),t("el-dialog",{attrs:{title:"修改资料",visible:e.editUserVisible,width:"30%"},on:{"update:visible":function(t){e.editUserVisible=t}}},[t("el-form",{ref:"editUserRef",attrs:{rules:e.editUserRule,model:e.editUser,"label-width":"80px"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"姓名",prop:"name"}},[t("el-input",{model:{value:e.editUser.name,callback:function(t){e.$set(e.editUser,"name",t)},expression:"editUser.name"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"工号",prop:"number"}},[t("el-input",{model:{value:e.editUser.number,callback:function(t){e.$set(e.editUser,"number",t)},expression:"editUser.number"}})],1)],1)],1),t("el-form-item",{attrs:{label:"职务",prop:"status"}},[t("el-select",{attrs:{placeholder:"请选择职务"},model:{value:e.editUser.status,callback:function(t){e.$set(e.editUser,"status",t)},expression:"editUser.status"}},e._l([{label:"机构",value:0},{label:"电控",value:1}],(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"电子邮件",prop:"email"}},[t("el-input",{attrs:{placeholder:"请输入电子邮件地址"},model:{value:e.editUser.email,callback:function(t){e.$set(e.editUser,"email",t)},expression:"editUser.email"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editUserVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleEditUser()}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"修改密码",visible:e.editPasswordVisible,width:"30%"},on:{"update:visible":function(t){e.editPasswordVisible=t}}},[t("el-form",{ref:"editPasswordRef",attrs:{model:e.passwordInfo,rules:e.passwordInfoRule,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"新密码",prop:"password"}},[t("el-input",{attrs:{type:"password"},model:{value:e.passwordInfo.password,callback:function(t){e.$set(e.passwordInfo,"password",t)},expression:"passwordInfo.password"}})],1),t("el-form-item",{attrs:{label:"确认密码",prop:"doublecheck"}},[t("el-input",{attrs:{type:"password"},model:{value:e.passwordInfo.doublecheck,callback:function(t){e.$set(e.passwordInfo,"doublecheck",t)},expression:"passwordInfo.doublecheck"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editPasswordVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updatePassword()}}},[e._v("确 定")])],1)],1)],1)},Qs=[],Js={data(){var e=(e,t,a)=>{if(!/^\d{6}$/.test(t))return a(new Error("工号必须是6位数字"));a()},t=(e,t,a)=>{if(!/^(?=.*[a-zA-Z])(?=.*\d).{8,}$/.test(t))return a(new Error("密码必须包含字母、数字，长度大于8"));a()},a=(e,t,a)=>{if(t!==this.passwordInfo.password)return a(new Error("两次密码不一致"));a()},s=(e,t,a)=>{/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(t)&&a()};return{taskList:[],pieChart:null,statusPie:null,editUserVisible:!1,editPasswordVisible:!1,editUser:{},editUserRule:{name:[{required:!0,message:"名字不可为空",trigger:"blur"},{min:2,max:10,message:"名字必须在2-10个字符之间",trigger:"blur"}],number:[{validator:e,trigger:"blur"}],email:[{required:!0,message:"电子邮箱不能为空",trigger:"blur"},{validator:s,trigger:"blur"}]},passwordInfo:{password:"",doublecheck:""},passwordInfoRule:{password:[{validator:t,trigger:"blur"}],doublecheck:[{validator:a,trigger:"blur"}]},caseName:"",today:new Date}},computed:{...(0,k.rn)(["user"]),...(0,k.rn)("log",["logList"])},created(){},async mounted(){await this.initTaskList(),await this.getNotStartTaskList()},methods:{...(0,k.nv)(["editUserInfo"]),async getNotStartTaskList(){const e=await ha(this.user.id);e.data.forEach((e=>e.comment="即将开始")),this.taskList.push(...e.data)},async initTaskList(){const e=await da(this.user.id);if(200===e.code){this.taskList=e.data;for(var t=0,a=0;a<this.taskList.length;a++){this.taskList[a].executionDays=jr(this.taskList[a].startTime,new Date);var s=new Date(this.taskList[a].startTime);s=s.setDate(s.getDate()+this.taskList[a].planDays+this.taskList[a].unforcedDays),this.taskList[a].presetTime=s;var i=new Date;if(i.setHours(0,0,0,0),this.taskList[a].pauseStart=this.taskList[a].pauseStart?Lr(this.taskList[a].pauseStart):null,i<=this.taskList[a].presetTime){var r=jr(this.taskList[a].startTime,i);this.taskList[a].percentage=1*r/(this.taskList[a].planDays+ +this.taskList[a].unforcedDays)*100}else{var l=jr(this.taskList[a].presetTime,i)-1;this.taskList[a].leftDelay=this.taskList[a].applyDelay-l,this.taskList[a].leftDelay>=0?this.taskList[a].percentage=l/this.taskList[a].applyDelay*100:(this.taskList[a].percentage=100*jr(this.taskList[a].startTime,i)/this.taskList[a].planDays,this.taskList[a].finishedOwnWork||t++)}this.taskList[a].presetTime=Lr(this.taskList[a].presetTime),this.taskList[a].comment=this.percentageText(this.taskList[a]),this.taskList[a].percentage>100&&(this.taskList[a].percentage=100)}t&&this.$notify({title:"错误",message:"你当前有"+t+"个任务进度已滞后，请及时申请延期确定下一个交期",duration:0,type:"error"})}else this.$message.error(e.msg)},percentageText(e){return e.pausing?"暂停中":"leftDelay"in e?e.leftDelay>=0?`延期剩余${e.leftDelay}天`:`已延误${e.applyDelay-e.leftDelay}天`:`执行剩余${e.planDays+ +e.unforcedDays+1-e.executionDays}天`},renderPieChart(){var e=[{name:"专案类",value:0},{name:"临时事务",value:0},{name:"技术研究",value:0}],t=[{name:"已延误",value:0},{name:"时间过半",value:0},{name:"正在执行",value:0}];this.taskList.forEach((a=>{e[a.type].value+=1,100===+a.percentage?t[0].value+=1:+a.percentage>=60?t[1].value+=1:t[2].value+=1}));const a={legend:{orient:"vertical",x:"left",data:["专案类","临时事务","技术研究"]},series:[{type:"pie",data:e,radius:["40%","70%"],avoidLabelOverlap:!1,label:{show:!1,position:"center"},itemStyle:{color:function(e){return"专案类"===e.data.name?"#67c23a":"临时事务"===e.data.name?"#e6a23c":"技术研究"===e.data.name?"#409eff":void 0}},labelLine:{show:!1},emphasis:{label:{show:!0,fontSize:"30",fontWeight:"bold"}}}]},s={legend:{orient:"vertical",x:"left",data:["已延误","时间过半","正在执行"]},series:[{type:"pie",data:t,radius:["40%","70%"],avoidLabelOverlap:!1,label:{show:!1,position:"center"},itemStyle:{color:function(e){return"已延误"===e.data.name?"#f56c6c":"时间过半"===e.data.name?"#e6a23c":"正在执行"===e.data.name?"#67c23a":void 0}},labelLine:{show:!1},emphasis:{label:{show:!0,fontSize:"30",fontWeight:"bold"}}}]};this.typePie.setOption(a),this.statusPie.setOption(s)},handleCommand(e){"editUser"===e?(this.editUser={...this.user},this.editUserVisible=!0):this.editPasswordVisible=!0},handleEditUser(){this.$refs.editUserRef.validate((async e=>{if(e){const e=await this.editUserInfo(this.editUser);200===e.code?(this.$message.success(e.data),this.editUserVisible=!1):this.$message.error(e.msg)}}))},updatePassword(){this.$refs.editPasswordRef.validate((async e=>{if(e){const e=await Xe({password:this.passwordInfo.password,id:this.user.id});200===e.code&&(this.$message.success(e.data),this.editPasswordVisible=!1)}}))},jump2Case(){this.$router.push({path:"/user/progress",query:{applyCaseSubVisible:!0}})},jump2Task(){this.$router.push({path:"/user/progress",query:{applyTaskVisible:!0}})},jump2CaseIndex(){this.$router.push({path:"/common/index"})},jump2QueryCase(){this.$router.push({path:"/common/index",query:{caseName:this.caseName}})},isSunDay(e){return e=new Date(e),0===e.getDay()},formatData(e){var t=e.split("-");return 1===+t[2]?t[1]+"月":+t[2]},isToday(e){const t=(new Date).toISOString().slice(0,10);return e===t},isFinishDay(e){var t="";for(let a=0;a<this.taskList.length;a++)Or(this.taskList[a].presetTime,+this.taskList[a].applyDelay)===e&&(t+=this.taskList[a].description+"\n");return""!==t&&t}}},Ks=Js,ei=(0,o.Z)(Ks,Xs,Qs,!1,null,"783a43b5",null),ti=ei.exports,ai=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",[e._v("个人中心")]),t("el-breadcrumb-item",[e._v("执行任务")])],1)],1),t("el-card",[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:2,offset:20}},[t("el-button",{attrs:{type:"success",icon:"el-icon-plus"},on:{click:function(t){return e.initApplyCaseSub()}}},[e._v("申请子流程")])],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){e.applyTaskVisible=!0}}},[e._v("申请任务")])],1)],1),t("h2",[e._v("执行专案")]),t("el-table",{attrs:{data:e.userInfo},on:{"cell-dblclick":e.handleDoubleClick}},[t("el-table-column",{attrs:{label:"进度"},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.pausing?t("el-progress",{attrs:{"stroke-width":24,percentage:100,color:"#909399","show-text":!1}}):t("el-progress",{attrs:{"stroke-width":24,percentage:e.row.percentage,status:e.row.finishedOwnWork?"primary":"leftDelay"in e.row?e.row.leftDelay>=0?"warning":"exception":"success"}})]}}])}),t("el-table-column",{attrs:{prop:"comment",label:"备注"}}),t("el-table-column",{attrs:{label:"类型"},scopedSlots:e._u([{key:"default",fn:function(a){return[0===a.row.type?t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v("专案类")]):2===a.row.type?t("el-tag",{attrs:{effect:"dark"}},[e._v("技术研究")]):1===a.row.type?t("el-tag",{attrs:{effect:"dark",type:"warning"}},[e._v("临时事务")]):e._e()]}}])}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"startTime",label:"开始时间"}}),t("el-table-column",{attrs:{prop:"planDays",label:"计划时间"}}),t("el-table-column",{attrs:{prop:"pauseStart",label:"暂停时间"}}),t("el-table-column",{attrs:{prop:"executionDays",label:"执行时间"}}),t("el-table-column",{attrs:{prop:"unforcedDays",label:"外因延期"}}),t("el-table-column",{attrs:{prop:"applyDelay",label:"人为延期"}}),t("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.pausing||a.row.delayChecking?e._e():t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"申请延期",placement:"top"}},[t("el-button",{attrs:{size:"mini",type:"warning",icon:"el-icon-timer",round:""},on:{click:function(t){return e.openDelayApply(a.row)}}})],1),!a.row.pausing&&a.row.delayChecking?t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"审核中",placement:"top"}},[t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-timer",round:""}})],1):e._e(),a.row.pausing||a.row.finishChecking?e._e():t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"完结",placement:"top"}},[t("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-success",round:""},on:{click:function(t){return e.tryFinish(a.row)}}})],1),!a.row.pausing&&a.row.finishChecking?t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"完结审核中",placement:"top"}},[t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-success",round:""}})],1):e._e(),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"暂停",placement:"top"}},[a.row.pausing?e._e():t("el-button",{attrs:{icon:"el-icon-video-pause",type:"info",size:"mini",round:""},on:{click:function(t){return e.openPause(a.row)}}})],1),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"重启",placement:"top"}},[a.row.pausing?t("el-button",{attrs:{icon:"el-icon-video-play",type:"success",size:"mini",round:""},on:{click:function(t){return e.finishPause(a.row.pauseId)}}}):e._e()],1)]}}])})],1)],1),e.exceptionList.length>0?t("el-card",{staticStyle:{"margin-top":"5px"}},[t("h2",[e._v("中止专案")]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.exceptionList,stripe:"",border:""}},[t("el-table-column",{attrs:{prop:"caseName",label:"专案"}}),t("el-table-column",{attrs:{prop:"subName",label:"阶段"}}),t("el-table-column",{attrs:{prop:"level",label:"难度"}}),t("el-table-column",{attrs:{prop:"planDays",label:"计划时间"}}),t("el-table-column",{attrs:{prop:"lastFinishTime",label:"上阶段完结时间"}}),t("el-table-column",{attrs:{prop:"interruptDays",label:"中断时间(天)"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"开始执行",placement:"top"}},[t("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-success",round:""},on:{click:function(t){return e.tryStart(a.row)}}})],1),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"专案详情",placement:"top"}},[t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-s-promotion",round:""},on:{click:function(t){return e.openCaseDetail(a.row)}}})],1)]}}],null,!1,3347217251)})],1)],1):e._e(),t("br"),t("el-card",{staticClass:"gantt-chart"},[t("div",{staticStyle:{width:"100%",height:"500px"},attrs:{id:"ganttChart"}})]),t("el-dialog",{attrs:{title:"申请延期",visible:e.applyDelayVisible,width:"30%"},on:{"update:visible":function(t){e.applyDelayVisible=t},close:e.closeApplyDelay}},[t("el-form",{ref:"applyDelayFormRef",staticClass:"form",attrs:{rules:e.delayRules,model:e.delayApplyObject,"label-width":"110px"}},[t("el-form-item",{attrs:{label:"申请类型"}},[t("el-input",{attrs:{value:0===e.delayApplyObject.type?"专案类":1===e.delayApplyObject.type?"临时事务":"技术研究",disabled:""}})],1),t("el-form-item",{attrs:{label:"描述"}},[t("el-input",{attrs:{disabled:""},model:{value:e.delayApplyObject.description,callback:function(t){e.$set(e.delayApplyObject,"description",t)},expression:"delayApplyObject.description"}})],1),t("el-form-item",{attrs:{label:"延期类型",prop:"delayType"}},[t("el-select",{attrs:{placeholder:"请选择延期类型"},model:{value:e.delayApplyObject.delayType,callback:function(t){e.$set(e.delayApplyObject,"delayType",t)},expression:"delayApplyObject.delayType"}},e._l(["外界因素延期","人为因素延期"],(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("el-form-item",{attrs:{label:"原因描述:",prop:"applyReason"}},[t("el-input",{attrs:{autosize:"",type:"textarea",placeholder:"请输入延期原因描述"},model:{value:e.delayApplyObject.applyReason,callback:function(t){e.$set(e.delayApplyObject,"applyReason",t)},expression:"delayApplyObject.applyReason"}})],1),t("el-form-item",{attrs:{label:"申请天数",prop:"applyDays"}},[t("el-input",{attrs:{type:"number",placeholder:"请输入要申请的天数"},on:{input:e.computePresetTime},model:{value:e.delayApplyObject.applyDays,callback:function(t){e.$set(e.delayApplyObject,"applyDays",e._n(t))},expression:"delayApplyObject.applyDays"}})],1),e.delayApplyObject.presetFinishTime?t("el-form-item",{attrs:{label:"预计完成时间"}},[t("el-input",{attrs:{value:e.delayApplyObject.presetFinishTime,disabled:""}})],1):e._e()],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.applyDelayVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitDelayApply()}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"多负责人确认",width:"30%",visible:e.updateDescriptionVisible},on:{"update:visible":function(t){e.updateDescriptionVisible=t},close:e.closeDescriptionForm}},[t("h2",[e._v("请简述自己负责的工作及持续时间")]),t("br"),t("el-form",{ref:"descriptionFormRef",staticClass:"form",attrs:{"label-width":"90px"}},e._l(e.directors,(function(a){return t("el-form-item",{key:a.id,attrs:{label:a.name}},[t("el-input",{attrs:{placeholder:"例：CCD调试，累计执行15个工作日",disabled:a.userId!==e.user.id},model:{value:a.description,callback:function(t){e.$set(a,"description",t)},expression:"item.description"}})],1)})),1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.updateDescriptionVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitDirectorJobDescription()}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"申请参与专案子流程",visible:e.applyCaseSubVisible,width:"40%"},on:{"update:visible":function(t){e.applyCaseSubVisible=t},close:function(t){return e.$refs.applyCaseSubFormRef.resetFields()}}},[t("el-form",{ref:"applyCaseSubFormRef",attrs:{rules:e.applyCaseSubRules,model:e.applyCaseSubUser,"label-width":"100px"}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"专案名称",prop:"caseId"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.getUnfinishedSubList()}},model:{value:e.applyCaseSubUser.caseId,callback:function(t){e.$set(e.applyCaseSubUser,"caseId",t)},expression:"applyCaseSubUser.caseId"}},e._l(e.unFinishedCaseList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"子流程名称",prop:"caseSubId"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.flushCaseSubId},model:{value:e.applyCaseSubUser.caseSubId,callback:function(t){e.$set(e.applyCaseSubUser,"caseSubId",t)},expression:"applyCaseSubUser.caseSubId"}},e._l(e.unfinishedSubList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.subName,value:e.id}})})),1)],1)],1)],1),t("el-form-item",{attrs:{label:"工作描述",prop:"description"}},[t("el-input",{attrs:{placeholder:"请概要输入工作内容"},model:{value:e.applyCaseSubUser.description,callback:function(t){e.$set(e.applyCaseSubUser,"description",t)},expression:"applyCaseSubUser.description"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.applyCaseSubVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitApplyCaseSub()}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"申请任务",visible:e.applyTaskVisible,width:"30%"},on:{"update:visible":function(t){e.applyTaskVisible=t},close:function(t){return e.$refs.applyTaskFormRef.resetFields()}}},[t("el-form",{ref:"applyTaskFormRef",attrs:{rules:e.applyTaskRules,model:e.applyTask,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"任务类型",prop:"type"}},[t("el-select",{attrs:{placeholder:"请选择任务类型"},model:{value:e.applyTask.type,callback:function(t){e.$set(e.applyTask,"type",t)},expression:"applyTask.type"}},e._l([{label:"技术研究",value:2},{label:"临时事务",value:1}],(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"任务描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入任务描述"},model:{value:e.applyTask.description,callback:function(t){e.$set(e.applyTask,"description",t)},expression:"applyTask.description"}})],1),t("el-form-item",{attrs:{label:"预估时间",prop:"planDays"}},[t("el-input",{attrs:{type:"number",placeholder:"请输入预估完成时间（天）"},model:{value:e.applyTask.planDays,callback:function(t){e.$set(e.applyTask,"planDays",e._n(t))},expression:"applyTask.planDays"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.applyTaskVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitApplyTask()}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"选择完结日期",visible:e.selectFinishTimeVisible,width:"30%"},on:{"update:visible":function(t){e.selectFinishTimeVisible=t}}},[t("el-date-picker",{attrs:{type:"date",placeholder:"选择完结日期","value-format":"yyyy-MM-dd HH:mm:ss"},on:{input:e.changeTime},model:{value:e.curTask.applyTime,callback:function(t){e.$set(e.curTask,"applyTime",t)},expression:"curTask.applyTime"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.selectFinishTimeVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitFinish()}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"选择开始日期",visible:e.selectStartTimeVisible,width:"30%"},on:{"update:visible":function(t){e.selectStartTimeVisible=t}}},[t("el-date-picker",{attrs:{type:"date",placeholder:"选择开始日期","value-format":"yyyy-MM-dd HH:mm:ss"},on:{input:e.changeTime},model:{value:e.curInterruptTask.startTime,callback:function(t){e.$set(e.curInterruptTask,"startTime",t)},expression:"curInterruptTask.startTime"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.selectStartTimeVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.launch()}}},[e._v("确 定")])],1)],1),t("el-drawer",{attrs:{direction:"ltr",visible:e.delayDrawer,"with-header":!1,size:"50%"},on:{"update:visible":function(t){e.delayDrawer=t}}},[t("el-table",{attrs:{data:e.delayList}},[t("el-table-column",{attrs:{prop:"applyReason",label:"延期原因",width:"550"}}),t("el-table-column",{attrs:{prop:"applyDays",label:"延期天数"}}),t("el-table-column",{attrs:{prop:"delayType",label:"延期类型"}})],1)],1),t("el-dialog",{attrs:{title:"暂停描述",visible:e.pauseVisible,width:"30%"},on:{"update:visible":function(t){e.pauseVisible=t}}},[t("el-input",{attrs:{placeholder:"描述暂停原因，后续将作为外界因素延期原因，请认真填写"},model:{value:e.pauseObj.description,callback:function(t){e.$set(e.pauseObj,"description",t)},expression:"pauseObj.description"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.pauseVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.startPause()}}},[e._v("确 定")])],1)],1)],1)},si=[],ii={name:"case4me",data(){var e=(e,t,a)=>{(t<=0||t>90)&&a(new Error("申请天数必须在1-90之间")),a()},t=(e,t,a)=>{null!==t&&""!==t||a(new Error("申请天数不能为空")),t<1&&a(new Error("申请天数必须大于1")),a()};return{userInfo:[],applyDelayVisible:!1,delayApplyObject:{},delayRules:{applyReason:[{required:!0,message:"必须输入延期原因",trigger:"blur"}],applyDays:[{required:!0,message:"必须输入要延期的天数",trigger:"blur"},{validator:e,trigger:"blur"}],delayType:[{required:!0,message:"请选择延期类型",trigger:"change"}]},applyCaseSubRules:{caseId:[{required:!0,message:"请选择专案",trigger:"change"}],caseSubId:[{required:!0,message:"请选择子流程",trigger:"blur"}],description:[{required:!0,message:"请填写工作内容描述",trigger:"blur"}]},applyTaskRules:{type:[{required:!0,message:"请选择任务类型",trigger:"blur"}],description:[{required:!0,message:"请填写任务内容描述",trigger:"blur"}],planDays:[{required:!0,message:"申请天数不能为空",trigger:"blur"},{validator:t,trigger:"blur"}]},updateDescriptionVisible:!1,directors:[],applyCaseSubVisible:!1,applyCaseSubUser:{},unFinishedCaseList:[],unfinishedSubList:[],applyTaskVisible:!1,applyTask:{},curTask:{},selectFinishTimeVisible:!1,delayApplyList:[],finishApplyList:[],exceptionList:[],selectStartTimeVisible:!1,curInterruptTask:{},gantt:null,delayList:[],delayDrawer:!1,pauseVisible:!1,pauseObj:{description:"",taskId:null,caseSubId:null,target:""}}},async created(){await this.getTaskByUserId(),this.initGantt(),this.getUnfinishedCaseList(),this.getExceptionList()},mounted(){this.applyCaseSubVisible=this.$route.query.applyCaseSubVisible,this.applyTaskVisible=this.$route.query.applyTaskVisible},computed:{...(0,k.rn)(["user"])},methods:{async getExceptionList(){const e=await ga(this.user.id);200===e.code?(this.exceptionList=e.data,this.exceptionList.forEach((e=>{e.lastFinishTime=Lr(e.lastFinishTime),e.interruptDays=jr(e.lastFinishTime,new Date)-1}))):this.$message.error(e.msg)},async getDelayApplyList(){const e=await getDelayListByUserId(this.user.id);200===e.code?this.delayApplyList=e.data:this.$message.error(e.msg)},async getFinishApplyList(){const e=await Ea(this.user.id);200===e.code?this.finishApplyList=e.data:this.$message.error(e.msg)},async getTaskByUserId(){const e=await da(this.user.id);this.userInfo=e.data;for(var t=0;t<this.userInfo.length;t++){this.userInfo[t].executionDays=jr(this.userInfo[t].startTime,new Date);var a=new Date(this.userInfo[t].startTime);a=a.setDate(a.getDate()+this.userInfo[t].planDays+this.userInfo[t].unforcedDays-1),this.userInfo[t].presetTime=a;var s=new Date;if(s.setHours(0,0,0,0),this.userInfo[t].pauseStart=this.userInfo[t].pauseStart?Lr(this.userInfo[t].pauseStart):null,s<=this.userInfo[t].presetTime){var i=jr(this.userInfo[t].startTime,s);this.userInfo[t].percentage=1*i/(this.userInfo[t].planDays+ +this.userInfo[t].unforcedDays)*100}else{var r=jr(this.userInfo[t].presetTime,s)-1;this.userInfo[t].leftDelay=this.userInfo[t].applyDelay-r,this.userInfo[t].leftDelay>=0?this.userInfo[t].percentage=r/this.userInfo[t].applyDelay*100:(this.userInfo[t].percentage=jr(this.userInfo[t].startTime,s)/this.userInfo[t].planDays*100)}this.userInfo[t].presetTime=Lr(this.userInfo[t].presetTime),this.userInfo[t].comment=this.percentageText(this.userInfo[t]),this.userInfo[t].percentage>100&&(this.userInfo[t].percentage=100)}},percentageText(e){return e.pausing?"暂停中":"leftDelay"in e?e.leftDelay>=0?`延期剩余${e.leftDelay}天`:`已延误${e.applyDelay-e.leftDelay}天`:`执行剩余${e.planDays+ +e.unforcedDays+1-e.executionDays}天`},openDelayApply(e){this.applyDelayVisible=!0,this.delayApplyObject={...e},this.delayApplyObject.presetFinishTime=null},closeApplyDelay(){this.$refs.applyDelayFormRef.resetFields()},closeDescriptionForm(){this.$refs.descriptionFormRef.resetFields()},submitDelayApply(){this.$refs.applyDelayFormRef.validate((async e=>{if(e){this.delayApplyObject.applyId=this.user.id;const e=await vt(this.delayApplyObject);200===e.code?(this.$message.success(e.data),this.delayApplyObject={},this.applyDelayVisible=!1,this.getTaskByUserId()):this.$message.error(e.msg)}}))},async tryFinish(e){if(0===e.type){const t=await ht(e.caseSubId);200===t.code&&(t.data.length>1?this.openUpdateDescription(t.data):this.openSelectFinishTime(e))}else this.openSelectFinishTime(e)},openUpdateDescription(e){this.updateDescriptionVisible=!0,this.directors=e},openSelectFinishTime(e){this.curTask={...e},this.selectFinishTimeVisible=!0},changeTime(){this.$forceUpdate()},async submitFinish(){if(this.curTask.applyTime<this.curTask.startTime)return void this.$message.error("结束时间小于开始时间，请检查输入");this.curTask.applyId=this.user.id,this.curTask.applyTime=_r(this.curTask.applyTime);const e=await qa(this.curTask);200===e.code?(this.$message.success(e.data),this.selectFinishTimeVisible=!1,this.getTaskByUserId()):this.$message.error(e.msg)},async submitDirectorJobDescription(){for(var e=0;e<this.directors.length;e++){if(this.directors[e].userId===this.user.id&&(null===this.directors[e].description||""===this.directors[e].description))return void this.$message.error("你对自己的工作描述为空，请检查后重新提交");if(!("description"in this.directors[e])||null===this.directors[e].description||""===this.directors[e].description){const e=await yt(this.directors);return void(200===e.code?(this.$message.success(e.data),this.updateDescriptionVisible=!1):this.$message.error(e.error))}}const t=await yt(this.directors);200===t.code?(this.$message.success(t.data),this.updateDescriptionVisible=!1,setTimeout((()=>this.openSelectFinishTime({caseSubId:this.directors[0].caseSubId})),200)):this.$message.error(t.error)},async getUnfinishedCaseList(){const e=await je();200===e.code?this.unFinishedCaseList=e.data:this.$message.error(e.msg)},initApplyCaseSub(){this.applyCaseSubVisible=!0},async getUnfinishedSubList(){this.applyCaseSubUser.caseSubId=null;const e=await gr({caseId:this.applyCaseSubUser.caseId,userId:this.user.id});200===e.code?this.unfinishedSubList=e.data:this.$message.error(e.msg)},flushCaseSubId(){this.$forceUpdate()},submitApplyCaseSub(){this.$refs.applyCaseSubFormRef.validate((async e=>{if(e){this.applyCaseSubUser.applyId=this.user.id;const e=await os(this.applyCaseSubUser);200===e.code?(this.$message.success(e.data),this.applyCaseSubVisible=!1):this.$message.error(e.msg)}}))},submitApplyTask(){this.$refs.applyTaskFormRef.validate((async e=>{if(e){this.applyTask.applyId=this.user.id;const e=await Xa(this.applyTask);200===e.code?(this.applyTaskVisible=!1,this.$message.success(e.data)):this.$message.error(e.msg)}}))},openCaseDetail(e){this.$router.push({name:"子流程详情",query:{caseId:e.caseId,caseName:e.caseName}})},tryStart(e){this.curInterruptTask={...e},this.selectStartTimeVisible=!0},async launch(){const e=await yr(this.curInterruptTask);200===e.code&&(this.$message.success(e.data),this.getTaskByUserId(),this.getExceptionList(),this.selectStartTimeVisible=!1)},computePresetTime(){""!==this.delayApplyObject.applyDays?this.delayApplyObject.presetFinishTime=Lr(Or(this.delayApplyObject.startTime,this.delayApplyObject.planDays,this.delayApplyObject.unforcedDays,this.delayApplyObject.applyDelay,this.delayApplyObject.applyDays)):this.delayApplyObject.presetFinishTime=null},initGanttObj(e,t,a,s,i,r){return e.name=r,e.stack=t,e.type="bar",e.label={show:!0,color:"#000",position:"right",fontSize:20,formatter:function(e){var t=new Date(e.value);return 1===i||2===i?t.getMonth()+1+"/"+t.getDate():""}},e.zlevel=i,e.itemStyle=a?{color:"#fff"}:{color:s,borderColor:"#fff",borderWidth:2},e.data=[],e},initGantt(){this.gantt=this.$echarts.init(document.getElementById("ganttChart"));var e=[];for(let o=this.userInfo.length-1;o>=0;o--)e.push(this.userInfo[o].description);var t=[],a={},s={},i={};a=this.initGanttObj(a,"bar0",!0,"#6ED77E",4,"开始时间"),s=this.initGanttObj(s,"bar1",!0,"#6ED77E",4,"开始时间"),i=this.initGanttObj(i,"bar0",!1,"#6ED77E",3,"预计完成时间");var r={};r=this.initGanttObj(r,"bar0",!1,"skyblue",2,"目标完成时间");var l={};l=this.initGanttObj(l,"bar1",!1,"#E23D3D",1,"当前时间");for(let o=this.userInfo.length-1;o>=0;o--)a.data.push(new Date(this.userInfo[o].startTime)),s.data.push(new Date(this.userInfo[o].startTime)),i.data.push(new Date(Or(this.userInfo[o].startTime,this.userInfo[o].planDays))),r.data.push(new Date(Or(this.userInfo[o].startTime,this.userInfo[o].planDays,this.userInfo[o].unforcedDays))),l.data.push(new Date(Or(this.userInfo[o].startTime,this.userInfo[o].executionDays)));t.push(a),t.push(s),t.push(i),t.push(r),t.push(l);var n={backgroundColor:"#fff",title:{text:"执行甘特图",padding:20,textStyle:{fontSize:17,fontWeight:"bolder",color:"#333"},subtextStyle:{fontSize:13,fontWeight:"bolder"}},legend:{data:["开始时间","预计完成时间","目标完成时间","当前时间"],align:"right",right:80,top:50},grid:{containLabel:!0,show:!1,right:130,left:40,bottom:40,top:90},xAxis:{type:"time",axisLabel:{show:!0,interval:0}},yAxis:{axisLabel:{show:!0,interval:0},data:e},tooltip:{trigger:"axis",formatter:function(e){var t="",a=new Set;t+=e[0].axisValue+"<br/>";for(var s=0;s<e.length;s++)a.has(e[s].seriesName)||(a.add(e[s].seriesName),t+='<div style="display:inline-block;margin-right:5px;border-radius:50%;width:10px;height:10px;background-color:'+e[s].color+';"></div>'+e[s].seriesName+"："+Lr(e[s].value)+"<br/>");return t}},series:t};this.gantt.setOption(n)},handleDoubleClick(e,t){"描述"===t.label?this.navigateToDetailPage(e):"外因延期"===t.label?this.showDelay(e,"外界因素延期"):"人为延期"===t.label&&this.showDelay(e,"人为因素延期")},navigateToDetailPage(e){null!==e.caseId&&this.$router.push({name:"子流程详情",query:{caseId:e.caseId,caseName:e.description.split("→")[0]}})},async showDelay(e,t){var a=await _t({caseSubId:e.caseSubId,taskId:e.taskId,delayType:t});this.delayList=a.data,this.delayDrawer=!0},openPause(e){this.pauseObj.taskId=e.taskId,this.pauseObj.caseSubId=e.caseSubId,this.pauseObj.target=e.description,this.pauseVisible=!0},async startPause(){if(null===this.pauseObj.description||""===this.pauseObj.description)return void this.$message.error("暂停原因不能为空");const e=await Bs(this.pauseObj);200===e.code&&(this.$message.success(e.data),this.pauseObj.description="",this.pauseObj.taskId=null,this.pauseObj.caseSubId=null,this.pauseObj.target=null,this.pauseVisible=!1),this.getTaskByUserId()},finishPause(e){this.$confirm("确定重启该任务吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await Gs(e);200===t.code&&(this.$message.success(t.data),this.getTaskByUserId())}))}}},ri=ii,li=(0,o.Z)(ri,ai,si,!1,null,"1f2d9575",null),ni=li.exports,oi=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",[e._v("个人中心")]),t("el-breadcrumb-item",[e._v("数据统计")])],1)],1),t("el-card",[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:3}},[t("el-select",{attrs:{placeholder:"请选择任务类型",clearable:""},model:{value:e.curType,callback:function(t){e.curType=t},expression:"curType"}},e._l([{value:0,label:"专案类"},{value:1,label:"临时事务"},{value:2,label:"技术研究"}],(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-col",{attrs:{span:3}},[t("el-select",{attrs:{placeholder:"完成情况",clearable:""},model:{value:e.finishType,callback:function(t){e.finishType=t},expression:"finishType"}},e._l([{value:0,label:"正常"},{value:1,label:"延误"}],(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-col",{attrs:{span:6}},[t("el-date-picker",{attrs:{type:"daterange",align:"left","unlink-panels":"","range-separator":"——","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.timeOptions,"value-format":"yyyy-MM-dd"},model:{value:e.start_stop_time,callback:function(t){e.start_stop_time=t},expression:"start_stop_time"}})],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.filter()}}},[e._v("查询")])],1)],1),t("el-table",{staticStyle:{"font-size":"18px"},attrs:{data:e.showList,"default-sort":{prop:"finishTime",order:"descending"}},on:{"sort-change":e.handlesortChange}},[t("el-table-column",{attrs:{label:"类型"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.caseSubId?t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v("专案类")]):2===a.row.type?t("el-tag",{attrs:{effect:"dark"}},[e._v("技术研究")]):1===a.row.type?t("el-tag",{attrs:{effect:"dark",type:"warning"}},[e._v("临时事务")]):e._e()]}}])}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"startTime",sortable:"custom",label:"开始时间"}}),t("el-table-column",{attrs:{prop:"finishTime",sortable:"",label:"完成时间"}}),t("el-table-column",{attrs:{prop:"planDays",sortable:"",label:"计划时间"}}),t("el-table-column",{attrs:{prop:"executionDays",sortable:"",label:"执行时间"}}),t("el-table-column",{attrs:{prop:"unforcedDays",sortable:"",label:"外因延期"}}),t("el-table-column",{attrs:{prop:"applyDelay",sortable:"",label:"人为延期"}}),t("el-table-column",{attrs:{prop:"achievingRate",sortable:"",label:"达成率(%)"}}),t("el-table-column",{attrs:{label:"是否延误"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.isDelay?t("el-tag",{attrs:{effect:"dark",type:"danger"}},[e._v("延误")]):t("el-tag",{attrs:{effect:"dark",type:"success"}},[e._v("正常")])]}}])})],1),t("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"center"},attrs:{"current-page":e.pageInfo.page,"page-sizes":[8,10,15,20],"page-size":e.pageInfo.pageSize,layout:"total, sizes, prev, pager, next",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){return e.$set(e.pageInfo,"page",t)},"update:current-page":function(t){return e.$set(e.pageInfo,"page",t)}}}),t("div",{staticClass:"statistics_container"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:5}},[t("el-statistic",{attrs:{value:e.statisticsObj.executionDays,title:"总执行时长"}})],1),t("el-col",{attrs:{span:5}},[t("el-statistic",{attrs:{value:e.statisticsObj.delayDays,title:"总延误时长"}})],1),t("el-col",{attrs:{span:5}},[t("el-statistic",{attrs:{value:e.statisticsObj.sumTask,title:"完成任务总件数"}})],1),t("el-col",{attrs:{span:5}},[t("el-statistic",{attrs:{precision:2,suffix:"%",value:e.statisticsObj.taskAchievingRate,title:"任务按期达成率"}})],1),t("el-col",{attrs:{span:4}},[t("el-statistic",{attrs:{precision:2,suffix:"%",value:e.statisticsObj.avgAchievingRate,title:"总达成率"}})],1)],1)],1)],1),t("br"),t("div",{staticClass:"charts-area"},[t("el-card",{staticClass:"pie-chart"},[t("h2",[e._v("任务类别")]),t("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"taskType"}})]),t("el-card",{staticClass:"bar-chart"},[t("h2",[e._v("任务达成")]),t("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"taskAchieve"}})])],1)],1)},ci=[],ui={name:"userStatistics",data(){return{showList:[],filterList:[],allTaskList:[],pageInfo:{page:1,pageSize:8},total:0,start_stop_time:null,timeOptions:{shortcuts:[{text:"最近一月",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}},{text:"最近半年",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-15552e6),e.$emit("pick",[a,t])}},{text:"最近一年",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-31536e6),e.$emit("pick",[a,t])}}]},curType:null,finishType:null,statisticsObj:{executionDays:0,delayDays:0,delayTask:0,sumTask:0,taskAchievingRate:0,avgAchievingRate:0},barInfo:{months:[],finishCount:[],finishDaysCount:[],taskAchieveRate:[],timeAchieveRate:[]},pieChart:null,barChart:null}},async created(){var e=+localStorage.getItem("pim_user_statistics_pageSize");this.pageInfo.pageSize=0===e?8:e,await this.getFinishedTaskList()},beforeRouteEnter(e,t,a){a((t=>{"curType"in e.query&&(t.curType=+e.query.curType,t.filter())}))},computed:{...(0,k.rn)(["user"])},async mounted(){this.barChart=this.$echarts.init(document.getElementById("taskAchieve")),this.pieChart=this.$echarts.init(document.getElementById("taskType")),await this.getFinishedTaskList()},methods:{async getFinishedTaskList(){const e=await ma(this.user.id);200===e.code?(this.allTaskList=e.data,this.total=this.allTaskList.length,this.allTaskList.forEach((e=>{e.executionDays=jr(e.startTime,e.finishTime),e.achievingRate=+(100*e.planDays/e.executionDays).toFixed(),e.isDelay=e.achievingRate<100})),this.filter()):this.$message.error(e.msg)},handleSizeChange(e){localStorage.setItem("pim_user_statistics_pageSize",e),this.pageInfo.pageSize=e,this.pageInfo.page=1,this.showList=this.filterList.slice((this.pageInfo.page-1)*this.pageInfo.pageSize,this.pageInfo.page*this.pageInfo.pageSize)},handleCurrentChange(e){this.pageInfo.page=e,this.showList=this.filterList.slice((this.pageInfo.page-1)*this.pageInfo.pageSize,this.pageInfo.page*this.pageInfo.pageSize)},handlesortChange(e){"ascending"===e.order?e.order=1:"descending"===e.order?e.order=-1:(e.order=-1,e.prop="finishTime"),this.filterList.sort(((t,a)=>t[e.prop]<a[e.prop]?-1*e.order:t[e.prop]>a[e.prop]?1*e.order:0)),this.showList=this.filterList.slice((this.pageInfo.page-1)*this.pageInfo.pageSize,this.pageInfo.page*this.pageInfo.pageSize)},filter(){if(this.filterList=this.allTaskList,null!==this.start_stop_time){const e=this.start_stop_time[0],t=this.start_stop_time[1];this.filterList=this.filterList.filter((a=>a.finishTime>=e&&a.finishTime<=t))}null!==this.curType&&""!==this.curType&&(0===this.curType?this.filterList=this.filterList.filter((e=>e.caseSubId)):this.filterList=this.filterList.filter((e=>e.type===this.curType))),null!==this.finishType&&""!==this.finishType&&(this.filterList=this.filterList.filter((e=>+e.isDelay===this.finishType))),this.initPie(),this.initBar(),this.generateStatistics(this.filterList),this.pageInfo.page=1,this.showList=this.filterList.slice((this.pageInfo.page-1)*this.pageInfo.pageSize,this.pageInfo.page*this.pageInfo.pageSize),this.total=this.filterList.length},generateStatistics(e){this.statisticsObj.executionDays=0,this.statisticsObj.delayDays=0,this.statisticsObj.delayTask=0,e.forEach((e=>{this.statisticsObj.executionDays+=e.executionDays,e.isDelay&&(this.statisticsObj.delayDays+=e.executionDays-(e.planDays+ +e.unforcedDays),this.statisticsObj.delayTask++)})),this.statisticsObj.sumTask=e.length,this.statisticsObj.taskAchievingRate=0===this.statisticsObj.sumTask?0:100*(this.statisticsObj.sumTask-this.statisticsObj.delayTask)/this.statisticsObj.sumTask,this.statisticsObj.avgAchievingRate=0===this.statisticsObj.sumTask?0:100*(this.statisticsObj.executionDays-this.statisticsObj.delayDays)/this.statisticsObj.executionDays},initPie(){var e=[{name:"专案类",value:0},{name:"临时事务",value:0},{name:"技术研究",value:0}];this.allTaskList.forEach((t=>{t.caseSubId?e[0].value++:1===t.type?e[1].value++:2===t.type&&e[2].value++})),this.pieChart.setOption({legend:{orient:"vertical",left:0,top:"bottom"},tooltip:{trigger:"item",formatter:"<h4>{b}:{c}</h4><br><h4>比例:{d}%<h4>"},series:[{type:"pie",stillShowZeroSum:!1,data:e,radius:"90%",itemStyle:{color:function(e){return"专案类"===e.data.name?"#67c23a":"临时事务"===e.data.name?"#e6a23c":"技术研究"===e.data.name?"#409eff":void 0}}}]})},initBar(){this.handleBarInfo();var e=Object.keys(this.barInfo);e=e.filter((e=>"months"!==e)).map((e=>("finishCount"===e?e="完成任务（件）":"finishDaysCount"===e?e="完成任务时长（天）":"taskAchieveRate"===e?e="任务达成率":"timeAchieveRate"===e&&(e="时长达成率"),e))),this.barChart.setOption({legend:{orient:"vertical",data:e,top:"top",right:0},grid:{top:"6%",left:"2%",right:"15%",bottom:"0%",containLabel:!0},xAxis:{data:this.barInfo.months},yAxis:[{type:"value",nameTextStyle:{padding:[0,50,-50,200]},min:0,max:this.calMax(this.barInfo.finishDaysCount),splitNumber:6,interval:((this.calMax(this.barInfo.finishDaysCount)-0)/6).toFixed()},{type:"value",nameTextStyle:{padding:[0,50,-50,200]},min:0,max:this.calMax(this.barInfo.timeAchieveRate),splitNumber:6,interval:((this.calMax(this.barInfo.timeAchieveRate)-0)/6).toFixed(),axisLabel:{formatter:function(e){return e.toFixed(2)+"%"}}}],tooltip:{trigger:"axis",formatter:function(e){var t=e[0].axisValue+"<br/>";return e.forEach((function(e){e.seriesName.includes("率")?t+=e.marker+e.seriesName+": "+e.value+"%<br/>":t+=e.marker+e.seriesName+": "+e.value+"<br/>"})),t}},series:[{name:e[0],type:"bar",data:this.barInfo.finishCount,label:{show:!0,position:"top",fontSize:20}},{name:e[1],type:"bar",data:this.barInfo.finishDaysCount,label:{show:!0,position:"top",fontSize:20}},{name:e[2],type:"line",data:this.barInfo.taskAchieveRate,yAxisIndex:1,label:{show:!0,position:"top",formatter:"{c}%",fontSize:20}},{name:e[3],type:"line",data:this.barInfo.timeAchieveRate,yAxisIndex:1,label:{show:!0,position:"top",fontSize:20,formatter:"{c}%"}}]})},handleBarInfo(){if(this.barInfo={months:[],finishCount:[],finishDaysCount:[],taskAchieveRate:[],timeAchieveRate:[]},0!==this.filterList.length){var e=this.filterList.reduce(((e,t)=>e.finishTime<t.finishTime?e:t)),t=this.filterList.reduce(((e,t)=>e.finishTime>t.finishTime?e:t));e=e.finishTime,e=e.split("-").slice(0,2),t=t.finishTime,t=t.split("-").slice(0,2);var a=+e[0],s=+e[1],i=+t[0],r=+t[1];while(a<i||a===i&&s<=r){var l=a+"-"+(s<10?"0"+s++:s++);s>12&&(s-=12,a++);var n=a+"-"+(s<10?"0"+s:s),o=0,c=0,u=0,p=0;this.allTaskList.forEach((e=>{e.finishTime>=l&&e.finishTime<n&&(o++,c+=e.executionDays,p+=e.planDays+e.unforcedDays,e.executionDays<=e.planDays+e.unforcedDays&&u++)})),this.barInfo.months.push(l),this.barInfo.finishCount.push(o),this.barInfo.finishDaysCount.push(c),this.barInfo.taskAchieveRate.push(0===o?0:(100*u/o).toFixed(2)),this.barInfo.timeAchieveRate.push(0===c?0:(100*p/c).toFixed(2))}}},calMax(e){var t=Math.max.apply(null,e),a=Math.ceil(t/5),s=5*a+5;return s},calMin(e){var t=Math.min.apply(null,e),a=Math.floor(t/1),s=1*a-5;return s}}},pi=ui,di=(0,o.Z)(pi,oi,ci,!1,null,"04e84602",null),hi=di.exports,mi=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",[e._v("个人中心")]),t("el-breadcrumb-item",[e._v("数据统计")]),t("el-breadcrumb-item",[e._v("图表统计")])],1)],1),t("el-card",[t("el-row",{staticStyle:{"margin-bottom":"10px"}},[t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-back"},on:{click:function(t){return e.$router.back()}}},[e._v("表格视图")])],1),e.start_stop_time?t("el-col",{attrs:{span:8,offset:7}},[t("h2",[e._v(e._s(e.start_stop_time[0])+"——"+e._s(e.start_stop_time[1]))])]):e._e()],1),t("div",{staticClass:"charts-area"},[t("el-card",{staticClass:"pie-chart"},[t("h2",[e._v("任务类别")]),t("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"taskType"}})]),t("el-card",{staticClass:"bar-chart"},[t("h2",[e._v("任务达成")]),t("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"taskAchieve"}})])],1)],1)],1)},bi=[],fi={data(){return{allTaskList:[],barInfo:{months:[],finishCount:[],finishDaysCount:[],taskAchieveRate:[],timeAchieveRate:[]},start_stop_time:null}},created(){this.allTaskList=this.$route.query.allTaskList,this.start_stop_time=this.$route.query.start_stop_time},mounted(){this.initPie(),this.initBar()},methods:{initPie(){var e=this.$echarts.init(document.getElementById("taskType")),t=[{name:"专案类",value:0},{name:"临时事务",value:0},{name:"技术研究",value:0}];this.allTaskList.forEach((e=>{e.caseSubId?t[0].value++:1===e.type?t[1].value++:2===e.type&&t[2].value++})),e.setOption({legend:{orient:"vertical",left:0,top:"bottom"},tooltip:{trigger:"item",formatter:"<h4>{b}:{c}</h4><br><h4>比例:{d}%<h4>"},series:[{type:"pie",stillShowZeroSum:!1,data:t,radius:"90%",itemStyle:{color:function(e){return"专案类"===e.data.name?"#67c23a":"临时事务"===e.data.name?"#e6a23c":"技术研究"===e.data.name?"#409eff":void 0}}}]})},initBar(){this.handleBarInfo();var e=this.$echarts.init(document.getElementById("taskAchieve")),t=Object.keys(this.barInfo);t=t.filter((e=>"months"!==e)).map((e=>("finishCount"===e?e="完成任务（件）":"finishDaysCount"===e?e="完成任务时长（天）":"taskAchieveRate"===e?e="任务达成率":"timeAchieveRate"===e&&(e="时长达成率"),e))),e.setOption({legend:{orient:"vertical",data:t,top:"top",right:0},grid:{top:"6%",left:"2%",right:"15%",bottom:"0%",containLabel:!0},xAxis:{data:this.barInfo.months},yAxis:[{type:"value",nameTextStyle:{padding:[0,50,-50,200]},min:0,max:this.calMax(this.barInfo.finishDaysCount),splitNumber:6,interval:((this.calMax(this.barInfo.finishDaysCount)-0)/6).toFixed()},{type:"value",nameTextStyle:{padding:[0,50,-50,200]},min:0,max:this.calMax(this.barInfo.timeAchieveRate),splitNumber:6,interval:((this.calMax(this.barInfo.timeAchieveRate)-0)/6).toFixed(),axisLabel:{formatter:function(e){return e.toFixed(2)+"%"}}}],tooltip:{trigger:"axis",formatter:function(e){var t=e[0].axisValue+"<br/>";return e.forEach((function(e){e.seriesName.includes("率")?t+=e.marker+e.seriesName+": "+e.value+"%<br/>":t+=e.marker+e.seriesName+": "+e.value+"<br/>"})),t}},series:[{name:t[0],type:"bar",data:this.barInfo.finishCount,label:{show:!0,position:"top"}},{name:t[1],type:"bar",data:this.barInfo.finishDaysCount,label:{show:!0,position:"top"}},{name:t[2],type:"line",data:this.barInfo.taskAchieveRate,yAxisIndex:1,label:{show:!0,position:"top",formatter:"{c}%"}},{name:t[3],type:"line",data:this.barInfo.timeAchieveRate,yAxisIndex:1,label:{show:!0,position:"top",formatter:"{c}%"}}]})},handleBarInfo(){var e=this.allTaskList.reduce(((e,t)=>e.finishTime<t.finishTime?e:t)),t=this.allTaskList.reduce(((e,t)=>e.finishTime>t.finishTime?e:t));e=e.finishTime,e=e.split("-").slice(0,2),t=t.finishTime,t=t.split("-").slice(0,2);var a=+e[0],s=+e[1],i=+t[0],r=+t[1];while(a<i||a===i&&s<=r){var l=a+"-"+(s<10?"0"+s++:s++);s>12&&(s-=12,a++);var n=a+"-"+(s<10?"0"+s:s),o=0,c=0,u=0,p=0;this.allTaskList.forEach((e=>{e.finishTime>=l&&e.finishTime<n&&(o++,c+=e.executionDays,p+=e.planDays+e.unforcedDays,e.executionDays<=e.planDays+e.unforcedDays&&u++)})),this.barInfo.months.push(l),this.barInfo.finishCount.push(o),this.barInfo.finishDaysCount.push(c),this.barInfo.taskAchieveRate.push(0===o?0:(100*u/o).toFixed(2)),this.barInfo.timeAchieveRate.push(0===c?0:(100*p/c).toFixed(2))}},calMax(e){var t=Math.max.apply(null,e),a=Math.ceil(t/5),s=5*a+5;return s},calMin(e){var t=Math.min.apply(null,e),a=Math.floor(t/1),s=1*a-5;return s}}},yi=fi,gi=(0,o.Z)(yi,mi,bi,!1,null,"20e40a8b",null),vi=gi.exports,wi=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",[e._v("个人中心")]),t("el-breadcrumb-item",[e._v("消息中心")])],1)],1),e.showApply?e._e():t("el-card",[t("el-row",[0===e.user.type?t("el-col",{attrs:{span:4,offset:20}},[t("el-button",{attrs:{icon:"el-icon-s-claim",type:"warning"},on:{click:function(t){e.showApply=!0}}},[e._v("我的申请")]),e.showHistory?e._e():t("el-button",{attrs:{icon:"el-icon-s-comment",type:"info"},on:{click:function(t){e.showHistory=!0}}},[e._v("历史消息")])],1):t("el-col",{attrs:{span:2,offset:22}},[e.showHistory?e._e():t("el-button",{attrs:{icon:"el-icon-s-comment",type:"info"},on:{click:function(t){e.showHistory=!0}}},[e._v("历史消息")])],1)],1),e.showHistory?e._e():t("el-table",{attrs:{data:e.logList}},[t("el-table-column",{attrs:{label:"消息"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(a.row.content))])]}}],null,!1,2912862315)}),t("el-table-column",{attrs:{prop:"createName",label:"操作人"}}),t("el-table-column",{attrs:{prop:"createTime",label:"消息时间"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"primary",round:""},on:{click:function(t){return e.handleCheckMessage(a.row)}}},[e._v("已阅")])]}}],null,!1,1111380292)})],1),e.showHistory?t("div",[t("el-table",{attrs:{data:e.historyLogList}},[t("el-table-column",{attrs:{label:"消息",width:"1200"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(a.row.content))])]}}],null,!1,2912862315)}),t("el-table-column",{attrs:{prop:"createName",label:"操作人"}}),t("el-table-column",{attrs:{prop:"createTime",label:"消息时间"}})],1),t("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"left"},attrs:{"current-page":e.queryObj.page,"page-sizes":[8,10,15,20,30],"page-size":e.queryObj.pageSize,layout:"total, sizes, prev, pager, next",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){return e.$set(e.queryObj,"page",t)},"update:current-page":function(t){return e.$set(e.queryObj,"page",t)}}}),t("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"primary",icon:"el-icon-back"},on:{click:function(t){e.showHistory=!1}}},[e._v("返回")])],1):e._e()],1),e.showApply?t("el-card",[t("el-row",[t("el-col",{attrs:{span:2,offset:22}},[t("el-button",{attrs:{icon:"el-icon-chat-dot-round",type:"warning"},on:{click:function(t){e.showApply=!1}}},[e._v("我的消息")])],1)],1),t("h3",[e._v("专案类申请")]),t("el-table",{attrs:{data:e.applyCaseSubList}},[t("el-table-column",{attrs:{prop:"caseName",label:"专案"}}),t("el-table-column",{attrs:{prop:"subName",label:"阶段"}}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"danger",size:"medium",round:""},on:{click:function(t){return e.removeCaseSubApply(a.row.id)}}},[e._v("撤 回")])]}}],null,!1,625825110)})],1),t("hr"),t("h3",[e._v("任务类申请")]),t("el-table",{attrs:{data:e.applyTaskList}},[t("el-table-column",{attrs:{label:"类型"},scopedSlots:e._u([{key:"default",fn:function(a){return[1===a.row.type?t("el-tag",{attrs:{type:"warning",effect:"dark"}},[e._v("临时任务")]):t("el-tag",{attrs:{type:"primary",effect:"dark"}},[e._v("技术研究")])]}}],null,!1,3993080699)}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"planDays",label:"计划时间"}}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"danger",size:"medium",round:""},on:{click:function(t){return e.removeTaskApply(a.row.id)}}},[e._v("撤 回")])]}}],null,!1,764169611)})],1),t("hr"),t("h3",[e._v("延期申请")]),t("el-table",{attrs:{data:e.delayList}},[t("el-table-column",{attrs:{label:"类型"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.caseSubId?t("el-tag",{attrs:{type:"success",effect:"dark"}},[e._v("专案类")]):e._e(),1===a.row.type?t("el-tag",{attrs:{type:"warning",effect:"dark"}},[e._v("临时任务")]):e._e(),2===a.row.type?t("el-tag",{attrs:{type:"primary",effect:"dark"}},[e._v("技术研究")]):e._e()]}}],null,!1,2001313449)}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"applyDays",label:"申请时间"}}),t("el-table-column",{attrs:{prop:"predictTime",label:"预计完成时间"}}),t("el-table-column",{attrs:{prop:"applyReason",label:"申请原因"}}),t("el-table-column",{attrs:{prop:"delayType",label:"延期类型"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"danger",size:"medium",round:""},on:{click:function(t){return e.removeDelayApply(a.row.id)}}},[e._v("撤 回")])]}}],null,!1,1773613811)})],1),t("hr"),t("h3",[e._v("完结申请")]),t("el-table",{attrs:{data:e.finishList}},[t("el-table-column",{attrs:{label:"类型"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.caseSubId?t("el-tag",{attrs:{type:"success",effect:"dark"}},[e._v("专案类")]):e._e(),1===a.row.type?t("el-tag",{attrs:{type:"warning",effect:"dark"}},[e._v("临时任务")]):e._e(),2===a.row.type?t("el-tag",{attrs:{type:"primary",effect:"dark"}},[e._v("技术研究")]):e._e()]}}],null,!1,2001313449)}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"applyTime",label:"申请完结时间"}}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"danger",size:"medium",round:""},on:{click:function(t){return e.removeFinishApply(a.row.id)}}},[e._v("撤 回")])]}}],null,!1,1485206741)})],1),t("hr")],1):e._e()],1)},ki=[];const Ti=()=>ur.get("/log/list"),Si=e=>ur.put("/log/checkLog",e),xi=e=>ur.get("/log/getHistoryLogByUserId",{params:e});var Ci={data(){return{showApply:!1,showHistory:!1,queryObj:{page:1,pageSize:8},applyCaseSubList:[],applyTaskList:[],delayList:[],finishList:[],historyLogList:[],total:null}},created(){0===this.user.type&&this.getAllList(),this.getLogWithMe()},computed:{...(0,k.rn)("log",["logList"]),...(0,k.rn)(["user"])},methods:{...(0,k.nv)("log",["getLogList","checkMessage"]),async getLogWithMe(){this.queryObj.userId=this.user.id;const e=await xi(this.queryObj);200===e.code&&(this.historyLogList=e.data.records,this.total=e.data.total)},handleSizeChange(e){this.queryObj.pageSize=e,this.queryObj.page=1,this.getLogWithMe()},handleCurrentChange(e){this.queryObj.page=e,this.getLogWithMe()},async handleCheckMessage(e){const t=await this.checkMessage(e);this.$message.success(t.data),this.getLogList()},async getAllList(){var e=await ds(this.user.id);200===e.code?(this.applyCaseSubList=e.data,e=await es(this.user.id),200===e.code?(this.applyTaskList=e.data,e=await xt(this.user.id),200===e.code?(this.delayList=e.data,e=await Ea(this.user.id),200===e.code?this.finishList=e.data:this.$message.error(e.msg)):this.$message.error(e.msg)):this.$message.error(e.msg)):this.$message.error(e.msg)},removeFinishApply(e){this.$confirm("确定要删除该申请吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{var t=await Ma(e);200===t.code?(this.$message.success(t.data),this.getAllList()):this.$message.error(t.msg)}))},removeDelayApply(e){this.$confirm("确定要删除该申请吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{var t=await It(e);200===t.code?(this.$message.success(t.data),this.getAllList()):this.$message.error(t.msg)}))},removeTaskApply(e){this.$confirm("确定要删除该申请吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{var t=await ts(e);200===t.code?(this.$message.success(t.data),this.getAllList()):this.$message.error(t.msg)}))},removeCaseSubApply(e){this.$confirm("确定要删除该申请吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{var t=await hs(e);200===t.code?(this.$message.success(t.data),this.getAllList()):this.$message.error(t.msg)}))}}},Di=Ci,Ii=(0,o.Z)(Di,wi,ki,!1,null,"4ad8bd7c",null),_i=Ii.exports,Li=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",[e._v("需求管理")])],1)],1),t("el-card",[t("el-table",{attrs:{data:e.demandList}},[t("el-table-column",{attrs:{label:"描述",prop:"description"}}),t("el-table-column",{attrs:{label:"类型"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.type?t("el-tag",{attrs:{type:"primary"}},[e._v("需求")]):t("el-tag",{attrs:{type:"danger"}},[e._v("BUG")])]}}])}),t("el-table-column",{attrs:{label:"创建人",prop:"createName"}}),t("el-table-column",{attrs:{label:"创建时间",prop:"createTime"}}),t("el-table-column",{attrs:{label:"完成时间",prop:"updateTime"}}),"admin"===e.user.name?t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[null===a.row.updateTime?t("el-button",{attrs:{type:"success"},on:{click:function(t){return e.finishDemand(a.row)}}},[e._v("完成 ")]):e._e()]}}],null,!1,2959682554)}):e._e()],1),t("br"),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-input",{staticClass:"textarea-placeholder-multiline",attrs:{type:"textarea",rows:4,placeholder:"请尽可能详细的描述你的需求/或者系统bug, 例： \n专案详情界面: XXX专案XXX阶段的负责人不对/开始时间不对\n个人总览界面: 搜索后 界面不跳转\n数据统计界面: 我需要多一个查询维度,比如按照XX查询/排序"},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}})],1),t("el-col",{attrs:{span:3,offset:3}},[t("el-select",{attrs:{placeholder:"请选择类型"},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},e._l([{label:"bug",value:0},{label:"需求",value:1}],(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-col",{attrs:{span:2,offset:4}},[t("el-button",{attrs:{type:"primary"},on:{click:e.addDemand}},[e._v("添 加")])],1)],1)],1)],1)},Fi=[];const Oi=()=>ur.get("/demand/list"),ji=e=>ur.post("/demand",e),Ai=e=>ur.put("/demand",e);var zi={data(){return{description:"",type:null,demandList:""}},created(){this.getDemandList()},computed:{...(0,k.rn)(["user"])},methods:{async getDemandList(){const e=await Oi();this.demandList=e.data},async addDemand(){if(""===this.description||this.description.length<=10)return void this.$message.error("需求描述为空或者过短，请尽可能详细的描述需求或者bug");if(null===this.type)return void this.$message.error("请选择类型，是系统bug还是新增需求");const e=await ji({createName:this.user.name,description:this.description,type:this.type});this.$message.success(e.data),this.description="",this.type=null,this.getDemandList()},async finishDemand(e){const t=await Ai({id:e.id});this.$message.success(t.data),this.getDemandList()}}},$i=zi,Ri=(0,o.Z)($i,Li,Fi,!1,null,"51ea677e",null),Vi=Ri.exports,qi=function(){var e=this,t=e._self._c;return t("div",{staticClass:"schedule"},[e._m(0),t("div",{staticStyle:{"margin-left":"100px","margin-right":"100px","margin-bottom":"20px"}},e._l(e.schedule,(function(a){return t("div",{key:a.addTime},[a.checked?e._e():t("div",{staticClass:"my-card"},[t("el-row",{staticClass:"item_center"},[t("el-col",{attrs:{span:22}},[e._v(e._s(a.newTask))]),t("el-col",{attrs:{span:1,offset:1}},[t("el-button",{attrs:{type:"success",round:""},on:{click:function(t){return e.finishTask(a)}}},[e._v("完成")])],1)],1)],1)])})),0),t("div",{staticStyle:{"margin-left":"100px","margin-right":"100px","margin-bottom":"20px"}},[t("el-dropdown",{staticStyle:{"margin-bottom":"10px"}},[t("el-button",{attrs:{type:"info"},on:{click:function(t){e.showFinish=!e.showFinish}}},[e._v(" 已完成"),t("i",{class:{"el-icon-arrow-down":e.showFinish,"el-icon-arrow-right":!e.showFinish}})])],1),e.showFinish?t("div",e._l(e.schedule,(function(a){return t("div",{key:a.addTime},[a.checked?t("div",{staticClass:"my-card_finish"},[t("el-row",{staticClass:"item_center"},[t("el-col",{attrs:{span:21}},[t("span",{staticStyle:{"text-decoration":"line-through"}},[e._v(e._s(a.newTask))])]),t("el-col",{attrs:{span:1,offset:1}},[t("el-button",{attrs:{type:"primary",size:"small",round:""},on:{click:function(t){return e.finishTask(a)}}},[e._v("撤销")])],1),t("el-col",{attrs:{span:1}},[t("el-button",{attrs:{type:"danger",size:"small",round:""},on:{click:function(t){return e.delTask(a)}}},[e._v("删除")])],1)],1)],1):e._e()])})),0):e._e()],1),t("div",{staticClass:"bottom-input"},[t("el-input",{staticStyle:{width:"78%"},attrs:{"prefix-icon":"el-icon-plus",placeholder:"添加任务  例：与XXX部门合作解决XXX问题，截止XX日"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addTask()}},model:{value:e.taskObj.newTask,callback:function(t){e.$set(e.taskObj,"newTask",t)},expression:"taskObj.newTask"}})],1)])},Ui=[function(){var e=this,t=e._self._c;return t("h1",{staticStyle:{"text-align":"center",color:"white"}},[t("i",{staticClass:"el-icon-price-tag"}),e._v("待办事项")])}],Ni={data(){return{schedule:[],taskObj:{newTask:"",addTime:null,checked:!1},showFinish:!0,pickerOptions:{shortcuts:[{text:"今后一周",onClick(e){const t=new Date((new Date).getTime()+6048e5);e.$emit("pick",[new Date,t])}},{text:"今后两周",onClick(e){const t=new Date((new Date).getTime()+12096e5);e.$emit("pick",[new Date,t])}},{text:"今后三周",onClick(e){const t=new Date((new Date).getTime()+18144e5);e.$emit("pick",[new Date,t])}},{text:"今后一月",onClick(e){const t=new Date((new Date).getTime()+2592e6);e.$emit("pick",[new Date,t])}},{text:"今后两月",onClick(e){const t=new Date((new Date).getTime()+5184e6);e.$emit("pick",[new Date,t])}}]}}},created(){this.schedule=JSON.parse(localStorage.getItem("pim_schedule")),null===this.schedule&&(this.schedule=[])},computed:{...(0,k.rn)(["user"])},methods:{addTask(){this.taskObj.addTime=new Date,this.schedule.unshift(this.taskObj),localStorage.setItem("pim_schedule",JSON.stringify(this.schedule)),this.taskObj={newTask:"",addTime:null,checked:!1}},finishTask(e){e.checked=!e.checked,localStorage.setItem("pim_schedule",JSON.stringify(this.schedule))},delTask(e){this.schedule.splice(this.schedule.indexOf(e),1),localStorage.setItem("pim_schedule",JSON.stringify(this.schedule))}}},Pi=Ni,Ei=(0,o.Z)(Pi,qi,Ui,!1,null,"2013b262",null),Mi=Ei.exports,Bi=function(){var e=this,t=e._self._c;return t("div",{staticClass:"schedule"},[e._m(0),t("div",{staticStyle:{"margin-left":"100px","margin-right":"100px","margin-bottom":"20px"}},e._l(e.schedule,(function(a){return t("div",{key:a.addTime},[a.checked?e._e():t("div",{staticClass:"my-card"},[t("el-row",{staticClass:"item_center"},[t("el-col",{attrs:{span:22}},[e._v(e._s(a.newTask))]),t("el-col",{attrs:{span:1,offset:1}},[t("el-button",{attrs:{type:"success",round:""},on:{click:function(t){return e.finishTask(a)}}},[e._v("完成")])],1)],1)],1)])})),0),t("div",{staticStyle:{"margin-left":"100px","margin-right":"100px","margin-bottom":"20px"}},[t("el-dropdown",{staticStyle:{"margin-bottom":"10px"}},[t("el-button",{attrs:{type:"info"},on:{click:function(t){e.showFinish=!e.showFinish}}},[e._v(" 已完成"),t("i",{class:{"el-icon-arrow-down":e.showFinish,"el-icon-arrow-right":!e.showFinish}})])],1),e.showFinish?t("div",e._l(e.schedule,(function(a){return t("div",{key:a.addTime},[a.checked?t("div",{staticClass:"my-card"},[t("el-row",{staticClass:"item_center"},[t("el-col",{attrs:{span:21}},[t("span",{staticStyle:{"text-decoration":"line-through"}},[e._v(e._s(a.newTask))])]),t("el-col",{attrs:{span:1,offset:1}},[t("el-button",{attrs:{type:"primary",size:"medium",round:""},on:{click:function(t){return e.finishTask(a)}}},[e._v("撤销")])],1),t("el-col",{attrs:{span:1}},[t("el-button",{attrs:{type:"danger",size:"medium",round:""},on:{click:function(t){return e.delTask(a)}}},[e._v("删除")])],1)],1)],1):e._e()])})),0):e._e()],1),t("div",{staticClass:"bottom-input"},[t("el-input",{attrs:{"prefix-icon":"el-icon-plus",placeholder:"添加任务  例：与XXX部门合作解决XXX问题，截止XX日"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addTask()}},model:{value:e.taskObj.newTask,callback:function(t){e.$set(e.taskObj,"newTask",t)},expression:"taskObj.newTask"}})],1)])},Gi=[function(){var e=this,t=e._self._c;return t("h1",{staticStyle:{"text-align":"center",color:"white"}},[t("i",{staticClass:"el-icon-price-tag"}),e._v("待办事项")])}],Hi={data(){return{schedule:[],taskObj:{newTask:"",addTime:null,checked:!1},showFinish:!0,pickerOptions:{shortcuts:[{text:"今后一周",onClick(e){const t=new Date((new Date).getTime()+6048e5);e.$emit("pick",[new Date,t])}},{text:"今后两周",onClick(e){const t=new Date((new Date).getTime()+12096e5);e.$emit("pick",[new Date,t])}},{text:"今后三周",onClick(e){const t=new Date((new Date).getTime()+18144e5);e.$emit("pick",[new Date,t])}},{text:"今后一月",onClick(e){const t=new Date((new Date).getTime()+2592e6);e.$emit("pick",[new Date,t])}},{text:"今后两月",onClick(e){const t=new Date((new Date).getTime()+5184e6);e.$emit("pick",[new Date,t])}}]}}},created(){this.schedule=JSON.parse(localStorage.getItem("pim_schedule")),null===this.schedule&&(this.schedule=[])},methods:{addTask(){this.taskObj.addTime=new Date,this.schedule.unshift(this.taskObj),localStorage.setItem("pim_schedule",JSON.stringify(this.schedule)),this.taskObj={newTask:"",addTime:null,checked:!1}},finishTask(e){e.checked=!e.checked,localStorage.setItem("pim_schedule",JSON.stringify(this.schedule))},delTask(e){this.schedule.splice(this.schedule.indexOf(e),1),localStorage.setItem("pim_schedule",JSON.stringify(this.schedule))}}},Zi=Hi,Yi=(0,o.Z)(Zi,Bi,Gi,!1,null,"70b2f762",null),Wi=Yi.exports,Xi={namespaced:!0,state(){return{caseList:[],queryList:[]}},mutations:{updateList(e,t){e.caseList=t},queryCase(e,t){e.queryList=e.caseList,"name"in t&&(e.queryList=e.queryList.filter((e=>e.name.includes(t.name)))),"status"in t&&(e.queryList=e.queryList.filter((e=>e.status===t.status))),"director"in t&&(e.queryList=e.queryList.filter((e=>e.director===t.director))),"startTime"in t&&"endTime"in t&&(e.queryList=e.queryList.filter((e=>new Date(e.finishTime)>=new Date(t.startTime)&&new Date(e.finishTime)<=new Date(t.endTime))))}},actions:{async getCaseList(e,t){var a=await Ie(t);a=a.data;for(let i=0;i<a.length;i++){if(null===a[i].startTime)continue;const e=new Date(a[i]["startTime"]);a[i].startTime=Lr(e),null!==a[i].finishTime&&(a[i].finishTime=Lr(new Date(a[i]["finishTime"])));var s=new Date(e);s.setDate(s.getDate()+a[i].planDay-1),a[i].presetTime=Lr(s),null===a[i].curStage&&(a[i].curStage="已结案")}t?a.sort(((e,t)=>new Date(t.finishTime)-new Date(e.finishTime))):a.sort(((e,t)=>t.executionDays-e.executionDays)),e.commit("updateList",a)}},getters:{}};const Qi={logList:[]};var Ji={namespaced:!0,state:Qi,mutations:{updateLogList(e,t){e.logList.length<t.length&&(0,p.Notification)({title:"系统消息",message:`系统收到了新的消息，目前有${t.length}条消息待阅`,type:"warning",duration:5e3}),e.logList=t}},actions:{async getLogList(e){const t=await Ti();e.commit("updateLogList",t.data)},async checkMessage(e,t){t.status=1;const a=await Si(t);return a}},getters:{}},Ki={namespaced:!0,state:{subList:[],delayList:[],finishList:[],caseSubList:[],taskList:[]},mutations:{updateSubList(e,t){e.subList=t},updateDelayList(e,t){e.delayList.length<t.length&&(0,p.Notification)({title:"延期申请",message:`系统收到了新的延期申请，目前有${t.length}条申请待审核`,type:"warning",duration:0}),e.delayList=t},updateFinishList(e,t){e.finishList.length<t.length&&(0,p.Notification)({title:"完结申请",message:`系统收到了新的完结申请，目前有${t.length}条申请待审核`,type:"warning",duration:0}),e.finishList=t},updateCaseSubList(e,t){e.caseSubList.length<t.length&&(0,p.Notification)({title:"专案类申请",message:`系统收到了新的专案类申请，目前有${t.length}条申请待审核`,type:"warning",duration:0}),e.caseSubList=t},updateTaskList(e,t){e.taskList.length<t.length&&(0,p.Notification)({title:"任务申请",message:`系统收到了新的任务申请，目前有${t.length}条申请待审核`,type:"warning",duration:0}),e.taskList=t}},actions:{async exceptionSub(e){const t=await br();e.commit("updateSubList",t.data)},async getDelay(e){var t=await wt();t.data.map((e=>{e.applyTime=Lr(e.createTime),e.formatPredictTime=Lr(e.predictTime)})),e.commit("updateDelayList",t.data)},async getFinish(e){var t=await Ua();t.data.forEach((e=>{try{e.estimateValue=null===e.estimateValue?null:e.estimateValue.toFixed(2)}catch(t){e.estimateValue="错误！"}})),e.commit("updateFinishList",t.data)},async getCaseSubApplyList(e){const t=await cs();e.commit("updateCaseSubList",t.data)},async getTaskList(e){const t=await Qa();t.data.forEach((e=>e.predictTime=Or(e.createTime,e.planDays))),e.commit("updateTaskList",t.data)}}};const er="ude_pim_user",tr=()=>JSON.parse(localStorage.getItem(er)),ar=e=>{localStorage.setItem(er,JSON.stringify(e))};s["default"].use(k.ZP);var sr=new k.ZP.Store({state:{user:tr()},getters:{getType(e){return e.user.type}},mutations:{setUser(e,t){e.user=t,ar(t)}},actions:{fetchUserData({commit:e},t){e("setUser",t)},async editUserInfo(e,t){const a=await Ze(t);return 200===a.code&&e.commit("setUser",t),a}},modules:{caseM:Xi,log:Ji,apply:Ki}});s["default"].use(J.ZP);const ir=[{path:"/",redirect:"/common/index"},{path:"/common",component:le,redirect:"index",children:[{path:"index",name:"主页",component:at},{path:"case2sub",name:"子流程详情",component:Ut},{path:"case2person",name:"专案个人详情",component:ut},{path:"caseAnalysis",name:"专案分析",component:Ls},{path:"userProject",name:"部员专案统计",component:Ps},{path:"userProjectTracking",name:"部员专案追踪",component:Ws},{path:"demand",name:"需求管理",component:Vi},{path:"schedule",name:"待办事项",component:Mi}]},{path:"/admin",component:le,children:[{path:"index",name:"管理员主页",component:Ve},{path:"caseList",name:"专案列表",component:Qt},{path:"subManage",name:"子流程管理",component:sa},{path:"templeteManage",name:"模板管理",component:ca},{path:"taskManage",name:"任务管理",component:Ta},{path:"exception",name:"异常专案处理",component:_a},{path:"delay",name:"延期申请",component:$a},{path:"finish",name:"完结申请",component:Za},{path:"study",name:"任务申请",component:rs},{path:"caseApply",name:"专案类申请",component:ys},{path:"info",name:"消息中心",component:_i},{path:"monthlyAnalysis",name:"月报分析",component:Ss},{path:"userList",name:"部员信息管理",component:$s}]},{path:"/user",redirect:"index",component:le,children:[{path:"index",name:"个人总览",component:ti},{path:"info",name:"消息中心",component:_i},{path:"progress",name:"执行任务",component:ni},{path:"statistics",name:"数据统计",component:hi},{path:"chart",name:"图表统计",component:vi}]},{path:"/login",name:"login",component:de},{path:"/noaccess",name:"禁止访问",component:xe},{path:"/test",component:Wi},{path:"*",component:ge}],rr=new J.ZP({base:"/ude-pim",routes:ir}),lr=[];rr.beforeEach((async(e,t,a)=>{if("/login"!==e.path){var s=localStorage.getItem("ude_pim_user");if(null!==s&&"{}"!==s)if(s=JSON.parse(s),lr.includes(e.path)&&"admin"!==s.name)a("/noaccess");else{if(!e.path.includes("admin")||1===s.type)return e.path.includes("user")&&s.status>2?((0,p.Message)({message:"你无权访问用户界面,正跳转回主页",type:"error"}),void a("/common/index")):void a();(0,p.Message)({message:"你无权访问管理员界面",type:"error"})}else a("/login")}else a()}));var nr=rr,or=a(6154);const cr=or.Z.create({baseURL:"/api",timeout:6e4,withCredentials:!0,headers:{"Content-Type":"application/json"}});cr.interceptors.request.use((e=>{let t=localStorage.getItem("token");return t&&(e.headers["authorization"]=t),e})),cr.interceptors.response.use((e=>"NOTLOGIN"===e.data.msg?(localStorage.removeItem("user"),nr.push("/login"),Promise.reject(e.data.msg)):404===e.data.code?((0,p.Message)({message:e.data.msg,type:"error"}),e.data):e.data),(e=>((0,p.Message)({message:"系统繁忙，请稍后重试",type:"error"}),Promise.reject(e))));var ur=cr;const pr=e=>ur.get(`caseSub/list/${e}`),dr=e=>ur.get(`caseSub/listFocusPerson/${e}`),hr=e=>ur.get(`/caseSub/director/${e}`),mr=e=>ur.post("/caseSub/saveRelation",e),br=()=>ur.get("/caseSub/exceptionSub"),fr=e=>ur.put("/caseSub/updateCaseSub",e),yr=e=>ur.put("/caseSub/startOrFinish",e),gr=e=>ur.get("/caseSub/unfinishedSubList",{params:e}),vr=e=>ur.get("/caseSub/analysis",{params:e}),wr=e=>ur.get("/caseSub/planFinishCount",{params:e}),kr=e=>ur.get(`/caseSub/${e}`),Tr=e=>ur.post("/caseSub/insertCaseSub",e),Sr=e=>ur.put("/caseSub/removeCaseSub",e),xr=e=>ur.put("/caseSub/updateCaseSubSort",e),Cr=e=>ur.get(`/caseSub/getChargeCaseSub/${e}`),Dr=()=>ur.get("/caseSub/getExecuting"),Ir=()=>ur.get("/caseSub/getHalfYearFinishCaseSubAmount");function _r(e){var t=Lr(e);return null===t||(t+=" 00:00:00"),t}function Lr(e){if(null===e)return null;"date"!==typeof e&&(e=new Date(e));const t=e.getFullYear(),a=(e.getMonth()+1).toString().padStart(2,"0"),s=e.getDate().toString().padStart(2,"0"),i=`${t}-${a}-${s}`;return i}function Fr(e,t,a){var s=0;if(null===e)return 4;if(null===a){const e=(new Date).setHours(0,0,0,0);s=e-new Date(t)>=0?2:0}else a=new Date(a),t=new Date(t),s=a-t<=0?1:3;return s}function Or(){for(var e=new Date(arguments[0]),t=1;t<arguments.length;t++)null!==arguments[t]&&(1===t?e.setDate(e.getDate()+arguments[t]-1):e.setDate(e.getDate()+arguments[t]));return Lr(e)}function jr(e,t){return e=new Date(e),t=new Date(t),e.setHours(0,0,0,0),t.setHours(0,0,0,0),Math.floor((t-e)/864e5)+1}async function Ar(e){200===e.code?p.Message.success(e.data):(0,p.Message)({type:"error",message:e.msg,duration:5e3})}var zr={props:{subInfo:Array,caseName:String},created(){},data(){return{drawer:!1,direction:"rtl",delayDrawer:!1,delayList:[],userInfo:[],chargeName:"負責人",commitVisible:!1,commitForm:{content:[],newContent:null,chargeId:[]},rules:{newContent:[{required:!0,message:"备注不能为空",trigger:"blur"},{min:8,max:255,message:"备注应该大于8个字符，小于255个字符",trigger:"blur"}]}}},computed:{...(0,k.rn)(["user"])},methods:{async handleDoubleClick(e,t){"外界因素延期"===t.label?this.getUnforcedDays(e):"人为因素延期"===t.label&&this.getApplyDelay(e)},async getUnforcedDays(e){var t=await Tt({caseSubId:e.id,status:1,type:"外界因素延期"});this.delayList=t.data,this.delayList.map((e=>e.predictTime=Lr(e.predictTime))),this.delayDrawer=!0},async getApplyDelay(e){var t=await Tt({caseSubId:e.id,status:1,type:"人为因素延期"});this.delayList=t.data,this.delayList.map((e=>e.predictTime=Lr(e.predictTime))),this.delayDrawer=!0},async getCaseByUserName(e,t){var a=await hr(e);this.userInfo=a.data,this.chargeName=t;for(var s=0;s<this.userInfo.length;s++){this.userInfo[s].startTime=Lr(this.userInfo[s].startTime);const e=new Date(this.userInfo[s].startTime);this.userInfo[s].presetTime=Lr(e.setDate(e.getDate()+this.userInfo[s].planDays)),this.userInfo[s].status=Fr(this.userInfo[s].startTime,this.userInfo[s].presetTime,this.userInfo[s].finishTime),this.userInfo[s].deadLine=Math.floor(0==this.userInfo[s].status?(new Date(this.userInfo[s].presetTime)-(new Date).setHours(0,0,0,0))/864e5:new Date((new Date).setHours(0,0,0,0)-new Date(this.userInfo[s].presetTime))/864e5)}this.drawer=!0},filterTag(e,t){return t.status===e},showtype(e){return 0===e?"primary":1===e?"success":2===e?"danger":3===e?"warning":void 0},number2status(e){return 0===e?"正在执行":1===e?"正常完成":2===e?"已延误":3===e?"延误完成":4===e?"未开始":void 0},async openCommitView(e){this.commitVisible=!0,this.commitForm.subName=e.subName,this.commitForm.caseSubId=e.id;var t=await Ne(e.id);t=t.data,this.commitForm.content=[];for(var a=0;a<t.length;a++)this.commitForm.content.push(t[a].content)},async submitCommitForm(){this.$refs.commitFormRef.validate((async e=>{if(!e)return;const t={};t.caseSubId=this.commitForm.caseSubId,t.content=this.commitForm.newContent,t.createUser=this.user.id;var a=await Pe(t);this.$message(a.data),this.commitVisible=!1}))},closeCommitDialog(){this.$refs.commitFormRef.resetFields()},async removeDirector(e,t){if(1===e.length)return void this.$message.warning("当前阶段仅剩一个负责人，请先增加负责人再删除");const a=await mt(e[t]);200===a.code?this.$message.success(a.data):this.$message.error(a.msg)}}},$r=zr,Rr=(0,o.Z)($r,X,Q,!1,null,"e4bbae82",null),Vr=Rr.exports,qr=function(){var e=this,t=e._self._c;return t("div",{staticClass:"singleBox",class:{normal:e.leftDay>=0,appliedDelay:e.leftDay<0&&e.leftDelay>=0,delay:e.leftDay<0&&e.leftDelay<0},attrs:{shadow:"always"}},[t("div",{staticClass:"info_area"},[t("div",{staticClass:"caseName"},[e._v(e._s(e.data.caseName))]),t("div",{staticClass:"subName"},[e._v(e._s(e.data.subName))]),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"申请延期",placement:"left"}},[t("el-button",{attrs:{size:"mini",type:"warning",icon:"el-icon-timer",round:""},on:{click:function(t){return e.openDelayApply(e.data)}}})],1),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"完结",placement:"left"}},[t("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-success",round:""},on:{click:function(t){return e.finishCaseSub(e.data)}}})],1)],1),t("div",{staticClass:"chart_area"},[t("el-progress",{attrs:{type:"circle","text-color":"#ffffff","stroke-width":10,percentage:e.leftRate,color:e.showColor,format:e.showText}})],1),t("el-dialog",{attrs:{title:"请选择完结日期",visible:e.isDatePickerVisible},on:{"update:visible":function(t){e.isDatePickerVisible=t}}},[t("el-date-picker",{attrs:{type:"date",placeholder:"请选择完结时间","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":e.pickerOptions},model:{value:e.selectedFinishDate,callback:function(t){e.selectedFinishDate=t},expression:"selectedFinishDate"}}),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.isDatePickerVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirmFinishDate}},[e._v("确 定")])],1)],1)],1)},Ur=[],Nr={props:{data:Object},data(){return{leftDay:0,leftRate:0,leftDelay:0,isDatePickerVisible:!1,selectedFinishDate:"",pickerOptions:{disabledDate(e){return e.getTime()>Date.now()}}}},computed:{...(0,k.rn)(["user"])},created(){setTimeout(this.getPercentage(),2e3)},methods:{getPercentage(){var e=new Date;if(e.setHours(0,0,0,0),e<=new Date(this.data.presetTime)){var t=jr(e,this.data.presetTime);this.leftDay=t;const a=jr(this.data.startTime,this.data.presetTime);this.leftRate=Math.ceil(this.leftDay/a*100)}else{var a=jr(this.data.presetTime,e);this.leftDay=-a,this.leftDelay=this.data.applyDelay-a,this.leftDelay>=0?this.leftRate=this.leftDelay/this.data.applyDelay*100:this.leftRate=a/this.data.planDays*100}return this.leftRate>100&&(this.leftRate=100),this.leftRate},showText(){return this.leftDay>=0?`剩余${this.leftDay}天`:this.leftDelay<0?`已延误${Math.abs(this.leftDay)}天`:`延期剩余${Math.abs(this.leftDelay)}天`},showColor(){return this.leftDay>=0?"#67c23a":"#DFF144"},openDelayApply(e){this.$router.push({path:"/delayApply",query:{caseSubId:e.id,caseSubName:e.subName,caseName:e.caseName,chargeId:[this.user.id]}})},finishCaseSub(e){this.$confirm("此操作将提交完结申请, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{var t=await ht(e.id);if(t.data.length>1){for(var a="<h5>该阶段有多个负责人, 您确定已经和其他负责人确认完结进度?</h5><br><br>",s=0;s<t.data.length;s++)a+=`<h5><input type="checkBox">  ${t.data[s]}</h5><br>`;this.$confirm(a,"提示",{dangerouslyUseHTMLString:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{this.applyFinish(e)}))}else this.applyFinish(e)}))},async applyFinish(e){this.isDatePickerVisible=e.id},async confirmFinishDate(){if(this.selectedFinishDate){var e=await qa({caseSubId:this.isDatePickerVisible,applyId:this.user.id,createTime:this.selectedFinishDate});Ar(e),this.isDatePickerVisible=!1}else this.$message.error("请选择完结日期")}}},Pr=Nr,Er=(0,o.Z)(Pr,qr,Ur,!1,null,"71408d28",null),Mr=Er.exports;s["default"].component("PIMHeader",g),s["default"].component("PIMAside",C),s["default"].component("CaseStatus",M),s["default"].component("CaseTable",W),s["default"].component("CaseSubTable",Vr),s["default"].component("CaseBox",Mr),s["default"].component("CasePie",V),s["default"].component("NavigationBar",O),s["default"].prototype.$axios=ur,s["default"].prototype.$echarts=Oa,s["default"].config.productionTip=!1,new s["default"]({router:nr,store:sr,render:function(e){return e(u)}}).$mount("#app")},4296:function(e,t,a){e.exports=a.p+"img/error-404.78e9b67a.svg"},6949:function(e){e.exports="data:image/png;base64,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"},7842:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA3CAYAAABD7GlFAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAARdEVYdFNvZnR3YXJlAFNuaXBhc3RlXRfO3QAAEqVJREFUaEPdWguUVdV5/u459zV3njyGGd74AImgogRbFrUEHxBAxahVm9bU0BVTS2qXGtFo05istFXzsFlZbdOa2BWDUl8xTbuyNGoiGjErPhAfPBWiCQwDOMI87p25955z+n3/Pme4yMxQY027+g97zj778e///f/7DKmIAIT85wEen4SQD89LoVQKsXnTXlSCCL7P8ciHl6oiqITIZUNMnjYe+/b24GBvH7wow7kUhC2VihAhBT741LuhPQzcuvhlJHDUuW5QxYRJDZg0qSWmUTMhl5A4naffxlAYcDUZ8qvaRwY8ZPwQL2/owaKF/4Kunn6OZtjybAfZivjDi0/F7y6ciy/f+gPs2/UOx0azEYexUGET+nT8/n5BhAvXAaxevQC33bYMEYdSns4Z4GyBT89OdwxFZEgaShhiP0PuN79WxEUX3Ind+zLI5LJGY6nYhenHp7Hme9fgW99+HGvufgF+qp4CKFCDXKCT7CBCSCKkpvcJIdXhpdIolw7gus+djr+6+axYw6JXDNXx6RhSGxYk48irUsZpmpSPqFxGWK5g1dXnINtwAE8+voGyqEMu14QqzVImpD32HOzTFN5HOxz0PrKARmRI4LZXKaEQYaWEE09oxeVXnIZ1617G7l8XkUk3oNJfhe/Rjs0OtOP9a+U3haMyJNv10mWquA8IQvz+R45FjqMvPNeBcn+edkxzSAdkQeqPGZI/UqP/GzAyQyQuCuk7XonPXjQUCpg7b6JN7dohwutpFvQ/BHzSb6hF044xJJv77WvqKBqiHdP7UpR2ldKvbwKmzxiLCv2os6OXYTMTG1fMSNJN4P8aQyLHZwhORXkMUFN1YwO0jWtmWK+iHBRJe2TBwqKZNfY9opQzm7aOIq8PAI7KkD0V0sMIjfV1KNQzH3FCIdPzaW4KPGLCmlvvYETUHxiMeKoFSQmbHCgzK135HvMyI1pTc5ZjFQYLrfrtw3DGPCJD2uTR6KyMYa9ciTBQZlbK+mhto0N5jG7DYf4AQCZu5iwY5tyj2IV0o51E4jFTk5liX2AaGj+xFUEQVwSCwQP+hzk8DB1f3g9Dbqt2Kmt76O0uYv/+LhudMX0aKwSfZqc6UGw71gUhE2xN3HtPICwh8QmHIVGktCDj5o8GIzAkDCQsUvSKkCXSvp4U3thxwGZnTW/F6MYGTg2g6hURpVUiiTdW5PQrz0h7b+B20ALIkKdcxqRt5WGKglNlbUlbXNYC19nBg29HgjzGQIsY4SI6f5rBoNqfw5u/6uVgCVMnN+DYqWM4V2akCBBEZEi4+ctT7kpOeA+gHW6vaI8rDb6E/MXU7Rg6DG8NnfHwCBpy4NHxwQJVSwfoMlu27mK/Du0T8zjplDb6UZGCTJMxFzwk4d8UTJDUhkVO3sdC5j5jkrnQD3h1CVS9u7XDwQgMUcbazKtApHzjk2ge9vyzb6F7IEKhMYvFy47D2FYeyRov69XBqiAJQHsN9bvNY2Sg59i+kHexKEzBD1mJBLp/dbGiJDOWxN1aMUZlHgFDMuRs2QVrqdsuV1yZZhDYvasbG1/otHVz5k7EvHntqJR4aMDVNMsUK4Sqzz4Jeq+gG41O9VhoRZRORH+ZMqUJLaPoo5Uem3dmR+rE0BDyGlpDRoszICdtFqhyVF4AK8xFj/1os820t+Vw7oq5qFZ6eelliWTio4Z4WrJbeI5swwHntNfuYP0WcD65cgnOXzGb960uF7Fr6sPkhFpwDL37jMQNyERkUY62TOlHfgmZbA4/eexlDAxoQRUXfGw+jps+FcWSrukyGZZENA1eKuIDEyZq2/CmmBJDqTKJp6kzGI0Z5+P0+RPQWOA7a8iEDWEZCowhK9Vq2E3UFth4QBMq06JIaJjnVbsV23fsw48ef4lIQzTy9nvd9WeTgDcQlPt5HW/kHnLrD9DsFKmGakPJlsD0ENAKqmhka0DafwfZqAvtYyagnBmNsjm1A/s+khBaAzZkchtiUtsjJlRpyozI+oxCdNbHfvw8SmURByw7byYWnXUC6emm6TGE8/5vUqoxj/8eOK0KPyi8oFqkwHzU1zfDzzJYiIahuKiBkWcJCgwpmpyeQUQN5AL6kYcXftGB1zZ22Joxo7L49J+dg7YJAYr9qiQKlAH9jgTIse1LmRNb3IYBE4D7UBNRW/m6DBpbGpEmf+lMH4OObs42PSwclSGBpJKixD0l16hIP2rCjm1V/ODBl1Au6oQAixYdjz+54gwSQS1VS0wn1F58uGOIIDMZ3n0MPDKlSiMISmhrZ74bN4paZ6z1eKGkbw3yI1UOgWtEhhQWU/zl897gMTh4QYa5gczxplqttuChh1/Buqd3cKWPQl0KV165GH9w8VxqcieZ6LFDPZ/r/bg2k+GrDRfSxbgFIZ8M9eCU08Zi6rSx6O8L6Z+sSMiOTN+WDoPiKAZJ3ehbAeTgSmzM1srk/EnnstjdUcU3/3G9faeUlkY3e/jcDR/D/NOb0de7C1U5OcO5zEfaNZHqJqsaLTFDR5978pIYMp/l0i3o6/shxo7bRxMH3tlfRLWcpg8f4kK9ZGstGEO2bKhZQkpXcEY46olrlI9k0KysWBGkc2Pw+E+24+57nuNKMhuVMXlKDl+5fSUWzJ/J0N7H/OG+BkkIVgmIh1i81tdPTYaUeff2HsDxM2bgjDNPtLFdb72N/iLnFGxiGIbcQwxZGEwgFoSEGYkBZDhEwjyGYzKXqvqmMY/a8tCE2297FL94YS/n8iS5Fyef3I47vnYZLrnoWJrmHgaKg6gwoCiXhYxeCPXpto4VEw9KkzSmhoCHqSrpr9D5M9vwN393A5YvucjoeGPXAY7LQhQFHXEiPCbTnknfMSSc9uogMXFanH4TEZGZyZApHm5BQr8phfpCPTp+FeKLX1iLLdu6OKMrRRmzT8niK18/HzfesBwTJ6R4MdyHykCIdLWBuibjRJeWX1LrIRNeRNPs7d2HukIvrvnsR7FixUyeF+KdrgFs39ZBWgrMcWLqkG4SmvVM+sbQcPo7cjjeFj9UFdDnaQqj8Nwz7+ALNz+M13ce5OGsLIJujB4N3HTjQtz3b1fjU1fOx6TJfUBuK/qrr7L+e53hvxP9PXtRHdhLHB2Y9zst+Nodl+CG1WeReK4leds3deINtgz91329dlQNQ7KqToIIrF0h8xOhfDjah9pOR6eTyjsymRZGoQx+/OibzLtr8eXbLsWMqeSmyjDLUDtnThO+OedCbN2xCOt/vgE7X+/E3o4So5dSQcY+uMyZNw2Ll8zBhNYMo2QPGaL30sL//eGN2LO7H7lsGwbK+3muo8jlbP1y3ikweof860PVQyYdYsumkvvrw14P2Tz9SLZomFQhuGLfgNJTqR+EvSgHO7Hk/Kn44i2XYuZxrZzsQWdnB666ajXuf+BBljNpVJhXygMBFIk9RrYsq/g6fV/m2mqVN2BWI/nMKDz7dAdu+fyDePVVBpeoBZVyFz574+m46eazXUphrYd0hSZLvyQeuciIJudAS7jSikY+6JguUtGPIlKhUsjvob/2wfcLyGam4dH/3IXPrLoLjzyhqrwRbW1TcMnFlwFlIaA4eN+pL5QxqiVAc1OVzPSbMAKjss6YUfF7xzcewSf+dB4+ter30F0s2veLmshNSF5EkOvFGlI446TdTKlqljYZBrdNrx7EivP/Abs6fEpR1imCEjtWX1U4w3r6beYbMhiMppM3kLAKb7e9yGYP4OMfPwFXXXk2Tp07wQiKQpUwWUqTlzflOElHdyldUSi8KrW3d38Prr/hLqy95zWeNJlCyiJfX0ZY7MNqaufzf72YeBgTdaO0qlz5keeTJMeQgR5kiMwZQ9kMtrzWgWv+8p+xpytHpE5TtlzxnESY9lgFyGQjmqKqayVG1bAhcgy1RfrWHkyf3oyLLlyAhQtPwpSpY7mLYd9yijQinOyRQH3MfH7DJqy55xH89LHNqEsfZ4Vpa1senXs7USkewMqVS/Hpq8/kOQOsQpT0hUf2KnqGZIixyzJ/FqXuCv1nLwZIqKlazVarBFERkmylGcq3YlRaFpKrUNpkOC5X+lFgtdw2rgWjRzWREIpCn45jCBXDuT+gdn69uwv793czKPCq4uWQq0tj/Ph67Onops8V0dJcQPuEZp7RTzw6SQldPs2+/h3OkBrvPkSsv9qFFRoCg4FJMiHeyB0OkjXaUYkdVBLUhw/iqLryP6L3powYB8YQS6eA2k2zqDUN0zw9cwE1zSuilhg0VKXkkGbjao4nRTA3Dc0Qr7+KepzVbVX1U2Tm5aCWHbF5GHuGSVj5YFUR0pekR4+RTXPm8+ykPN4KRTVBpiaQxqxvSFmN8Kpgf3yWaVgdmSPLNDNLrvQ/+rwvLdtHmcT0SK9jKGHGIT/0jMk1QmOo6Q+aXAwyQ7dAxFITqsxpSjQmvgqnk3aKAUEmPRTI2e18q7uIT+aklEK06sYUWaWhG4qYdwwJ5yBDQiJC3HLTmZDFiK2OG0QliPuWkxxoj/lZAipprIZyQYIGRemSOS5UDSjTS8BIiGFQSEJmDKkv5lRySQvxOydSxHM48CzH0JHgrgT0Jdq7Ps0a8BBnITKjQwQZaPxdQ+8FREbAQ+VDIuxI0EcYBoCjgDG0fdsWrH/6KUaRAWTyBSxftoyhcjwPkGT0v0icJOzQgIem09i2bTueWvdT9Jf60Nraznx1HjZu3IgXX3yROSwLP+3zPlQ1bZhgKBPTIKWeIl6Vt/lCAWPHjsGUY6ZhElshV8DOnW/gofvux9v734aXSSOqEkea5qsfpQSndCEyXHop8W6x4IwzcNHFlxiR0QP33RtNGd8a1efS0cQJbdGzP/+ZhiMSby0BOm1UrpStf99990djRrVEGXr5KbNOjA6+vT+6afX1UWNdPmptbooa6+ucB7iglhiPG2OTa+czftTeOjY68cSZ0Wf+YlVU6u+LXtrwYjSH+Bry2agxn4tyPutxOqL2yZOGasL7ySsuJ61V4aVzUZrZbI7JNOuk68vBaPexNmrBOT7dj3tyuTzyeeYLlhUeHSWXyzER1rPmKmPG9OmYv2BBvN/lLf2ZRFEzZOgNKfmXX32FV45t6NyzB3d95zuYPWsWFi06k1VBPQq8lsgylp97Lmbwsleh9aSYwNzph0ORFcRp8063SGnUmpPyIIVB/fixf2gBlWFzCST9lNZS9FojpjSupvURn6eeNhe3f/WrqKMJDwdbtmzGdddeg+eef555JYVtW7dg0cKPsO/OlTAuvewynL14SbxjOJCSHF2OcvZD5R4RoxBrCxzUZvSEaAGX0qZVTzFoVhQ2ORAzZHjoJ/paY2DXcOFUkz9ZxMHEiZPQOm4chzSWQs5yjMORCOdLt9yCC85djhXLl2H50o9i2eJzsDxu5y1dgnMWLcIVf/xHeH3b64bTUatzhgEjMIbaPgUqbq2v8Xej0JhMzPVdmHWhUL1kXKGYcpCH0Lxt1tY64cnkt27diqefegpPPvkkfsbn+vXr8QybPZ/R8xls2PAS70r2bTrREBEqGpHAFM0toy97BNlwohGB+oMa48GRVc+OQJ/FrMi0mo7gmY/ZJYfVuKukrUzh07I9QSVWb58+9EtjxG1nqREjhaHzr732Wqy9/wHcvWYNvvu9NVhz771sa3H3PffgX797N9asXYuv//03cMyxxwil8yFXHIoZp/K33nyLoXgcSqWSuDBSJDfRqjOrJOCJJx4zk1LIPOb441FX4LWBhCjZZdIpdDHsPr1uHRobGym9shHnCHV4+lmwPvXkOrzy8iss3CNey8v40Emz7S/skkyVQaPAsD558hTM4ni1TLOWJSTy5RrxLlxlzh08cMDWWx76/kMPYtWqP0dPT49FrDFjxpijS+W2NzYdgQgrk8A9nXtQ7C1hUns7vv8fP8TcD8/Ddauvw7f/6VuUEm+hdXmkmUeUyw75ncMjLcvvenlepSr/S+Hyyy/HnXfeic2bNuMT7L/5y19aUNBHmFyedRxpCRgdfdl6XAdalieu7u5uXLFyJf721ludhhqamjB79mxeiwcYwtO8LTJE8kdfO+27QQ1DSeSbc8ocfHjuXFx44YWYPvND1FQvxpO52SedzKuCvuTwGsISxTEhhhwOvaulKbgs2yyG6qVLl2LxkqU2r+947W1t6OvttTUyR1mCKogMw3YiFAOZP+nLmGvESuMCW1GuDNhiGZgE4P5Owynp2BzVSVnMycdqSx/7H4dErtIloKlwkWNcW7k+qRYSHLaWOEXIoLRj6KeZ79q924SbpV9apDQNUxDEKwsZZCnWkM5sHtWC9vbxhxj6/wKpiv7LrxOc05l+DepPr0O8q6O+IJm3vnvULHZztXtszRDvtWcIBs+tedbuGVw3+IsA/Bdi8M6bcmFN2QAAAABJRU5ErkJggg=="}},t={};function a(s){var i=t[s];if(void 0!==i)return i.exports;var r=t[s]={id:s,loaded:!1,exports:{}};return e[s].call(r.exports,r,r.exports,a),r.loaded=!0,r.exports}a.m=e,function(){a.amdO={}}(),function(){var e=[];a.O=function(t,s,i,r){if(!s){var l=1/0;for(u=0;u<e.length;u++){s=e[u][0],i=e[u][1],r=e[u][2];for(var n=!0,o=0;o<s.length;o++)(!1&r||l>=r)&&Object.keys(a.O).every((function(e){return a.O[e](s[o])}))?s.splice(o--,1):(n=!1,r<l&&(l=r));if(n){e.splice(u--,1);var c=i();void 0!==c&&(t=c)}}return t}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[s,i,r]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){a.p=""}(),function(){var e={143:0};a.O.j=function(t){return 0===e[t]};var t=function(t,s){var i,r,l=s[0],n=s[1],o=s[2],c=0;if(l.some((function(t){return 0!==e[t]}))){for(i in n)a.o(n,i)&&(a.m[i]=n[i]);if(o)var u=o(a)}for(t&&t(s);c<l.length;c++)r=l[c],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(u)},s=self["webpackChunkude_pim"]=self["webpackChunkude_pim"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=a.O(void 0,[998],(function(){return a(942)}));s=a.O(s)})();
//# sourceMappingURL=app.b68947e0.js.map